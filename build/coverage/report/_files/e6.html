<HTML><HEAD><META CONTENT="text/html; charset=ISO-8859-1" HTTP-EQUIV="Content-Type"/><TITLE>EMMA Coverage Report</TITLE><STYLE TYPE="text/css"> TABLE,TD,TH {border-style:solid; border-color:black;} TD,TH {background:white;margin:0;line-height:100%;padding-left:0.5em;padding-right:0.5em;} TD {border-width:0 1px 0 0;} TH {border-width:1px 1px 1px 0;} TR TD.h {color:red;} TABLE {border-spacing:0; border-collapse:collapse;border-width:0 0 1px 1px;} P,H1,H2,H3,TH {font-family:verdana,arial,sans-serif;font-size:10pt;} TD {font-family:courier,monospace;font-size:10pt;} TABLE.hdft {border-spacing:0;border-collapse:collapse;border-style:none;} TABLE.hdft TH,TABLE.hdft TD {border-style:none;line-height:normal;} TABLE.hdft TH.tl,TABLE.hdft TD.tl {background:#6699CC;color:white;} TABLE.hdft TD.nv {background:#6633DD;color:white;} .nv A:link {color:white;} .nv A:visited {color:white;} .nv A:active {color:yellow;} TABLE.hdft A:link {color:white;} TABLE.hdft A:visited {color:white;} TABLE.hdft A:active {color:yellow;} .in {color:#356085;} TABLE.s TD {padding-left:0.25em;padding-right:0.25em;} TABLE.s TD.l {padding-left:0.25em;padding-right:0.25em;text-align:right;background:#F0F0F0;} TABLE.s TR.z TD {background:#FF9999;} TABLE.s TR.p TD {background:#FFFF88;} TABLE.s TR.c TD {background:#CCFFCC;} A:link {color:#0000EE;text-decoration:none;} A:visited {color:#0000EE;text-decoration:none;} A:hover {color:#0000EE;text-decoration:underline;} TABLE.cn {border-width:0 0 1px 0;} TABLE.s {border-width:1px 0 1px 1px;} TD.h {color:red;border-width:0 1px 0 0;} TD.f {border-width:0 1px 0 1px;} TD.hf {color:red;border-width:0 1px 0 1px;} TH.f {border-width:1px 1px 1px 1px;} TR.cis TD {background:#F0F0F0;} TR.cis TD {border-width:1px 1px 1px 0;} TR.cis TD.h {color:red;border-width:1px 1px 1px 0;} TR.cis TD.f {border-width:1px 1px 1px 1px;} TR.cis TD.hf {color:red;border-width:1px 1px 1px 1px;} TD.b {border-style:none;background:transparent;line-height:50%;}  TD.bt {border-width:1px 0 0 0;background:transparent;line-height:50%;} TR.o TD {background:#F0F0F0;}TABLE.it {border-style:none;}TABLE.it TD,TABLE.it TH {border-style:none;}</STYLE></HEAD><BODY><TABLE CLASS="hdft" CELLSPACING="0" WIDTH="100%"><TR><TH CLASS="tl"><A HREF="http://emma.sourceforge.net/">EMMA</A> Coverage Report (generated Mon Oct 27 16:08:44 PDT 2014)</TH></TR><TR><TD CLASS="nv">[<A HREF="../index.html">all classes</A>][<A HREF="f.html">org.mozilla.javascript</A>]</TD></TR></TABLE><H2>COVERAGE SUMMARY FOR SOURCE FILE [<SPAN CLASS="in">NativeArray.java</SPAN>]</H2><TABLE CELLSPACING="0" WIDTH="100%"><TR><TH>name</TH><TH>class, %</TH><TH>method, %</TH><TH>block, %</TH><TH>line, %</TH></TR><TR><TD>NativeArray.java</TD><TD>100% (4/4)</TD><TD>78%  (78/100)</TD><TD>91%  (4078/4458)</TD><TD>90%  (815.3/902)</TD></TR></TABLE><H3>COVERAGE BREAKDOWN BY CLASS AND METHOD</H3><TABLE CLASS="cn" CELLSPACING="0" WIDTH="100%"><TR><TH CLASS="f">name</TH><TH>class, %</TH><TH>method, %</TH><TH>block, %</TH><TH>line, %</TH></TR><TR><TD CLASS="b"> </TD><TD CLASS="b"> </TD><TD CLASS="b"> </TD><TD CLASS="b"> </TD><TD CLASS="b"> </TD></TR><TR CLASS="cis"><TD CLASS="f">class <A HREF="#0">NativeArray$3</A></TD><TD>100% (1/1)</TD><TD CLASS="h">50%  (5/10)</TD><TD CLASS="h">69%  (62/90)</TD><TD CLASS="h">53%  (8/15)</TD></TR><TR><TD CLASS="f"><A HREF="#1">add (Object): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/4)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#2">nextIndex (): int</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/3)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR><TD CLASS="f"><A HREF="#3">previousIndex (): int</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/5)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#4">remove (): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/4)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR><TD CLASS="f"><A HREF="#5">set (Object): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/4)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#6">previous (): Object</A></TD><TD> </TD><TD>100% (1/1)</TD><TD CLASS="h">78%  (14/18)</TD><TD CLASS="h">67%  (2/3)</TD></TR><TR><TD CLASS="f"><A HREF="#7">next (): Object</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>80%  (16/20)</TD><TD CLASS="h">67%  (2/3)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#0">NativeArray$3 (NativeArray, int, int): void</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (16/16)</TD><TD>100% (2/2)</TD></TR><TR><TD CLASS="f"><A HREF="#9">hasNext (): boolean</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (9/9)</TD><TD>100% (1/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#a">hasPrevious (): boolean</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (7/7)</TD><TD>100% (1/1)</TD></TR><TR><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD></TR><TR CLASS="cis"><TD CLASS="f">class <A HREF="#b">NativeArray$1</A></TD><TD>100% (1/1)</TD><TD>100% (2/2)</TD><TD>91%  (79/87)</TD><TD>86%  (15.4/18)</TD></TR><TR><TD CLASS="f"><A HREF="#c">compare (Object, Object): int</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>88%  (61/69)</TD><TD>85%  (14.4/17)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#b">NativeArray$1 (Object [], Callable, Context, Scriptable, Scriptable): void</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (18/18)</TD><TD>100% (1/1)</TD></TR><TR><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD></TR><TR CLASS="cis"><TD CLASS="f">class <A HREF="#e">NativeArray</A></TD><TD>100% (1/1)</TD><TD>80%  (69/86)</TD><TD>92%  (3896/4238)</TD><TD>91%  (783.2/860)</TD></TR><TR><TD CLASS="f"><A HREF="#f">add (Object): boolean</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/4)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#10">add (int, Object): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/4)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR><TD CLASS="f"><A HREF="#11">addAll (Collection): boolean</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/4)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#12">addAll (int, Collection): boolean</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/4)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR><TD CLASS="f"><A HREF="#13">clear (): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/4)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#14">containsAll (Collection): boolean</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/18)</TD><TD CLASS="h">0%   (0/4)</TD></TR><TR><TD CLASS="f"><A HREF="#15">getAttributes (int): int</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/22)</TD><TD CLASS="h">0%   (0/3)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#16">getMaximumInitialCapacity (): int</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/2)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR><TD CLASS="f"><A HREF="#17">isEmpty (): boolean</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/9)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#18">jsGet_length (): long</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/3)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR><TD CLASS="f"><A HREF="#19">remove (Object): boolean</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/4)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#1a">remove (int): Object</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/4)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR><TD CLASS="f"><A HREF="#1b">removeAll (Collection): boolean</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/4)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#1c">retainAll (Collection): boolean</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/4)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR><TD CLASS="f"><A HREF="#1d">set (int, Object): Object</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/4)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#1e">setInstanceIdAttributes (int, int): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/7)</TD><TD CLASS="h">0%   (0/3)</TD></TR><TR><TD CLASS="f"><A HREF="#1f">subList (int, int): List</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/4)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#20">setDenseOnly (boolean): void</A></TD><TD> </TD><TD>100% (1/1)</TD><TD CLASS="h">46%  (6/13)</TD><TD CLASS="h">60%  (2.4/4)</TD></TR><TR><TD CLASS="f"><A HREF="#21">getInstanceIdName (int): String</A></TD><TD> </TD><TD>100% (1/1)</TD><TD CLASS="h">56%  (5/9)</TD><TD CLASS="h">50%  (1/2)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#22">listIterator (int): ListIterator</A></TD><TD> </TD><TD>100% (1/1)</TD><TD CLASS="h">58%  (22/38)</TD><TD CLASS="h">71%  (5/7)</TD></TR><TR><TD CLASS="f"><A HREF="#23">setInstanceIdValue (int, Object): void</A></TD><TD> </TD><TD>100% (1/1)</TD><TD CLASS="h">58%  (7/12)</TD><TD CLASS="h">50%  (2/4)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#24">getInstanceIdValue (int): Object</A></TD><TD> </TD><TD>100% (1/1)</TD><TD CLASS="h">67%  (8/12)</TD><TD CLASS="h">67%  (2/3)</TD></TR><TR><TD CLASS="f"><A HREF="#25">size (): int</A></TD><TD> </TD><TD>100% (1/1)</TD><TD CLASS="h">71%  (10/14)</TD><TD CLASS="h">75%  (3/4)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#26">get (long): Object</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>82%  (28/34)</TD><TD CLASS="h">75%  (6/8)</TD></TR><TR><TD CLASS="f"><A HREF="#27">defineOwnProperty (Context, Object, ScriptableObject, boolean): void</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>87%  (45/52)</TD><TD>92%  (11/12)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#28">js_splice (Context, Scriptable, Scriptable, Object []): Object</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>87%  (285/328)</TD><TD>89%  (57/64)</TD></TR><TR><TD CLASS="f"><A HREF="#29">indexOf (Object): int</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>87%  (41/47)</TD><TD>83%  (10/12)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#2a">jsConstructor (Context, Scriptable, Object []): Object</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>87%  (48/55)</TD><TD>83%  (10/12)</TD></TR><TR><TD CLASS="f"><A HREF="#2b">iterativeMethod (Context, int, Scriptable, Scriptable, Object []): Object</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>87%  (132/151)</TD><TD>90%  (32.5/36)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#2c">js_push (Context, Scriptable, Object []): Object</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>88%  (84/96)</TD><TD>93%  (13/14)</TD></TR><TR><TD CLASS="f"><A HREF="#2d">lastIndexOf (Object): int</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>88%  (43/49)</TD><TD>83%  (10/12)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#2e">toArrayIndex (Object): long</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>88%  (15/17)</TD><TD>80%  (4/5)</TD></TR><TR><TD CLASS="f"><A HREF="#2f">toStringHelper (Context, Scriptable, Scriptable, boolean, boolean): String</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>89%  (171/193)</TD><TD>91%  (41.8/46)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#30">ensureCapacity (int): boolean</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>90%  (43/48)</TD><TD>80%  (8/10)</TD></TR><TR><TD CLASS="f"><A HREF="#31">toArray (Object []): Object []</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>91%  (39/43)</TD><TD>88%  (7/8)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#32">execIdCall (IdFunctionObject, Context, Scriptable, Scriptable, Object []): Ob...</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>93%  (185/199)</TD><TD>94%  (33/35)</TD></TR><TR><TD CLASS="f"><A HREF="#33">reduceMethod (Context, int, Scriptable, Scriptable, Object []): Object</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>93%  (106/114)</TD><TD>84%  (16.9/20)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#34">js_slice (Context, Scriptable, Object []): Scriptable</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>94%  (72/77)</TD><TD>88%  (14/16)</TD></TR><TR><TD CLASS="f"><A HREF="#35">js_sort (Context, Scriptable, Scriptable, Object []): Scriptable</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>94%  (83/88)</TD><TD>94%  (17/18)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#36">defaultIndexPropertyDescriptor (Object): ScriptableObject</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>95%  (38/40)</TD><TD>97%  (8.7/9)</TD></TR><TR><TD CLASS="f"><A HREF="#37">initPrototypeId (int): void</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>95%  (124/130)</TD><TD>96%  (26/27)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#38">js_join (Context, Scriptable, Object []): String</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>96%  (157/164)</TD><TD>94%  (34/36)</TD></TR><TR><TD CLASS="f"><A HREF="#39">js_pop (Context, Scriptable, Object []): Object</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>97%  (61/63)</TD><TD>93%  (13/14)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#3a">js_unshift (Context, Scriptable, Object []): Object</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>97%  (123/127)</TD><TD>95%  (19/20)</TD></TR><TR><TD CLASS="f"><A HREF="#3b">indexOfHelper (Context, Scriptable, Object [], boolean): Object</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>98%  (204/208)</TD><TD>97%  (38.8/40)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#3c">setLength (Object): void</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>99%  (145/146)</TD><TD>97%  (34/35)</TD></TR><TR><TD CLASS="f"><A HREF="#e">&lt;static initializer&gt;</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (8/8)</TD><TD>100% (3/3)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#3e">NativeArray (Object []): void</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (17/17)</TD><TD>100% (6/6)</TD></TR><TR><TD CLASS="f"><A HREF="#3f">NativeArray (long): void</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (38/38)</TD><TD>100% (11/11)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#40">contains (Object): boolean</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (9/9)</TD><TD>100% (1/1)</TD></TR><TR><TD CLASS="f"><A HREF="#41">delete (int): void</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (33/33)</TD><TD>100% (4/4)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#42">deleteElem (Scriptable, long): void</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (17/17)</TD><TD>100% (4/4)</TD></TR><TR><TD CLASS="f"><A HREF="#43">fillConstructorProperties (IdFunctionObject): void</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (144/144)</TD><TD>100% (22/22)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#44">findInstanceIdInfo (String): int</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (13/13)</TD><TD>100% (3/3)</TD></TR><TR><TD CLASS="f"><A HREF="#45">findPrototypeId (String): int</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (223/223)</TD><TD>100% (36/36)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#46">get (int): Object</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (5/5)</TD><TD>100% (1/1)</TD></TR><TR><TD CLASS="f"><A HREF="#47">get (int, Scriptable): Object</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (35/35)</TD><TD>100% (5/5)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#48">getAllIds (): Object []</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (16/16)</TD><TD>100% (3/3)</TD></TR><TR><TD CLASS="f"><A HREF="#49">getClassName (): String</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (2/2)</TD><TD>100% (1/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#4a">getDefaultValue (Class): Object</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (17/17)</TD><TD>100% (5/5)</TD></TR><TR><TD CLASS="f"><A HREF="#4b">getElem (Context, Scriptable, long): Object</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (18/18)</TD><TD>100% (4/4)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#4c">getIds (): Object []</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (80/80)</TD><TD>100% (20/20)</TD></TR><TR><TD CLASS="f"><A HREF="#4d">getIndexIds (): Integer []</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (49/49)</TD><TD>100% (7/7)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#4e">getLength (): long</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (3/3)</TD><TD>100% (1/1)</TD></TR><TR><TD CLASS="f"><A HREF="#4f">getLengthProperty (Context, Scriptable): long</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (21/21)</TD><TD>100% (5/5)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#50">getMaxInstanceId (): int</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (2/2)</TD><TD>100% (1/1)</TD></TR><TR><TD CLASS="f"><A HREF="#51">getOwnPropertyDescriptor (Context, Object): ScriptableObject</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (34/34)</TD><TD>100% (6/6)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#52">getRawElem (Scriptable, long): Object</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (14/14)</TD><TD>100% (3/3)</TD></TR><TR><TD CLASS="f"><A HREF="#53">has (int, Scriptable): boolean</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (40/40)</TD><TD>100% (5/5)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#54">init (Scriptable, boolean): void</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (12/12)</TD><TD>100% (3/3)</TD></TR><TR><TD CLASS="f"><A HREF="#55">iterator (): Iterator</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (4/4)</TD><TD>100% (1/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#56">js_concat (Context, Scriptable, Scriptable, Object []): Scriptable</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (254/254)</TD><TD>100% (48/48)</TD></TR><TR><TD CLASS="f"><A HREF="#57">js_reverse (Context, Scriptable, Object []): Scriptable</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (88/88)</TD><TD>100% (17/17)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#58">js_shift (Context, Scriptable, Object []): Object</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (104/104)</TD><TD>100% (21/21)</TD></TR><TR><TD CLASS="f"><A HREF="#59">listIterator (): ListIterator</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (4/4)</TD><TD>100% (1/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#5a">put (String, Scriptable, Object): void</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (25/25)</TD><TD>100% (7/7)</TD></TR><TR><TD CLASS="f"><A HREF="#5b">put (int, Scriptable, Object): void</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (104/104)</TD><TD>100% (16/16)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#5c">setElem (Context, Scriptable, long, Object): void</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (22/22)</TD><TD>100% (6/6)</TD></TR><TR><TD CLASS="f"><A HREF="#5d">setLengthProperty (Context, Scriptable, long): Object</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (8/8)</TD><TD>100% (1/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#5e">setMaximumInitialCapacity (int): void</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (3/3)</TD><TD>100% (2/2)</TD></TR><TR><TD CLASS="f"><A HREF="#5f">setRawElem (Context, Scriptable, long, Object): void</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (13/13)</TD><TD>100% (4/4)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#60">toArray (): Object []</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (4/4)</TD><TD>100% (1/1)</TD></TR><TR><TD CLASS="f"><A HREF="#61">toArrayIndex (String): long</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (13/13)</TD><TD>100% (4/4)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#62">toArrayIndex (double): long</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (20/20)</TD><TD>100% (5/5)</TD></TR><TR><TD CLASS="f"><A HREF="#63">toDenseIndex (Object): int</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (16/16)</TD><TD>100% (2/2)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#64">toSliceIndex (double, long): long</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (34/34)</TD><TD>100% (8/8)</TD></TR><TR><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD></TR><TR CLASS="cis"><TD CLASS="f">class <A HREF="#65">NativeArray$2</A></TD><TD>100% (1/1)</TD><TD>100% (2/2)</TD><TD>95%  (41/43)</TD><TD>98%  (11.7/12)</TD></TR><TR><TD CLASS="f"><A HREF="#66">compare (Object, Object): int</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>95%  (38/40)</TD><TD>97%  (10.7/11)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#65">NativeArray$2 (): void</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (3/3)</TD><TD>100% (1/1)</TD></TR></TABLE><P></P><TABLE CLASS="s" CELLSPACING="0" WIDTH="100%"><TR><TD CLASS="l">1</TD><TD>/* -*- Mode: java; tab-width: 8; indent-tabs-mode: nil; c-basic-offset: 4 -*-</TD></TR><TR><TD CLASS="l">2</TD><TD> *</TD></TR><TR><TD CLASS="l">3</TD><TD> * This Source Code Form is subject to the terms of the Mozilla Public</TD></TR><TR><TD CLASS="l">4</TD><TD> * License, v. 2.0. If a copy of the MPL was not distributed with this</TD></TR><TR><TD CLASS="l">5</TD><TD> * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</TD></TR><TR><TD CLASS="l">6</TD><TD> </TD></TR><TR><TD CLASS="l">7</TD><TD>package org.mozilla.javascript;</TD></TR><TR><TD CLASS="l">8</TD><TD> </TD></TR><TR><TD CLASS="l">9</TD><TD>import java.util.Arrays;</TD></TR><TR><TD CLASS="l">10</TD><TD>import java.util.Collection;</TD></TR><TR><TD CLASS="l">11</TD><TD>import java.util.Comparator;</TD></TR><TR><TD CLASS="l">12</TD><TD>import java.util.Iterator;</TD></TR><TR><TD CLASS="l">13</TD><TD>import java.util.LinkedHashSet;</TD></TR><TR><TD CLASS="l">14</TD><TD>import java.util.List;</TD></TR><TR><TD CLASS="l">15</TD><TD>import java.util.ListIterator;</TD></TR><TR><TD CLASS="l">16</TD><TD>import java.util.NoSuchElementException;</TD></TR><TR><TD CLASS="l">17</TD><TD>import java.util.Set;</TD></TR><TR><TD CLASS="l">18</TD><TD> </TD></TR><TR><TD CLASS="l">19</TD><TD>/**</TD></TR><TR><TD CLASS="l">20</TD><TD> * This class implements the Array native object.</TD></TR><TR><TD CLASS="l">21</TD><TD> * @author Norris Boyd</TD></TR><TR><TD CLASS="l">22</TD><TD> * @author Mike McCabe</TD></TR><TR><TD CLASS="l">23</TD><TD> */</TD></TR><TR><TD CLASS="l">24</TD><TD>public class NativeArray extends IdScriptableObject implements List</TD></TR><TR><TD CLASS="l">25</TD><TD>{</TD></TR><TR><TD CLASS="l">26</TD><TD>    static final long serialVersionUID = 7331366857676127338L;</TD></TR><TR><TD CLASS="l">27</TD><TD> </TD></TR><TR><TD CLASS="l">28</TD><TD>    /*</TD></TR><TR><TD CLASS="l">29</TD><TD>     * Optimization possibilities and open issues:</TD></TR><TR><TD CLASS="l">30</TD><TD>     * - Long vs. double schizophrenia.  I suspect it might be better</TD></TR><TR><TD CLASS="l">31</TD><TD>     * to use double throughout.</TD></TR><TR><TD CLASS="l">32</TD><TD>     *</TD></TR><TR><TD CLASS="l">33</TD><TD>     * - Functions that need a new Array call &#34;new Array&#34; in the</TD></TR><TR><TD CLASS="l">34</TD><TD>     * current scope rather than using a hardwired constructor;</TD></TR><TR><TD CLASS="l">35</TD><TD>     * &#34;Array&#34; could be redefined.  It turns out that js calls the</TD></TR><TR><TD CLASS="l"><A NAME="e">36</A></TD><TD>     * equivalent of &#34;new Array&#34; in the current scope, except that it</TD></TR><TR><TD CLASS="l">37</TD><TD>     * always gets at least an object back, even when Array == null.</TD></TR><TR><TD CLASS="l">38</TD><TD>     */</TD></TR><TR><TD CLASS="l">39</TD><TD> </TD></TR><TR CLASS="c"><TD CLASS="l">40</TD><TD>    private static final Object ARRAY_TAG = &#34;Array&#34;;</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="54">41</A></TD><TD>    private static final Integer NEGATIVE_ONE = Integer.valueOf(-1);</TD></TR><TR><TD CLASS="l">42</TD><TD> </TD></TR><TR><TD CLASS="l">43</TD><TD>    static void init(Scriptable scope, boolean sealed)</TD></TR><TR><TD CLASS="l">44</TD><TD>    {</TD></TR><TR CLASS="c"><TD CLASS="l">45</TD><TD>        NativeArray obj = new NativeArray(0);</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="16">46</A></TD><TD>        obj.exportAsJSClass(MAX_PROTOTYPE_ID, scope, sealed);</TD></TR><TR CLASS="c"><TD CLASS="l">47</TD><TD>    }</TD></TR><TR><TD CLASS="l">48</TD><TD> </TD></TR><TR><TD CLASS="l">49</TD><TD>    static int getMaximumInitialCapacity() {</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="5e">50</A></TD><TD>        return maximumInitialCapacity;</TD></TR><TR><TD CLASS="l">51</TD><TD>    }</TD></TR><TR><TD CLASS="l">52</TD><TD> </TD></TR><TR><TD CLASS="l">53</TD><TD>    static void setMaximumInitialCapacity(int maximumInitialCapacity) {</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="3f">54</A></TD><TD>        NativeArray.maximumInitialCapacity = maximumInitialCapacity;</TD></TR><TR CLASS="c"><TD CLASS="l">55</TD><TD>    }</TD></TR><TR><TD CLASS="l">56</TD><TD> </TD></TR><TR><TD CLASS="l">57</TD><TD>    public NativeArray(long lengthArg)</TD></TR><TR CLASS="c"><TD CLASS="l">58</TD><TD>    {</TD></TR><TR CLASS="c"><TD CLASS="l">59</TD><TD>        denseOnly = lengthArg &lt;= maximumInitialCapacity;</TD></TR><TR CLASS="c"><TD CLASS="l">60</TD><TD>        if (denseOnly) {</TD></TR><TR CLASS="c"><TD CLASS="l">61</TD><TD>            int intLength = (int) lengthArg;</TD></TR><TR CLASS="c"><TD CLASS="l">62</TD><TD>            if (intLength &lt; DEFAULT_INITIAL_CAPACITY)</TD></TR><TR CLASS="c"><TD CLASS="l">63</TD><TD>                intLength = DEFAULT_INITIAL_CAPACITY;</TD></TR><TR CLASS="c"><TD CLASS="l">64</TD><TD>            dense = new Object[intLength];</TD></TR><TR CLASS="c"><TD CLASS="l">65</TD><TD>            Arrays.fill(dense, Scriptable.NOT_FOUND);</TD></TR><TR><TD CLASS="l">66</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="3e">67</A></TD><TD>        length = lengthArg;</TD></TR><TR CLASS="c"><TD CLASS="l">68</TD><TD>    }</TD></TR><TR><TD CLASS="l">69</TD><TD> </TD></TR><TR><TD CLASS="l">70</TD><TD>    public NativeArray(Object[] array)</TD></TR><TR CLASS="c"><TD CLASS="l">71</TD><TD>    {</TD></TR><TR CLASS="c"><TD CLASS="l">72</TD><TD>        denseOnly = true;</TD></TR><TR CLASS="c"><TD CLASS="l">73</TD><TD>        dense = array;</TD></TR><TR CLASS="c"><TD CLASS="l">74</TD><TD>        length = array.length;</TD></TR><TR CLASS="c"><TD CLASS="l">75</TD><TD>    }</TD></TR><TR><TD CLASS="l"><A NAME="49">76</A></TD><TD> </TD></TR><TR><TD CLASS="l">77</TD><TD>    @Override</TD></TR><TR><TD CLASS="l">78</TD><TD>    public String getClassName()</TD></TR><TR><TD CLASS="l">79</TD><TD>    {</TD></TR><TR CLASS="c"><TD CLASS="l">80</TD><TD>        return &#34;Array&#34;;</TD></TR><TR><TD CLASS="l">81</TD><TD>    }</TD></TR><TR><TD CLASS="l">82</TD><TD> </TD></TR><TR><TD CLASS="l">83</TD><TD>    private static final int</TD></TR><TR><TD CLASS="l">84</TD><TD>        Id_length        =  1,</TD></TR><TR><TD CLASS="l">85</TD><TD>        MAX_INSTANCE_ID  =  1;</TD></TR><TR><TD CLASS="l"><A NAME="50">86</A></TD><TD> </TD></TR><TR><TD CLASS="l">87</TD><TD>    @Override</TD></TR><TR><TD CLASS="l">88</TD><TD>    protected int getMaxInstanceId()</TD></TR><TR><TD CLASS="l">89</TD><TD>    {</TD></TR><TR CLASS="c"><TD CLASS="l">90</TD><TD>        return MAX_INSTANCE_ID;</TD></TR><TR><TD CLASS="l"><A NAME="1e">91</A></TD><TD>    }</TD></TR><TR><TD CLASS="l">92</TD><TD> </TD></TR><TR><TD CLASS="l">93</TD><TD>    @Override</TD></TR><TR><TD CLASS="l">94</TD><TD>    protected void setInstanceIdAttributes(int id, int attr) {</TD></TR><TR CLASS="z"><TD CLASS="l">95</TD><TD>        if (id == Id_length) {</TD></TR><TR CLASS="z"><TD CLASS="l">96</TD><TD>            lengthAttr = attr;</TD></TR><TR><TD CLASS="l">97</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">98</TD><TD>    }</TD></TR><TR><TD CLASS="l"><A NAME="44">99</A></TD><TD> </TD></TR><TR><TD CLASS="l">100</TD><TD>    @Override</TD></TR><TR><TD CLASS="l">101</TD><TD>    protected int findInstanceIdInfo(String s)</TD></TR><TR><TD CLASS="l">102</TD><TD>    {</TD></TR><TR CLASS="c"><TD CLASS="l">103</TD><TD>        if (s.equals(&#34;length&#34;)) {</TD></TR><TR CLASS="c"><TD CLASS="l">104</TD><TD>            return instanceIdInfo(lengthAttr, Id_length);</TD></TR><TR><TD CLASS="l">105</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">106</TD><TD>        return super.findInstanceIdInfo(s);</TD></TR><TR><TD CLASS="l">107</TD><TD>    }</TD></TR><TR><TD CLASS="l"><A NAME="21">108</A></TD><TD> </TD></TR><TR><TD CLASS="l">109</TD><TD>    @Override</TD></TR><TR><TD CLASS="l">110</TD><TD>    protected String getInstanceIdName(int id)</TD></TR><TR><TD CLASS="l">111</TD><TD>    {</TD></TR><TR CLASS="c"><TD CLASS="l">112</TD><TD>        if (id == Id_length) { return &#34;length&#34;; }</TD></TR><TR CLASS="z"><TD CLASS="l">113</TD><TD>        return super.getInstanceIdName(id);</TD></TR><TR><TD CLASS="l">114</TD><TD>    }</TD></TR><TR><TD CLASS="l"><A NAME="24">115</A></TD><TD> </TD></TR><TR><TD CLASS="l">116</TD><TD>    @Override</TD></TR><TR><TD CLASS="l">117</TD><TD>    protected Object getInstanceIdValue(int id)</TD></TR><TR><TD CLASS="l">118</TD><TD>    {</TD></TR><TR CLASS="c"><TD CLASS="l">119</TD><TD>        if (id == Id_length) {</TD></TR><TR CLASS="c"><TD CLASS="l">120</TD><TD>            return ScriptRuntime.wrapNumber(length);</TD></TR><TR><TD CLASS="l">121</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">122</TD><TD>        return super.getInstanceIdValue(id);</TD></TR><TR><TD CLASS="l">123</TD><TD>    }</TD></TR><TR><TD CLASS="l"><A NAME="23">124</A></TD><TD> </TD></TR><TR><TD CLASS="l">125</TD><TD>    @Override</TD></TR><TR><TD CLASS="l">126</TD><TD>    protected void setInstanceIdValue(int id, Object value)</TD></TR><TR><TD CLASS="l">127</TD><TD>    {</TD></TR><TR CLASS="c"><TD CLASS="l">128</TD><TD>        if (id == Id_length) {</TD></TR><TR CLASS="c"><TD CLASS="l">129</TD><TD>            setLength(value); return;</TD></TR><TR><TD CLASS="l">130</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">131</TD><TD>        super.setInstanceIdValue(id, value);</TD></TR><TR CLASS="z"><TD CLASS="l">132</TD><TD>    }</TD></TR><TR><TD CLASS="l"><A NAME="43">133</A></TD><TD> </TD></TR><TR><TD CLASS="l">134</TD><TD>    @Override</TD></TR><TR><TD CLASS="l">135</TD><TD>    protected void fillConstructorProperties(IdFunctionObject ctor)</TD></TR><TR><TD CLASS="l">136</TD><TD>    {</TD></TR><TR CLASS="c"><TD CLASS="l">137</TD><TD>        addIdFunctionProperty(ctor, ARRAY_TAG, ConstructorId_join,</TD></TR><TR><TD CLASS="l">138</TD><TD>                &#34;join&#34;, 1);</TD></TR><TR CLASS="c"><TD CLASS="l">139</TD><TD>        addIdFunctionProperty(ctor, ARRAY_TAG, ConstructorId_reverse,</TD></TR><TR><TD CLASS="l">140</TD><TD>                &#34;reverse&#34;, 0);</TD></TR><TR CLASS="c"><TD CLASS="l">141</TD><TD>        addIdFunctionProperty(ctor, ARRAY_TAG, ConstructorId_sort,</TD></TR><TR><TD CLASS="l">142</TD><TD>                &#34;sort&#34;, 1);</TD></TR><TR CLASS="c"><TD CLASS="l">143</TD><TD>        addIdFunctionProperty(ctor, ARRAY_TAG, ConstructorId_push,</TD></TR><TR><TD CLASS="l">144</TD><TD>                &#34;push&#34;, 1);</TD></TR><TR CLASS="c"><TD CLASS="l">145</TD><TD>        addIdFunctionProperty(ctor, ARRAY_TAG, ConstructorId_pop,</TD></TR><TR><TD CLASS="l">146</TD><TD>                &#34;pop&#34;, 0);</TD></TR><TR CLASS="c"><TD CLASS="l">147</TD><TD>        addIdFunctionProperty(ctor, ARRAY_TAG, ConstructorId_shift,</TD></TR><TR><TD CLASS="l">148</TD><TD>                &#34;shift&#34;, 0);</TD></TR><TR CLASS="c"><TD CLASS="l">149</TD><TD>        addIdFunctionProperty(ctor, ARRAY_TAG, ConstructorId_unshift,</TD></TR><TR><TD CLASS="l">150</TD><TD>                &#34;unshift&#34;, 1);</TD></TR><TR CLASS="c"><TD CLASS="l">151</TD><TD>        addIdFunctionProperty(ctor, ARRAY_TAG, ConstructorId_splice,</TD></TR><TR><TD CLASS="l">152</TD><TD>                &#34;splice&#34;, 2);</TD></TR><TR CLASS="c"><TD CLASS="l">153</TD><TD>        addIdFunctionProperty(ctor, ARRAY_TAG, ConstructorId_concat,</TD></TR><TR><TD CLASS="l">154</TD><TD>                &#34;concat&#34;, 1);</TD></TR><TR CLASS="c"><TD CLASS="l">155</TD><TD>        addIdFunctionProperty(ctor, ARRAY_TAG, ConstructorId_slice,</TD></TR><TR><TD CLASS="l">156</TD><TD>                &#34;slice&#34;, 2);</TD></TR><TR CLASS="c"><TD CLASS="l">157</TD><TD>        addIdFunctionProperty(ctor, ARRAY_TAG, ConstructorId_indexOf,</TD></TR><TR><TD CLASS="l">158</TD><TD>                &#34;indexOf&#34;, 1);</TD></TR><TR CLASS="c"><TD CLASS="l">159</TD><TD>        addIdFunctionProperty(ctor, ARRAY_TAG, ConstructorId_lastIndexOf,</TD></TR><TR><TD CLASS="l">160</TD><TD>                &#34;lastIndexOf&#34;, 1);</TD></TR><TR CLASS="c"><TD CLASS="l">161</TD><TD>        addIdFunctionProperty(ctor, ARRAY_TAG, ConstructorId_every,</TD></TR><TR><TD CLASS="l">162</TD><TD>                &#34;every&#34;, 1);</TD></TR><TR CLASS="c"><TD CLASS="l">163</TD><TD>        addIdFunctionProperty(ctor, ARRAY_TAG, ConstructorId_filter,</TD></TR><TR><TD CLASS="l">164</TD><TD>                &#34;filter&#34;, 1);</TD></TR><TR CLASS="c"><TD CLASS="l">165</TD><TD>        addIdFunctionProperty(ctor, ARRAY_TAG, ConstructorId_forEach,</TD></TR><TR><TD CLASS="l">166</TD><TD>                &#34;forEach&#34;, 1);</TD></TR><TR CLASS="c"><TD CLASS="l">167</TD><TD>        addIdFunctionProperty(ctor, ARRAY_TAG, ConstructorId_map,</TD></TR><TR><TD CLASS="l">168</TD><TD>                &#34;map&#34;, 1);</TD></TR><TR CLASS="c"><TD CLASS="l">169</TD><TD>        addIdFunctionProperty(ctor, ARRAY_TAG, ConstructorId_some,</TD></TR><TR><TD CLASS="l">170</TD><TD>                &#34;some&#34;, 1);</TD></TR><TR CLASS="c"><TD CLASS="l">171</TD><TD>        addIdFunctionProperty(ctor, ARRAY_TAG, ConstructorId_reduce,</TD></TR><TR><TD CLASS="l">172</TD><TD>                &#34;reduce&#34;, 1);</TD></TR><TR CLASS="c"><TD CLASS="l">173</TD><TD>        addIdFunctionProperty(ctor, ARRAY_TAG, ConstructorId_reduceRight,</TD></TR><TR><TD CLASS="l">174</TD><TD>                &#34;reduceRight&#34;, 1);</TD></TR><TR CLASS="c"><TD CLASS="l">175</TD><TD>        addIdFunctionProperty(ctor, ARRAY_TAG, ConstructorId_isArray,</TD></TR><TR><TD CLASS="l">176</TD><TD>                &#34;isArray&#34;, 1);</TD></TR><TR CLASS="c"><TD CLASS="l">177</TD><TD>        super.fillConstructorProperties(ctor);</TD></TR><TR CLASS="c"><TD CLASS="l">178</TD><TD>    }</TD></TR><TR><TD CLASS="l">179</TD><TD> </TD></TR><TR><TD CLASS="l">180</TD><TD>    @Override</TD></TR><TR><TD CLASS="l"><A NAME="37">181</A></TD><TD>    protected void initPrototypeId(int id)</TD></TR><TR><TD CLASS="l">182</TD><TD>    {</TD></TR><TR><TD CLASS="l">183</TD><TD>        String s;</TD></TR><TR><TD CLASS="l">184</TD><TD>        int arity;</TD></TR><TR CLASS="c"><TD CLASS="l">185</TD><TD>        switch (id) {</TD></TR><TR CLASS="c"><TD CLASS="l">186</TD><TD>          case Id_constructor:    arity=1; s=&#34;constructor&#34;;    break;</TD></TR><TR CLASS="c"><TD CLASS="l">187</TD><TD>          case Id_toString:       arity=0; s=&#34;toString&#34;;       break;</TD></TR><TR CLASS="c"><TD CLASS="l">188</TD><TD>          case Id_toLocaleString: arity=0; s=&#34;toLocaleString&#34;; break;</TD></TR><TR CLASS="c"><TD CLASS="l">189</TD><TD>          case Id_toSource:       arity=0; s=&#34;toSource&#34;;       break;</TD></TR><TR CLASS="c"><TD CLASS="l">190</TD><TD>          case Id_join:           arity=1; s=&#34;join&#34;;           break;</TD></TR><TR CLASS="c"><TD CLASS="l">191</TD><TD>          case Id_reverse:        arity=0; s=&#34;reverse&#34;;        break;</TD></TR><TR CLASS="c"><TD CLASS="l">192</TD><TD>          case Id_sort:           arity=1; s=&#34;sort&#34;;           break;</TD></TR><TR CLASS="c"><TD CLASS="l">193</TD><TD>          case Id_push:           arity=1; s=&#34;push&#34;;           break;</TD></TR><TR CLASS="c"><TD CLASS="l">194</TD><TD>          case Id_pop:            arity=0; s=&#34;pop&#34;;            break;</TD></TR><TR CLASS="c"><TD CLASS="l">195</TD><TD>          case Id_shift:          arity=0; s=&#34;shift&#34;;          break;</TD></TR><TR CLASS="c"><TD CLASS="l">196</TD><TD>          case Id_unshift:        arity=1; s=&#34;unshift&#34;;        break;</TD></TR><TR CLASS="c"><TD CLASS="l">197</TD><TD>          case Id_splice:         arity=2; s=&#34;splice&#34;;         break;</TD></TR><TR CLASS="c"><TD CLASS="l">198</TD><TD>          case Id_concat:         arity=1; s=&#34;concat&#34;;         break;</TD></TR><TR CLASS="c"><TD CLASS="l">199</TD><TD>          case Id_slice:          arity=2; s=&#34;slice&#34;;          break;</TD></TR><TR CLASS="c"><TD CLASS="l">200</TD><TD>          case Id_indexOf:        arity=1; s=&#34;indexOf&#34;;        break;</TD></TR><TR CLASS="c"><TD CLASS="l">201</TD><TD>          case Id_lastIndexOf:    arity=1; s=&#34;lastIndexOf&#34;;    break;</TD></TR><TR CLASS="c"><TD CLASS="l">202</TD><TD>          case Id_every:          arity=1; s=&#34;every&#34;;          break;</TD></TR><TR CLASS="c"><TD CLASS="l">203</TD><TD>          case Id_filter:         arity=1; s=&#34;filter&#34;;         break;</TD></TR><TR CLASS="c"><TD CLASS="l">204</TD><TD>          case Id_forEach:        arity=1; s=&#34;forEach&#34;;        break;</TD></TR><TR CLASS="c"><TD CLASS="l">205</TD><TD>          case Id_map:            arity=1; s=&#34;map&#34;;            break;</TD></TR><TR CLASS="c"><TD CLASS="l">206</TD><TD>          case Id_some:           arity=1; s=&#34;some&#34;;           break;</TD></TR><TR CLASS="c"><TD CLASS="l">207</TD><TD>          case Id_reduce:         arity=1; s=&#34;reduce&#34;;         break;</TD></TR><TR CLASS="c"><TD CLASS="l">208</TD><TD>          case Id_reduceRight:    arity=1; s=&#34;reduceRight&#34;;    break;</TD></TR><TR CLASS="z"><TD CLASS="l">209</TD><TD>          default: throw new IllegalArgumentException(String.valueOf(id));</TD></TR><TR><TD CLASS="l">210</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">211</TD><TD>        initPrototypeMethod(ARRAY_TAG, id, s, arity);</TD></TR><TR CLASS="c"><TD CLASS="l">212</TD><TD>    }</TD></TR><TR><TD CLASS="l">213</TD><TD> </TD></TR><TR><TD CLASS="l"><A NAME="32">214</A></TD><TD>    @Override</TD></TR><TR><TD CLASS="l">215</TD><TD>    public Object execIdCall(IdFunctionObject f, Context cx, Scriptable scope,</TD></TR><TR><TD CLASS="l">216</TD><TD>                             Scriptable thisObj, Object[] args)</TD></TR><TR><TD CLASS="l">217</TD><TD>    {</TD></TR><TR CLASS="c"><TD CLASS="l">218</TD><TD>        if (!f.hasTag(ARRAY_TAG)) {</TD></TR><TR CLASS="z"><TD CLASS="l">219</TD><TD>            return super.execIdCall(f, cx, scope, thisObj, args);</TD></TR><TR><TD CLASS="l">220</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">221</TD><TD>        int id = f.methodId();</TD></TR><TR><TD CLASS="l">222</TD><TD>      again:</TD></TR><TR><TD CLASS="l">223</TD><TD>        for (;;) {</TD></TR><TR CLASS="c"><TD CLASS="l">224</TD><TD>            switch (id) {</TD></TR><TR><TD CLASS="l">225</TD><TD>              case ConstructorId_join:</TD></TR><TR><TD CLASS="l">226</TD><TD>              case ConstructorId_reverse:</TD></TR><TR><TD CLASS="l">227</TD><TD>              case ConstructorId_sort:</TD></TR><TR><TD CLASS="l">228</TD><TD>              case ConstructorId_push:</TD></TR><TR><TD CLASS="l">229</TD><TD>              case ConstructorId_pop:</TD></TR><TR><TD CLASS="l">230</TD><TD>              case ConstructorId_shift:</TD></TR><TR><TD CLASS="l">231</TD><TD>              case ConstructorId_unshift:</TD></TR><TR><TD CLASS="l">232</TD><TD>              case ConstructorId_splice:</TD></TR><TR><TD CLASS="l">233</TD><TD>              case ConstructorId_concat:</TD></TR><TR><TD CLASS="l">234</TD><TD>              case ConstructorId_slice:</TD></TR><TR><TD CLASS="l">235</TD><TD>              case ConstructorId_indexOf:</TD></TR><TR><TD CLASS="l">236</TD><TD>              case ConstructorId_lastIndexOf:</TD></TR><TR><TD CLASS="l">237</TD><TD>              case ConstructorId_every:</TD></TR><TR><TD CLASS="l">238</TD><TD>              case ConstructorId_filter:</TD></TR><TR><TD CLASS="l">239</TD><TD>              case ConstructorId_forEach:</TD></TR><TR><TD CLASS="l">240</TD><TD>              case ConstructorId_map:</TD></TR><TR><TD CLASS="l">241</TD><TD>              case ConstructorId_some:</TD></TR><TR><TD CLASS="l">242</TD><TD>              case ConstructorId_reduce:</TD></TR><TR><TD CLASS="l">243</TD><TD>              case ConstructorId_reduceRight: {</TD></TR><TR CLASS="c"><TD CLASS="l">244</TD><TD>                if (args.length &gt; 0) {</TD></TR><TR CLASS="c"><TD CLASS="l">245</TD><TD>                    thisObj = ScriptRuntime.toObject(scope, args[0]);</TD></TR><TR CLASS="c"><TD CLASS="l">246</TD><TD>                    Object[] newArgs = new Object[args.length-1];</TD></TR><TR CLASS="c"><TD CLASS="l">247</TD><TD>                    for (int i=0; i &lt; newArgs.length; i++)</TD></TR><TR CLASS="c"><TD CLASS="l">248</TD><TD>                        newArgs[i] = args[i+1];</TD></TR><TR CLASS="c"><TD CLASS="l">249</TD><TD>                    args = newArgs;</TD></TR><TR><TD CLASS="l">250</TD><TD>                }</TD></TR><TR CLASS="c"><TD CLASS="l">251</TD><TD>                id = -id;</TD></TR><TR CLASS="c"><TD CLASS="l">252</TD><TD>                continue again;</TD></TR><TR><TD CLASS="l">253</TD><TD>              }</TD></TR><TR><TD CLASS="l">254</TD><TD> </TD></TR><TR><TD CLASS="l">255</TD><TD>              case ConstructorId_isArray:</TD></TR><TR CLASS="c"><TD CLASS="l">256</TD><TD>                return args.length &gt; 0 &amp;&amp; (args[0] instanceof NativeArray);</TD></TR><TR><TD CLASS="l">257</TD><TD> </TD></TR><TR><TD CLASS="l">258</TD><TD>              case Id_constructor: {</TD></TR><TR CLASS="c"><TD CLASS="l">259</TD><TD>                boolean inNewExpr = (thisObj == null);</TD></TR><TR CLASS="c"><TD CLASS="l">260</TD><TD>                if (!inNewExpr) {</TD></TR><TR><TD CLASS="l">261</TD><TD>                    // IdFunctionObject.construct will set up parent, proto</TD></TR><TR CLASS="c"><TD CLASS="l">262</TD><TD>                    return f.construct(cx, scope, args);</TD></TR><TR><TD CLASS="l">263</TD><TD>                }</TD></TR><TR CLASS="c"><TD CLASS="l">264</TD><TD>                return jsConstructor(cx, scope, args);</TD></TR><TR><TD CLASS="l">265</TD><TD>              }</TD></TR><TR><TD CLASS="l">266</TD><TD> </TD></TR><TR><TD CLASS="l">267</TD><TD>              case Id_toString:</TD></TR><TR CLASS="c"><TD CLASS="l">268</TD><TD>                return toStringHelper(cx, scope, thisObj,</TD></TR><TR><TD CLASS="l">269</TD><TD>                    cx.hasFeature(Context.FEATURE_TO_STRING_AS_SOURCE), false);</TD></TR><TR><TD CLASS="l">270</TD><TD> </TD></TR><TR><TD CLASS="l">271</TD><TD>              case Id_toLocaleString:</TD></TR><TR CLASS="c"><TD CLASS="l">272</TD><TD>                return toStringHelper(cx, scope, thisObj, false, true);</TD></TR><TR><TD CLASS="l">273</TD><TD> </TD></TR><TR><TD CLASS="l">274</TD><TD>              case Id_toSource:</TD></TR><TR CLASS="c"><TD CLASS="l">275</TD><TD>                return toStringHelper(cx, scope, thisObj, true, false);</TD></TR><TR><TD CLASS="l">276</TD><TD> </TD></TR><TR><TD CLASS="l">277</TD><TD>              case Id_join:</TD></TR><TR CLASS="c"><TD CLASS="l">278</TD><TD>                return js_join(cx, thisObj, args);</TD></TR><TR><TD CLASS="l">279</TD><TD> </TD></TR><TR><TD CLASS="l">280</TD><TD>              case Id_reverse:</TD></TR><TR CLASS="c"><TD CLASS="l">281</TD><TD>                return js_reverse(cx, thisObj, args);</TD></TR><TR><TD CLASS="l">282</TD><TD> </TD></TR><TR><TD CLASS="l">283</TD><TD>              case Id_sort:</TD></TR><TR CLASS="c"><TD CLASS="l">284</TD><TD>                return js_sort(cx, scope, thisObj, args);</TD></TR><TR><TD CLASS="l">285</TD><TD> </TD></TR><TR><TD CLASS="l">286</TD><TD>              case Id_push:</TD></TR><TR CLASS="c"><TD CLASS="l">287</TD><TD>                return js_push(cx, thisObj, args);</TD></TR><TR><TD CLASS="l">288</TD><TD> </TD></TR><TR><TD CLASS="l">289</TD><TD>              case Id_pop:</TD></TR><TR CLASS="c"><TD CLASS="l">290</TD><TD>                return js_pop(cx, thisObj, args);</TD></TR><TR><TD CLASS="l">291</TD><TD> </TD></TR><TR><TD CLASS="l">292</TD><TD>              case Id_shift:</TD></TR><TR CLASS="c"><TD CLASS="l">293</TD><TD>                return js_shift(cx, thisObj, args);</TD></TR><TR><TD CLASS="l">294</TD><TD> </TD></TR><TR><TD CLASS="l">295</TD><TD>              case Id_unshift:</TD></TR><TR CLASS="c"><TD CLASS="l">296</TD><TD>                return js_unshift(cx, thisObj, args);</TD></TR><TR><TD CLASS="l">297</TD><TD> </TD></TR><TR><TD CLASS="l">298</TD><TD>              case Id_splice:</TD></TR><TR CLASS="c"><TD CLASS="l">299</TD><TD>                return js_splice(cx, scope, thisObj, args);</TD></TR><TR><TD CLASS="l">300</TD><TD> </TD></TR><TR><TD CLASS="l">301</TD><TD>              case Id_concat:</TD></TR><TR CLASS="c"><TD CLASS="l">302</TD><TD>                return js_concat(cx, scope, thisObj, args);</TD></TR><TR><TD CLASS="l">303</TD><TD> </TD></TR><TR><TD CLASS="l">304</TD><TD>              case Id_slice:</TD></TR><TR CLASS="c"><TD CLASS="l">305</TD><TD>                return js_slice(cx, thisObj, args);</TD></TR><TR><TD CLASS="l">306</TD><TD> </TD></TR><TR><TD CLASS="l">307</TD><TD>              case Id_indexOf:</TD></TR><TR CLASS="c"><TD CLASS="l">308</TD><TD>                return indexOfHelper(cx, thisObj, args, false);</TD></TR><TR><TD CLASS="l">309</TD><TD> </TD></TR><TR><TD CLASS="l">310</TD><TD>              case Id_lastIndexOf:</TD></TR><TR CLASS="c"><TD CLASS="l">311</TD><TD>                return indexOfHelper(cx, thisObj, args, true);</TD></TR><TR><TD CLASS="l">312</TD><TD> </TD></TR><TR><TD CLASS="l">313</TD><TD>              case Id_every:</TD></TR><TR><TD CLASS="l">314</TD><TD>              case Id_filter:</TD></TR><TR><TD CLASS="l">315</TD><TD>              case Id_forEach:</TD></TR><TR><TD CLASS="l">316</TD><TD>              case Id_map:</TD></TR><TR><TD CLASS="l">317</TD><TD>              case Id_some:</TD></TR><TR CLASS="c"><TD CLASS="l">318</TD><TD>                return iterativeMethod(cx, id, scope, thisObj, args);</TD></TR><TR><TD CLASS="l">319</TD><TD>              case Id_reduce:</TD></TR><TR><TD CLASS="l">320</TD><TD>              case Id_reduceRight:</TD></TR><TR CLASS="c"><TD CLASS="l">321</TD><TD>                return reduceMethod(cx, id, scope, thisObj, args);</TD></TR><TR><TD CLASS="l">322</TD><TD>            }</TD></TR><TR CLASS="z"><TD CLASS="l">323</TD><TD>            throw new IllegalArgumentException(String.valueOf(id));</TD></TR><TR><TD CLASS="l">324</TD><TD>        }</TD></TR><TR><TD CLASS="l">325</TD><TD>    }</TD></TR><TR><TD CLASS="l"><A NAME="47">326</A></TD><TD> </TD></TR><TR><TD CLASS="l">327</TD><TD>    @Override</TD></TR><TR><TD CLASS="l">328</TD><TD>    public Object get(int index, Scriptable start)</TD></TR><TR><TD CLASS="l">329</TD><TD>    {</TD></TR><TR CLASS="c"><TD CLASS="l">330</TD><TD>        if (!denseOnly &amp;&amp; isGetterOrSetter(null, index, false))</TD></TR><TR CLASS="c"><TD CLASS="l">331</TD><TD>            return super.get(index, start);</TD></TR><TR CLASS="c"><TD CLASS="l">332</TD><TD>        if (dense != null &amp;&amp; 0 &lt;= index &amp;&amp; index &lt; dense.length)</TD></TR><TR CLASS="c"><TD CLASS="l">333</TD><TD>            return dense[index];</TD></TR><TR CLASS="c"><TD CLASS="l">334</TD><TD>        return super.get(index, start);</TD></TR><TR><TD CLASS="l">335</TD><TD>    }</TD></TR><TR><TD CLASS="l"><A NAME="53">336</A></TD><TD> </TD></TR><TR><TD CLASS="l">337</TD><TD>    @Override</TD></TR><TR><TD CLASS="l">338</TD><TD>    public boolean has(int index, Scriptable start)</TD></TR><TR><TD CLASS="l">339</TD><TD>    {</TD></TR><TR CLASS="c"><TD CLASS="l">340</TD><TD>        if (!denseOnly &amp;&amp; isGetterOrSetter(null, index, false))</TD></TR><TR CLASS="c"><TD CLASS="l">341</TD><TD>            return super.has(index, start);</TD></TR><TR CLASS="c"><TD CLASS="l">342</TD><TD>        if (dense != null &amp;&amp; 0 &lt;= index &amp;&amp; index &lt; dense.length)</TD></TR><TR CLASS="c"><TD CLASS="l">343</TD><TD>            return dense[index] != NOT_FOUND;</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="2e">344</A></TD><TD>        return super.has(index, start);</TD></TR><TR><TD CLASS="l">345</TD><TD>    }</TD></TR><TR><TD CLASS="l">346</TD><TD> </TD></TR><TR><TD CLASS="l">347</TD><TD>    private static long toArrayIndex(Object id) {</TD></TR><TR CLASS="c"><TD CLASS="l">348</TD><TD>        if (id instanceof String) {</TD></TR><TR CLASS="c"><TD CLASS="l">349</TD><TD>            return toArrayIndex((String)id);</TD></TR><TR CLASS="c"><TD CLASS="l">350</TD><TD>        } else if (id instanceof Number) {</TD></TR><TR CLASS="c"><TD CLASS="l">351</TD><TD>            return toArrayIndex(((Number)id).doubleValue());</TD></TR><TR><TD CLASS="l">352</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">353</TD><TD>        return -1;</TD></TR><TR><TD CLASS="l">354</TD><TD>    }</TD></TR><TR><TD CLASS="l">355</TD><TD> </TD></TR><TR><TD CLASS="l"><A NAME="61">356</A></TD><TD>    // if id is an array index (ECMA 15.4.0), return the number,</TD></TR><TR><TD CLASS="l">357</TD><TD>    // otherwise return -1L</TD></TR><TR><TD CLASS="l">358</TD><TD>    private static long toArrayIndex(String id)</TD></TR><TR><TD CLASS="l">359</TD><TD>    {</TD></TR><TR CLASS="c"><TD CLASS="l">360</TD><TD>        long index = toArrayIndex(ScriptRuntime.toNumber(id));</TD></TR><TR><TD CLASS="l">361</TD><TD>        // Assume that ScriptRuntime.toString(index) is the same</TD></TR><TR><TD CLASS="l">362</TD><TD>        // as java.lang.Long.toString(index) for long</TD></TR><TR CLASS="c"><TD CLASS="l">363</TD><TD>        if (Long.toString(index).equals(id)) {</TD></TR><TR CLASS="c"><TD CLASS="l">364</TD><TD>            return index;</TD></TR><TR><TD CLASS="l">365</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="62">366</A></TD><TD>        return -1;</TD></TR><TR><TD CLASS="l">367</TD><TD>    }</TD></TR><TR><TD CLASS="l">368</TD><TD> </TD></TR><TR><TD CLASS="l">369</TD><TD>    private static long toArrayIndex(double d) {</TD></TR><TR CLASS="c"><TD CLASS="l">370</TD><TD>        if (d == d) {</TD></TR><TR CLASS="c"><TD CLASS="l">371</TD><TD>            long index = ScriptRuntime.toUint32(d);</TD></TR><TR CLASS="c"><TD CLASS="l">372</TD><TD>            if (index == d &amp;&amp; index != 4294967295L) {</TD></TR><TR CLASS="c"><TD CLASS="l">373</TD><TD>                return index;</TD></TR><TR><TD CLASS="l">374</TD><TD>            }</TD></TR><TR><TD CLASS="l">375</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="63">376</A></TD><TD>        return -1;</TD></TR><TR><TD CLASS="l">377</TD><TD>    }</TD></TR><TR><TD CLASS="l">378</TD><TD> </TD></TR><TR><TD CLASS="l">379</TD><TD>    private static int toDenseIndex(Object id) {</TD></TR><TR CLASS="c"><TD CLASS="l">380</TD><TD>      long index = toArrayIndex(id);</TD></TR><TR CLASS="c"><TD CLASS="l">381</TD><TD>      return 0 &lt;= index &amp;&amp; index &lt; Integer.MAX_VALUE ? (int) index : -1;</TD></TR><TR><TD CLASS="l">382</TD><TD>    }</TD></TR><TR><TD CLASS="l"><A NAME="5a">383</A></TD><TD> </TD></TR><TR><TD CLASS="l">384</TD><TD>    @Override</TD></TR><TR><TD CLASS="l">385</TD><TD>    public void put(String id, Scriptable start, Object value)</TD></TR><TR><TD CLASS="l">386</TD><TD>    {</TD></TR><TR CLASS="c"><TD CLASS="l">387</TD><TD>        super.put(id, start, value);</TD></TR><TR CLASS="c"><TD CLASS="l">388</TD><TD>        if (start == this) {</TD></TR><TR><TD CLASS="l">389</TD><TD>            // If the object is sealed, super will throw exception</TD></TR><TR CLASS="c"><TD CLASS="l">390</TD><TD>            long index = toArrayIndex(id);</TD></TR><TR CLASS="c"><TD CLASS="l">391</TD><TD>            if (index &gt;= length) {</TD></TR><TR CLASS="c"><TD CLASS="l">392</TD><TD>                length = index + 1;</TD></TR><TR CLASS="c"><TD CLASS="l">393</TD><TD>                denseOnly = false;</TD></TR><TR><TD CLASS="l">394</TD><TD>            }</TD></TR><TR><TD CLASS="l">395</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="30">396</A></TD><TD>    }</TD></TR><TR><TD CLASS="l">397</TD><TD> </TD></TR><TR><TD CLASS="l">398</TD><TD>    private boolean ensureCapacity(int capacity)</TD></TR><TR><TD CLASS="l">399</TD><TD>    {</TD></TR><TR CLASS="c"><TD CLASS="l">400</TD><TD>        if (capacity &gt; dense.length) {</TD></TR><TR CLASS="c"><TD CLASS="l">401</TD><TD>            if (capacity &gt; MAX_PRE_GROW_SIZE) {</TD></TR><TR CLASS="z"><TD CLASS="l">402</TD><TD>                denseOnly = false;</TD></TR><TR CLASS="z"><TD CLASS="l">403</TD><TD>                return false;</TD></TR><TR><TD CLASS="l">404</TD><TD>            }</TD></TR><TR CLASS="c"><TD CLASS="l">405</TD><TD>            capacity = Math.max(capacity, (int)(dense.length * GROW_FACTOR));</TD></TR><TR CLASS="c"><TD CLASS="l">406</TD><TD>            Object[] newDense = new Object[capacity];</TD></TR><TR CLASS="c"><TD CLASS="l">407</TD><TD>            System.arraycopy(dense, 0, newDense, 0, dense.length);</TD></TR><TR CLASS="c"><TD CLASS="l">408</TD><TD>            Arrays.fill(newDense, dense.length, newDense.length,</TD></TR><TR><TD CLASS="l">409</TD><TD>                        Scriptable.NOT_FOUND);</TD></TR><TR CLASS="c"><TD CLASS="l">410</TD><TD>            dense = newDense;</TD></TR><TR><TD CLASS="l">411</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">412</TD><TD>        return true;</TD></TR><TR><TD CLASS="l">413</TD><TD>    }</TD></TR><TR><TD CLASS="l"><A NAME="5b">414</A></TD><TD> </TD></TR><TR><TD CLASS="l">415</TD><TD>    @Override</TD></TR><TR><TD CLASS="l">416</TD><TD>    public void put(int index, Scriptable start, Object value)</TD></TR><TR><TD CLASS="l">417</TD><TD>    {</TD></TR><TR CLASS="c"><TD CLASS="l">418</TD><TD>        if (start == this &amp;&amp; !isSealed() &amp;&amp; dense != null &amp;&amp; 0 &lt;= index &amp;&amp;</TD></TR><TR><TD CLASS="l">419</TD><TD>            (denseOnly || !isGetterOrSetter(null, index, true)))</TD></TR><TR><TD CLASS="l">420</TD><TD>        {</TD></TR><TR CLASS="c"><TD CLASS="l">421</TD><TD>            if (index &lt; dense.length) {</TD></TR><TR CLASS="c"><TD CLASS="l">422</TD><TD>                dense[index] = value;</TD></TR><TR CLASS="c"><TD CLASS="l">423</TD><TD>                if (this.length &lt;= index)</TD></TR><TR CLASS="c"><TD CLASS="l">424</TD><TD>                    this.length = (long)index + 1;</TD></TR><TR CLASS="c"><TD CLASS="l">425</TD><TD>                return;</TD></TR><TR CLASS="c"><TD CLASS="l">426</TD><TD>            } else if (denseOnly &amp;&amp; index &lt; dense.length * GROW_FACTOR &amp;&amp;</TD></TR><TR><TD CLASS="l">427</TD><TD>                       ensureCapacity(index+1))</TD></TR><TR><TD CLASS="l">428</TD><TD>            {</TD></TR><TR CLASS="c"><TD CLASS="l">429</TD><TD>                dense[index] = value;</TD></TR><TR CLASS="c"><TD CLASS="l">430</TD><TD>                this.length = (long)index + 1;</TD></TR><TR CLASS="c"><TD CLASS="l">431</TD><TD>                return;</TD></TR><TR><TD CLASS="l">432</TD><TD>            } else {</TD></TR><TR CLASS="c"><TD CLASS="l">433</TD><TD>                denseOnly = false;</TD></TR><TR><TD CLASS="l">434</TD><TD>            }</TD></TR><TR><TD CLASS="l">435</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">436</TD><TD>        super.put(index, start, value);</TD></TR><TR CLASS="c"><TD CLASS="l">437</TD><TD>        if (start == this &amp;&amp; (lengthAttr &amp; READONLY) == 0) {</TD></TR><TR><TD CLASS="l">438</TD><TD>            // only set the array length if given an array index (ECMA 15.4.0)</TD></TR><TR CLASS="c"><TD CLASS="l">439</TD><TD>            if (this.length &lt;= index) {</TD></TR><TR><TD CLASS="l">440</TD><TD>                // avoid overflowing index!</TD></TR><TR CLASS="c"><TD CLASS="l">441</TD><TD>                this.length = (long)index + 1;</TD></TR><TR><TD CLASS="l">442</TD><TD>            }</TD></TR><TR><TD CLASS="l">443</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">444</TD><TD>    }</TD></TR><TR><TD CLASS="l"><A NAME="41">445</A></TD><TD> </TD></TR><TR><TD CLASS="l">446</TD><TD>    @Override</TD></TR><TR><TD CLASS="l">447</TD><TD>    public void delete(int index)</TD></TR><TR><TD CLASS="l">448</TD><TD>    {</TD></TR><TR CLASS="c"><TD CLASS="l">449</TD><TD>        if (dense != null &amp;&amp; 0 &lt;= index &amp;&amp; index &lt; dense.length &amp;&amp;</TD></TR><TR><TD CLASS="l">450</TD><TD>            !isSealed() &amp;&amp; (denseOnly || !isGetterOrSetter(null, index, true)))</TD></TR><TR><TD CLASS="l">451</TD><TD>        {</TD></TR><TR CLASS="c"><TD CLASS="l">452</TD><TD>            dense[index] = NOT_FOUND;</TD></TR><TR><TD CLASS="l">453</TD><TD>        } else {</TD></TR><TR CLASS="c"><TD CLASS="l">454</TD><TD>            super.delete(index);</TD></TR><TR><TD CLASS="l">455</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">456</TD><TD>    }</TD></TR><TR><TD CLASS="l"><A NAME="4c">457</A></TD><TD> </TD></TR><TR><TD CLASS="l">458</TD><TD>    @Override</TD></TR><TR><TD CLASS="l">459</TD><TD>    public Object[] getIds()</TD></TR><TR><TD CLASS="l">460</TD><TD>    {</TD></TR><TR CLASS="c"><TD CLASS="l">461</TD><TD>        Object[] superIds = super.getIds();</TD></TR><TR CLASS="c"><TD CLASS="l">462</TD><TD>        if (dense == null) { return superIds; }</TD></TR><TR CLASS="c"><TD CLASS="l">463</TD><TD>        int N = dense.length;</TD></TR><TR CLASS="c"><TD CLASS="l">464</TD><TD>        long currentLength = length;</TD></TR><TR CLASS="c"><TD CLASS="l">465</TD><TD>        if (N &gt; currentLength) {</TD></TR><TR CLASS="c"><TD CLASS="l">466</TD><TD>            N = (int)currentLength;</TD></TR><TR><TD CLASS="l">467</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">468</TD><TD>        if (N == 0) { return superIds; }</TD></TR><TR CLASS="c"><TD CLASS="l">469</TD><TD>        int superLength = superIds.length;</TD></TR><TR CLASS="c"><TD CLASS="l">470</TD><TD>        Object[] ids = new Object[N + superLength];</TD></TR><TR><TD CLASS="l">471</TD><TD> </TD></TR><TR CLASS="c"><TD CLASS="l">472</TD><TD>        int presentCount = 0;</TD></TR><TR CLASS="c"><TD CLASS="l">473</TD><TD>        for (int i = 0; i != N; ++i) {</TD></TR><TR><TD CLASS="l">474</TD><TD>            // Replace existing elements by their indexes</TD></TR><TR CLASS="c"><TD CLASS="l">475</TD><TD>            if (dense[i] != NOT_FOUND) {</TD></TR><TR CLASS="c"><TD CLASS="l">476</TD><TD>                ids[presentCount] = Integer.valueOf(i);</TD></TR><TR CLASS="c"><TD CLASS="l">477</TD><TD>                ++presentCount;</TD></TR><TR><TD CLASS="l">478</TD><TD>            }</TD></TR><TR><TD CLASS="l">479</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">480</TD><TD>        if (presentCount != N) {</TD></TR><TR><TD CLASS="l">481</TD><TD>            // dense contains deleted elems, need to shrink the result</TD></TR><TR CLASS="c"><TD CLASS="l">482</TD><TD>            Object[] tmp = new Object[presentCount + superLength];</TD></TR><TR CLASS="c"><TD CLASS="l">483</TD><TD>            System.arraycopy(ids, 0, tmp, 0, presentCount);</TD></TR><TR CLASS="c"><TD CLASS="l">484</TD><TD>            ids = tmp;</TD></TR><TR><TD CLASS="l">485</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">486</TD><TD>        System.arraycopy(superIds, 0, ids, presentCount, superLength);</TD></TR><TR CLASS="c"><TD CLASS="l">487</TD><TD>        return ids;</TD></TR><TR><TD CLASS="l">488</TD><TD>    }</TD></TR><TR><TD CLASS="l"><A NAME="48">489</A></TD><TD> </TD></TR><TR><TD CLASS="l">490</TD><TD>    @Override</TD></TR><TR><TD CLASS="l">491</TD><TD>    public Object[] getAllIds()</TD></TR><TR><TD CLASS="l">492</TD><TD>    {</TD></TR><TR CLASS="c"><TD CLASS="l">493</TD><TD>      Set&lt;Object&gt; allIds = new LinkedHashSet&lt;Object&gt;(</TD></TR><TR><TD CLASS="l">494</TD><TD>            Arrays.asList(this.getIds()));</TD></TR><TR CLASS="c"><TD CLASS="l">495</TD><TD>      allIds.addAll(Arrays.asList(super.getAllIds()));</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="4d">496</A></TD><TD>      return allIds.toArray();</TD></TR><TR><TD CLASS="l">497</TD><TD>    }</TD></TR><TR><TD CLASS="l">498</TD><TD> </TD></TR><TR><TD CLASS="l">499</TD><TD>    public Integer[] getIndexIds() {</TD></TR><TR CLASS="c"><TD CLASS="l">500</TD><TD>      Object[] ids = getIds();</TD></TR><TR CLASS="c"><TD CLASS="l">501</TD><TD>      java.util.List&lt;Integer&gt; indices = new java.util.ArrayList&lt;Integer&gt;(ids.length);</TD></TR><TR CLASS="c"><TD CLASS="l">502</TD><TD>      for (Object id : ids) {</TD></TR><TR CLASS="c"><TD CLASS="l">503</TD><TD>        int int32Id = ScriptRuntime.toInt32(id);</TD></TR><TR CLASS="c"><TD CLASS="l">504</TD><TD>        if (int32Id &gt;= 0 &amp;&amp; ScriptRuntime.toString(int32Id).equals(ScriptRuntime.toString(id))) {</TD></TR><TR CLASS="c"><TD CLASS="l">505</TD><TD>          indices.add(int32Id);</TD></TR><TR><TD CLASS="l">506</TD><TD>        }</TD></TR><TR><TD CLASS="l">507</TD><TD>      }</TD></TR><TR CLASS="c"><TD CLASS="l">508</TD><TD>      return indices.toArray(new Integer[indices.size()]);</TD></TR><TR><TD CLASS="l">509</TD><TD>    }</TD></TR><TR><TD CLASS="l"><A NAME="4a">510</A></TD><TD> </TD></TR><TR><TD CLASS="l">511</TD><TD>    @Override</TD></TR><TR><TD CLASS="l">512</TD><TD>    public Object getDefaultValue(Class&lt;?&gt; hint)</TD></TR><TR><TD CLASS="l">513</TD><TD>    {</TD></TR><TR CLASS="c"><TD CLASS="l">514</TD><TD>        if (hint == ScriptRuntime.NumberClass) {</TD></TR><TR CLASS="c"><TD CLASS="l">515</TD><TD>            Context cx = Context.getContext();</TD></TR><TR CLASS="c"><TD CLASS="l">516</TD><TD>            if (cx.getLanguageVersion() == Context.VERSION_1_2)</TD></TR><TR CLASS="c"><TD CLASS="l">517</TD><TD>                return Long.valueOf(length);</TD></TR><TR><TD CLASS="l">518</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="36">519</A></TD><TD>        return super.getDefaultValue(hint);</TD></TR><TR><TD CLASS="l">520</TD><TD>    }</TD></TR><TR><TD CLASS="l">521</TD><TD> </TD></TR><TR><TD CLASS="l">522</TD><TD>    private ScriptableObject defaultIndexPropertyDescriptor(Object value) {</TD></TR><TR CLASS="c"><TD CLASS="l">523</TD><TD>      Scriptable scope = getParentScope();</TD></TR><TR CLASS="p"><TD CLASS="l" TITLE="71% line coverage (5 out of 7 instructions)">524</TD><TD TITLE="71% line coverage (5 out of 7 instructions)">      if (scope == null) scope = this;</TD></TR><TR CLASS="c"><TD CLASS="l">525</TD><TD>      ScriptableObject desc = new NativeObject();</TD></TR><TR CLASS="c"><TD CLASS="l">526</TD><TD>      ScriptRuntime.setBuiltinProtoAndParent(desc, scope, TopLevel.Builtins.Object);</TD></TR><TR CLASS="c"><TD CLASS="l">527</TD><TD>      desc.defineProperty(&#34;value&#34;, value, EMPTY);</TD></TR><TR CLASS="c"><TD CLASS="l">528</TD><TD>      desc.defineProperty(&#34;writable&#34;, true, EMPTY);</TD></TR><TR CLASS="c"><TD CLASS="l">529</TD><TD>      desc.defineProperty(&#34;enumerable&#34;, true, EMPTY);</TD></TR><TR CLASS="c"><TD CLASS="l">530</TD><TD>      desc.defineProperty(&#34;configurable&#34;, true, EMPTY);</TD></TR><TR CLASS="c"><TD CLASS="l">531</TD><TD>      return desc;</TD></TR><TR><TD CLASS="l"><A NAME="15">532</A></TD><TD>    }</TD></TR><TR><TD CLASS="l">533</TD><TD> </TD></TR><TR><TD CLASS="l">534</TD><TD>    @Override</TD></TR><TR><TD CLASS="l">535</TD><TD>    public int getAttributes(int index) {</TD></TR><TR CLASS="z"><TD CLASS="l">536</TD><TD>        if (dense != null &amp;&amp; index &gt;= 0 &amp;&amp; index &lt; dense.length</TD></TR><TR><TD CLASS="l">537</TD><TD>                &amp;&amp; dense[index] != NOT_FOUND) {</TD></TR><TR CLASS="z"><TD CLASS="l">538</TD><TD>            return EMPTY;</TD></TR><TR><TD CLASS="l">539</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">540</TD><TD>        return super.getAttributes(index);</TD></TR><TR><TD CLASS="l"><A NAME="51">541</A></TD><TD>    }</TD></TR><TR><TD CLASS="l">542</TD><TD> </TD></TR><TR><TD CLASS="l">543</TD><TD>    @Override</TD></TR><TR><TD CLASS="l">544</TD><TD>    protected ScriptableObject getOwnPropertyDescriptor(Context cx, Object id) {</TD></TR><TR CLASS="c"><TD CLASS="l">545</TD><TD>      if (dense != null) {</TD></TR><TR CLASS="c"><TD CLASS="l">546</TD><TD>        int index = toDenseIndex(id);</TD></TR><TR CLASS="c"><TD CLASS="l">547</TD><TD>        if (0 &lt;= index &amp;&amp; index &lt; dense.length &amp;&amp; dense[index] != NOT_FOUND) {</TD></TR><TR CLASS="c"><TD CLASS="l">548</TD><TD>          Object value = dense[index];</TD></TR><TR CLASS="c"><TD CLASS="l">549</TD><TD>          return defaultIndexPropertyDescriptor(value);</TD></TR><TR><TD CLASS="l">550</TD><TD>        }</TD></TR><TR><TD CLASS="l">551</TD><TD>      }</TD></TR><TR CLASS="c"><TD CLASS="l">552</TD><TD>      return super.getOwnPropertyDescriptor(cx, id);</TD></TR><TR><TD CLASS="l">553</TD><TD>    }</TD></TR><TR><TD CLASS="l">554</TD><TD> </TD></TR><TR><TD CLASS="l"><A NAME="27">555</A></TD><TD>    @Override</TD></TR><TR><TD CLASS="l">556</TD><TD>    protected void defineOwnProperty(Context cx, Object id,</TD></TR><TR><TD CLASS="l">557</TD><TD>                                     ScriptableObject desc,</TD></TR><TR><TD CLASS="l">558</TD><TD>                                     boolean checkValid) {</TD></TR><TR CLASS="c"><TD CLASS="l">559</TD><TD>      if (dense != null) {</TD></TR><TR CLASS="c"><TD CLASS="l">560</TD><TD>        Object[] values = dense;</TD></TR><TR CLASS="c"><TD CLASS="l">561</TD><TD>        dense = null;</TD></TR><TR CLASS="c"><TD CLASS="l">562</TD><TD>        denseOnly = false;</TD></TR><TR CLASS="c"><TD CLASS="l">563</TD><TD>        for (int i = 0; i &lt; values.length; i++) {</TD></TR><TR CLASS="c"><TD CLASS="l">564</TD><TD>          if (values[i] != NOT_FOUND) {</TD></TR><TR CLASS="z"><TD CLASS="l">565</TD><TD>            put(i, this, values[i]);</TD></TR><TR><TD CLASS="l">566</TD><TD>          }</TD></TR><TR><TD CLASS="l">567</TD><TD>        }</TD></TR><TR><TD CLASS="l">568</TD><TD>      }</TD></TR><TR CLASS="c"><TD CLASS="l">569</TD><TD>      long index = toArrayIndex(id);</TD></TR><TR CLASS="c"><TD CLASS="l">570</TD><TD>      if (index &gt;= length) {</TD></TR><TR CLASS="c"><TD CLASS="l">571</TD><TD>        length = index + 1;</TD></TR><TR><TD CLASS="l">572</TD><TD>      }</TD></TR><TR CLASS="c"><TD CLASS="l">573</TD><TD>      super.defineOwnProperty(cx, id, desc, checkValid);</TD></TR><TR CLASS="c"><TD CLASS="l">574</TD><TD>    }</TD></TR><TR><TD CLASS="l">575</TD><TD> </TD></TR><TR><TD CLASS="l">576</TD><TD>    /**</TD></TR><TR><TD CLASS="l">577</TD><TD>     * See ECMA 15.4.1,2</TD></TR><TR><TD CLASS="l"><A NAME="2a">578</A></TD><TD>     */</TD></TR><TR><TD CLASS="l">579</TD><TD>    private static Object jsConstructor(Context cx, Scriptable scope,</TD></TR><TR><TD CLASS="l">580</TD><TD>                                        Object[] args)</TD></TR><TR><TD CLASS="l">581</TD><TD>    {</TD></TR><TR CLASS="c"><TD CLASS="l">582</TD><TD>        if (args.length == 0)</TD></TR><TR CLASS="c"><TD CLASS="l">583</TD><TD>            return new NativeArray(0);</TD></TR><TR><TD CLASS="l">584</TD><TD> </TD></TR><TR><TD CLASS="l">585</TD><TD>        // Only use 1 arg as first element for version 1.2; for</TD></TR><TR><TD CLASS="l">586</TD><TD>        // any other version (including 1.3) follow ECMA and use it as</TD></TR><TR><TD CLASS="l">587</TD><TD>        // a length.</TD></TR><TR CLASS="c"><TD CLASS="l">588</TD><TD>        if (cx.getLanguageVersion() == Context.VERSION_1_2) {</TD></TR><TR CLASS="c"><TD CLASS="l">589</TD><TD>            return new NativeArray(args);</TD></TR><TR><TD CLASS="l">590</TD><TD>        } else {</TD></TR><TR CLASS="c"><TD CLASS="l">591</TD><TD>            Object arg0 = args[0];</TD></TR><TR CLASS="c"><TD CLASS="l">592</TD><TD>            if (args.length &gt; 1 || !(arg0 instanceof Number)) {</TD></TR><TR CLASS="c"><TD CLASS="l">593</TD><TD>                return new NativeArray(args);</TD></TR><TR><TD CLASS="l">594</TD><TD>            } else {</TD></TR><TR CLASS="c"><TD CLASS="l">595</TD><TD>                long len = ScriptRuntime.toUint32(arg0);</TD></TR><TR CLASS="c"><TD CLASS="l">596</TD><TD>                if (len != ((Number)arg0).doubleValue()) {</TD></TR><TR CLASS="z"><TD CLASS="l">597</TD><TD>                    String msg = ScriptRuntime.getMessage0(&#34;msg.arraylength.bad&#34;);</TD></TR><TR CLASS="z"><TD CLASS="l">598</TD><TD>                    throw ScriptRuntime.constructError(&#34;RangeError&#34;, msg);</TD></TR><TR><TD CLASS="l">599</TD><TD>                }</TD></TR><TR CLASS="c"><TD CLASS="l">600</TD><TD>                return new NativeArray(len);</TD></TR><TR><TD CLASS="l">601</TD><TD>            }</TD></TR><TR><TD CLASS="l"><A NAME="4e">602</A></TD><TD>        }</TD></TR><TR><TD CLASS="l">603</TD><TD>    }</TD></TR><TR><TD CLASS="l">604</TD><TD> </TD></TR><TR><TD CLASS="l">605</TD><TD>    public long getLength() {</TD></TR><TR CLASS="c"><TD CLASS="l">606</TD><TD>        return length;</TD></TR><TR><TD CLASS="l"><A NAME="18">607</A></TD><TD>    }</TD></TR><TR><TD CLASS="l">608</TD><TD> </TD></TR><TR><TD CLASS="l">609</TD><TD>    /** @deprecated Use {@link #getLength()} instead. */</TD></TR><TR><TD CLASS="l">610</TD><TD>    public long jsGet_length() {</TD></TR><TR CLASS="z"><TD CLASS="l">611</TD><TD>        return getLength();</TD></TR><TR><TD CLASS="l">612</TD><TD>    }</TD></TR><TR><TD CLASS="l">613</TD><TD> </TD></TR><TR><TD CLASS="l">614</TD><TD>    /**</TD></TR><TR><TD CLASS="l">615</TD><TD>     * Change the value of the internal flag that determines whether all</TD></TR><TR><TD CLASS="l">616</TD><TD>     * storage is handed by a dense backing array rather than an associative</TD></TR><TR><TD CLASS="l">617</TD><TD>     * store.</TD></TR><TR><TD CLASS="l">618</TD><TD>     * @param denseOnly new value for denseOnly flag</TD></TR><TR><TD CLASS="l">619</TD><TD>     * @throws IllegalArgumentException if an attempt is made to enable</TD></TR><TR><TD CLASS="l"><A NAME="20">620</A></TD><TD>     *   denseOnly after it was disabled; NativeArray code is not written</TD></TR><TR><TD CLASS="l">621</TD><TD>     *   to handle switching back to a dense representation</TD></TR><TR><TD CLASS="l">622</TD><TD>     */</TD></TR><TR><TD CLASS="l">623</TD><TD>    void setDenseOnly(boolean denseOnly) {</TD></TR><TR CLASS="p"><TD CLASS="l" TITLE="40% line coverage (2 out of 5 instructions)">624</TD><TD TITLE="40% line coverage (2 out of 5 instructions)">        if (denseOnly &amp;&amp; !this.denseOnly)</TD></TR><TR CLASS="z"><TD CLASS="l">625</TD><TD>            throw new IllegalArgumentException();</TD></TR><TR CLASS="c"><TD CLASS="l">626</TD><TD>        this.denseOnly = denseOnly;</TD></TR><TR CLASS="c"><TD CLASS="l">627</TD><TD>    }</TD></TR><TR><TD CLASS="l">628</TD><TD> </TD></TR><TR><TD CLASS="l">629</TD><TD>    private void setLength(Object val) {</TD></TR><TR><TD CLASS="l">630</TD><TD>        /* XXX do we satisfy this?</TD></TR><TR><TD CLASS="l">631</TD><TD>         * 15.4.5.1 [[Put]](P, V):</TD></TR><TR><TD CLASS="l"><A NAME="3c">632</A></TD><TD>         * 1. Call the [[CanPut]] method of A with name P.</TD></TR><TR><TD CLASS="l">633</TD><TD>         * 2. If Result(1) is false, return.</TD></TR><TR><TD CLASS="l">634</TD><TD>         * ?</TD></TR><TR><TD CLASS="l">635</TD><TD>         */</TD></TR><TR CLASS="c"><TD CLASS="l">636</TD><TD>        if ((lengthAttr &amp; READONLY) != 0) {</TD></TR><TR CLASS="z"><TD CLASS="l">637</TD><TD>            return;</TD></TR><TR><TD CLASS="l">638</TD><TD>        }</TD></TR><TR><TD CLASS="l">639</TD><TD> </TD></TR><TR CLASS="c"><TD CLASS="l">640</TD><TD>        double d = ScriptRuntime.toNumber(val);</TD></TR><TR CLASS="c"><TD CLASS="l">641</TD><TD>        long longVal = ScriptRuntime.toUint32(d);</TD></TR><TR CLASS="c"><TD CLASS="l">642</TD><TD>        if (longVal != d) {</TD></TR><TR CLASS="c"><TD CLASS="l">643</TD><TD>            String msg = ScriptRuntime.getMessage0(&#34;msg.arraylength.bad&#34;);</TD></TR><TR CLASS="c"><TD CLASS="l">644</TD><TD>            throw ScriptRuntime.constructError(&#34;RangeError&#34;, msg);</TD></TR><TR><TD CLASS="l">645</TD><TD>        }</TD></TR><TR><TD CLASS="l">646</TD><TD> </TD></TR><TR CLASS="c"><TD CLASS="l">647</TD><TD>        if (denseOnly) {</TD></TR><TR CLASS="c"><TD CLASS="l">648</TD><TD>            if (longVal &lt; length) {</TD></TR><TR><TD CLASS="l">649</TD><TD>                // downcast okay because denseOnly</TD></TR><TR CLASS="c"><TD CLASS="l">650</TD><TD>                Arrays.fill(dense, (int) longVal, dense.length, NOT_FOUND);</TD></TR><TR CLASS="c"><TD CLASS="l">651</TD><TD>                length = longVal;</TD></TR><TR CLASS="c"><TD CLASS="l">652</TD><TD>                return;</TD></TR><TR CLASS="c"><TD CLASS="l">653</TD><TD>            } else if (longVal &lt; MAX_PRE_GROW_SIZE &amp;&amp;</TD></TR><TR><TD CLASS="l">654</TD><TD>                       longVal &lt; (length * GROW_FACTOR) &amp;&amp;</TD></TR><TR><TD CLASS="l">655</TD><TD>                       ensureCapacity((int)longVal))</TD></TR><TR><TD CLASS="l">656</TD><TD>            {</TD></TR><TR CLASS="c"><TD CLASS="l">657</TD><TD>                length = longVal;</TD></TR><TR CLASS="c"><TD CLASS="l">658</TD><TD>                return;</TD></TR><TR><TD CLASS="l">659</TD><TD>            } else {</TD></TR><TR CLASS="c"><TD CLASS="l">660</TD><TD>                denseOnly = false;</TD></TR><TR><TD CLASS="l">661</TD><TD>            }</TD></TR><TR><TD CLASS="l">662</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">663</TD><TD>        if (longVal &lt; length) {</TD></TR><TR><TD CLASS="l">664</TD><TD>            // remove all properties between longVal and length</TD></TR><TR CLASS="c"><TD CLASS="l">665</TD><TD>            if (length - longVal &gt; 0x1000) {</TD></TR><TR><TD CLASS="l">666</TD><TD>                // assume that the representation is sparse</TD></TR><TR CLASS="c"><TD CLASS="l">667</TD><TD>                Object[] e = getIds(); // will only find in object itself</TD></TR><TR CLASS="c"><TD CLASS="l">668</TD><TD>                for (int i=0; i &lt; e.length; i++) {</TD></TR><TR CLASS="c"><TD CLASS="l">669</TD><TD>                    Object id = e[i];</TD></TR><TR CLASS="c"><TD CLASS="l">670</TD><TD>                    if (id instanceof String) {</TD></TR><TR><TD CLASS="l">671</TD><TD>                        // &gt; MAXINT will appear as string</TD></TR><TR CLASS="c"><TD CLASS="l">672</TD><TD>                        String strId = (String)id;</TD></TR><TR CLASS="c"><TD CLASS="l">673</TD><TD>                        long index = toArrayIndex(strId);</TD></TR><TR CLASS="c"><TD CLASS="l">674</TD><TD>                        if (index &gt;= longVal)</TD></TR><TR CLASS="c"><TD CLASS="l">675</TD><TD>                            delete(strId);</TD></TR><TR CLASS="c"><TD CLASS="l">676</TD><TD>                    } else {</TD></TR><TR CLASS="c"><TD CLASS="l">677</TD><TD>                        int index = ((Integer)id).intValue();</TD></TR><TR CLASS="c"><TD CLASS="l">678</TD><TD>                        if (index &gt;= longVal)</TD></TR><TR CLASS="c"><TD CLASS="l">679</TD><TD>                            delete(index);</TD></TR><TR><TD CLASS="l">680</TD><TD>                    }</TD></TR><TR><TD CLASS="l">681</TD><TD>                }</TD></TR><TR CLASS="c"><TD CLASS="l">682</TD><TD>            } else {</TD></TR><TR><TD CLASS="l">683</TD><TD>                // assume a dense representation</TD></TR><TR CLASS="c"><TD CLASS="l">684</TD><TD>                for (long i = longVal; i &lt; length; i++) {</TD></TR><TR CLASS="c"><TD CLASS="l">685</TD><TD>                    deleteElem(this, i);</TD></TR><TR><TD CLASS="l">686</TD><TD>                }</TD></TR><TR><TD CLASS="l">687</TD><TD>            }</TD></TR><TR><TD CLASS="l">688</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">689</TD><TD>        length = longVal;</TD></TR><TR CLASS="c"><TD CLASS="l">690</TD><TD>    }</TD></TR><TR><TD CLASS="l">691</TD><TD> </TD></TR><TR><TD CLASS="l">692</TD><TD>    /* Support for generic Array-ish objects.  Most of the Array</TD></TR><TR><TD CLASS="l">693</TD><TD>     * functions try to be generic; anything that has a length</TD></TR><TR><TD CLASS="l">694</TD><TD>     * property is assumed to be an array.</TD></TR><TR><TD CLASS="l">695</TD><TD>     * getLengthProperty returns 0 if obj does not have the length property</TD></TR><TR><TD CLASS="l"><A NAME="4f">696</A></TD><TD>     * or its value is not convertible to a number.</TD></TR><TR><TD CLASS="l">697</TD><TD>     */</TD></TR><TR><TD CLASS="l">698</TD><TD>    static long getLengthProperty(Context cx, Scriptable obj) {</TD></TR><TR><TD CLASS="l">699</TD><TD>        // These will both give numeric lengths within Uint32 range.</TD></TR><TR CLASS="c"><TD CLASS="l">700</TD><TD>        if (obj instanceof NativeString) {</TD></TR><TR CLASS="c"><TD CLASS="l">701</TD><TD>            return ((NativeString)obj).getLength();</TD></TR><TR CLASS="c"><TD CLASS="l">702</TD><TD>        } else if (obj instanceof NativeArray) {</TD></TR><TR CLASS="c"><TD CLASS="l">703</TD><TD>            return ((NativeArray)obj).getLength();</TD></TR><TR><TD CLASS="l">704</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">705</TD><TD>        return ScriptRuntime.toUint32(</TD></TR><TR><TD CLASS="l">706</TD><TD>            ScriptRuntime.getObjectProp(obj, &#34;length&#34;, cx));</TD></TR><TR><TD CLASS="l">707</TD><TD>    }</TD></TR><TR><TD CLASS="l"><A NAME="5d">708</A></TD><TD> </TD></TR><TR><TD CLASS="l">709</TD><TD>    private static Object setLengthProperty(Context cx, Scriptable target,</TD></TR><TR><TD CLASS="l">710</TD><TD>                                            long length)</TD></TR><TR><TD CLASS="l">711</TD><TD>    {</TD></TR><TR CLASS="c"><TD CLASS="l">712</TD><TD>        return ScriptRuntime.setObjectProp(</TD></TR><TR><TD CLASS="l">713</TD><TD>                   target, &#34;length&#34;, ScriptRuntime.wrapNumber(length), cx);</TD></TR><TR><TD CLASS="l">714</TD><TD>    }</TD></TR><TR><TD CLASS="l">715</TD><TD> </TD></TR><TR><TD CLASS="l">716</TD><TD>    /* Utility functions to encapsulate index &gt; Integer.MAX_VALUE</TD></TR><TR><TD CLASS="l">717</TD><TD>     * handling.  Also avoids unnecessary object creation that would</TD></TR><TR><TD CLASS="l"><A NAME="42">718</A></TD><TD>     * be necessary to use the general ScriptRuntime.get/setElem</TD></TR><TR><TD CLASS="l">719</TD><TD>     * functions... though this is probably premature optimization.</TD></TR><TR><TD CLASS="l">720</TD><TD>     */</TD></TR><TR><TD CLASS="l">721</TD><TD>    private static void deleteElem(Scriptable target, long index) {</TD></TR><TR CLASS="c"><TD CLASS="l">722</TD><TD>        int i = (int)index;</TD></TR><TR CLASS="c"><TD CLASS="l">723</TD><TD>        if (i == index) { target.delete(i); }</TD></TR><TR CLASS="c"><TD CLASS="l">724</TD><TD>        else { target.delete(Long.toString(index)); }</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="4b">725</A></TD><TD>    }</TD></TR><TR><TD CLASS="l">726</TD><TD> </TD></TR><TR><TD CLASS="l">727</TD><TD>    private static Object getElem(Context cx, Scriptable target, long index)</TD></TR><TR><TD CLASS="l">728</TD><TD>    {</TD></TR><TR CLASS="c"><TD CLASS="l">729</TD><TD>        if (index &gt; Integer.MAX_VALUE) {</TD></TR><TR CLASS="c"><TD CLASS="l">730</TD><TD>            String id = Long.toString(index);</TD></TR><TR CLASS="c"><TD CLASS="l">731</TD><TD>            return ScriptRuntime.getObjectProp(target, id, cx);</TD></TR><TR><TD CLASS="l">732</TD><TD>        } else {</TD></TR><TR CLASS="c"><TD CLASS="l">733</TD><TD>            return ScriptRuntime.getObjectIndex(target, (int)index, cx);</TD></TR><TR><TD CLASS="l">734</TD><TD>        }</TD></TR><TR><TD CLASS="l"><A NAME="52">735</A></TD><TD>    }</TD></TR><TR><TD CLASS="l">736</TD><TD> </TD></TR><TR><TD CLASS="l">737</TD><TD>    // same as getElem, but without converting NOT_FOUND to undefined</TD></TR><TR><TD CLASS="l">738</TD><TD>    private static Object getRawElem(Scriptable target, long index) {</TD></TR><TR CLASS="c"><TD CLASS="l">739</TD><TD>        if (index &gt; Integer.MAX_VALUE) {</TD></TR><TR CLASS="c"><TD CLASS="l">740</TD><TD>            return ScriptableObject.getProperty(target, Long.toString(index));</TD></TR><TR><TD CLASS="l">741</TD><TD>        } else {</TD></TR><TR CLASS="c"><TD CLASS="l">742</TD><TD>            return ScriptableObject.getProperty(target, (int)index);</TD></TR><TR><TD CLASS="l">743</TD><TD>        }</TD></TR><TR><TD CLASS="l">744</TD><TD>    }</TD></TR><TR><TD CLASS="l"><A NAME="5c">745</A></TD><TD> </TD></TR><TR><TD CLASS="l">746</TD><TD>    private static void setElem(Context cx, Scriptable target, long index,</TD></TR><TR><TD CLASS="l">747</TD><TD>                                Object value)</TD></TR><TR><TD CLASS="l">748</TD><TD>    {</TD></TR><TR CLASS="c"><TD CLASS="l">749</TD><TD>        if (index &gt; Integer.MAX_VALUE) {</TD></TR><TR CLASS="c"><TD CLASS="l">750</TD><TD>            String id = Long.toString(index);</TD></TR><TR CLASS="c"><TD CLASS="l">751</TD><TD>            ScriptRuntime.setObjectProp(target, id, value, cx);</TD></TR><TR CLASS="c"><TD CLASS="l">752</TD><TD>        } else {</TD></TR><TR CLASS="c"><TD CLASS="l">753</TD><TD>            ScriptRuntime.setObjectIndex(target, (int)index, value, cx);</TD></TR><TR><TD CLASS="l">754</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">755</TD><TD>    }</TD></TR><TR><TD CLASS="l"><A NAME="5f">756</A></TD><TD> </TD></TR><TR><TD CLASS="l">757</TD><TD>    // Similar as setElem(), but triggers deleteElem() if value is NOT_FOUND</TD></TR><TR><TD CLASS="l">758</TD><TD>    private static void setRawElem(Context cx, Scriptable target, long index,</TD></TR><TR><TD CLASS="l">759</TD><TD>                                   Object value) {</TD></TR><TR CLASS="c"><TD CLASS="l">760</TD><TD>        if (value == NOT_FOUND) {</TD></TR><TR CLASS="c"><TD CLASS="l">761</TD><TD>            deleteElem(target, index);</TD></TR><TR><TD CLASS="l">762</TD><TD>        } else {</TD></TR><TR CLASS="c"><TD CLASS="l">763</TD><TD>            setElem(cx, target, index, value);</TD></TR><TR><TD CLASS="l">764</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">765</TD><TD>    }</TD></TR><TR><TD CLASS="l">766</TD><TD> </TD></TR><TR><TD CLASS="l">767</TD><TD>    private static String toStringHelper(Context cx, Scriptable scope,</TD></TR><TR><TD CLASS="l">768</TD><TD>                                         Scriptable thisObj,</TD></TR><TR><TD CLASS="l">769</TD><TD>                                         boolean toSource, boolean toLocale)</TD></TR><TR><TD CLASS="l">770</TD><TD>    {</TD></TR><TR><TD CLASS="l"><A NAME="2f">771</A></TD><TD>        /* It's probably redundant to handle long lengths in this</TD></TR><TR><TD CLASS="l">772</TD><TD>         * function; StringBuilders are limited to 2^31 in java.</TD></TR><TR><TD CLASS="l">773</TD><TD>         */</TD></TR><TR><TD CLASS="l">774</TD><TD> </TD></TR><TR CLASS="c"><TD CLASS="l">775</TD><TD>        long length = getLengthProperty(cx, thisObj);</TD></TR><TR><TD CLASS="l">776</TD><TD> </TD></TR><TR CLASS="c"><TD CLASS="l">777</TD><TD>        StringBuilder result = new StringBuilder(256);</TD></TR><TR><TD CLASS="l">778</TD><TD> </TD></TR><TR><TD CLASS="l">779</TD><TD>        // whether to return '4,unquoted,5' or '[4, &#34;quoted&#34;, 5]'</TD></TR><TR><TD CLASS="l">780</TD><TD>        String separator;</TD></TR><TR><TD CLASS="l">781</TD><TD> </TD></TR><TR CLASS="c"><TD CLASS="l">782</TD><TD>        if (toSource) {</TD></TR><TR CLASS="c"><TD CLASS="l">783</TD><TD>            result.append('[');</TD></TR><TR CLASS="c"><TD CLASS="l">784</TD><TD>            separator = &#34;, &#34;;</TD></TR><TR><TD CLASS="l">785</TD><TD>        } else {</TD></TR><TR CLASS="c"><TD CLASS="l">786</TD><TD>            separator = &#34;,&#34;;</TD></TR><TR><TD CLASS="l">787</TD><TD>        }</TD></TR><TR><TD CLASS="l">788</TD><TD> </TD></TR><TR CLASS="c"><TD CLASS="l">789</TD><TD>        boolean haslast = false;</TD></TR><TR CLASS="c"><TD CLASS="l">790</TD><TD>        long i = 0;</TD></TR><TR><TD CLASS="l">791</TD><TD> </TD></TR><TR><TD CLASS="l">792</TD><TD>        boolean toplevel, iterating;</TD></TR><TR CLASS="c"><TD CLASS="l">793</TD><TD>        if (cx.iterating == null) {</TD></TR><TR CLASS="c"><TD CLASS="l">794</TD><TD>            toplevel = true;</TD></TR><TR CLASS="c"><TD CLASS="l">795</TD><TD>            iterating = false;</TD></TR><TR CLASS="c"><TD CLASS="l">796</TD><TD>            cx.iterating = new ObjToIntMap(31);</TD></TR><TR><TD CLASS="l">797</TD><TD>        } else {</TD></TR><TR CLASS="c"><TD CLASS="l">798</TD><TD>            toplevel = false;</TD></TR><TR CLASS="c"><TD CLASS="l">799</TD><TD>            iterating = cx.iterating.has(thisObj);</TD></TR><TR><TD CLASS="l">800</TD><TD>        }</TD></TR><TR><TD CLASS="l">801</TD><TD> </TD></TR><TR><TD CLASS="l">802</TD><TD>        // Make sure cx.iterating is set to null when done</TD></TR><TR><TD CLASS="l">803</TD><TD>        // so we don't leak memory</TD></TR><TR><TD CLASS="l">804</TD><TD>        try {</TD></TR><TR CLASS="c"><TD CLASS="l">805</TD><TD>            if (!iterating) {</TD></TR><TR CLASS="c"><TD CLASS="l">806</TD><TD>                cx.iterating.put(thisObj, 0); // stop recursion.</TD></TR><TR><TD CLASS="l">807</TD><TD>                // make toSource print null and undefined values in recent versions</TD></TR><TR CLASS="c"><TD CLASS="l">808</TD><TD>                boolean skipUndefinedAndNull = !toSource</TD></TR><TR><TD CLASS="l">809</TD><TD>                        || cx.getLanguageVersion() &lt; Context.VERSION_1_5;</TD></TR><TR CLASS="c"><TD CLASS="l">810</TD><TD>                for (i = 0; i &lt; length; i++) {</TD></TR><TR CLASS="c"><TD CLASS="l">811</TD><TD>                    if (i &gt; 0) result.append(separator);</TD></TR><TR CLASS="c"><TD CLASS="l">812</TD><TD>                    Object elem = getRawElem(thisObj, i);</TD></TR><TR CLASS="c"><TD CLASS="l">813</TD><TD>                    if (elem == NOT_FOUND || (skipUndefinedAndNull &amp;&amp;</TD></TR><TR><TD CLASS="l">814</TD><TD>                            (elem == null || elem == Undefined.instance))) {</TD></TR><TR CLASS="c"><TD CLASS="l">815</TD><TD>                        haslast = false;</TD></TR><TR CLASS="c"><TD CLASS="l">816</TD><TD>                        continue;</TD></TR><TR><TD CLASS="l">817</TD><TD>                    }</TD></TR><TR CLASS="c"><TD CLASS="l">818</TD><TD>                    haslast = true;</TD></TR><TR><TD CLASS="l">819</TD><TD> </TD></TR><TR CLASS="c"><TD CLASS="l">820</TD><TD>                    if (toSource) {</TD></TR><TR CLASS="c"><TD CLASS="l">821</TD><TD>                        result.append(ScriptRuntime.uneval(cx, scope, elem));</TD></TR><TR><TD CLASS="l">822</TD><TD> </TD></TR><TR CLASS="c"><TD CLASS="l">823</TD><TD>                    } else if (elem instanceof String) {</TD></TR><TR CLASS="c"><TD CLASS="l">824</TD><TD>                        String s = (String)elem;</TD></TR><TR CLASS="c"><TD CLASS="l">825</TD><TD>                        if (toSource) {</TD></TR><TR CLASS="z"><TD CLASS="l">826</TD><TD>                            result.append('\&#34;');</TD></TR><TR CLASS="z"><TD CLASS="l">827</TD><TD>                            result.append(ScriptRuntime.escapeString(s));</TD></TR><TR CLASS="z"><TD CLASS="l">828</TD><TD>                            result.append('\&#34;');</TD></TR><TR><TD CLASS="l">829</TD><TD>                        } else {</TD></TR><TR CLASS="c"><TD CLASS="l">830</TD><TD>                            result.append(s);</TD></TR><TR><TD CLASS="l">831</TD><TD>                        }</TD></TR><TR><TD CLASS="l">832</TD><TD> </TD></TR><TR CLASS="c"><TD CLASS="l">833</TD><TD>                    } else {</TD></TR><TR CLASS="c"><TD CLASS="l">834</TD><TD>                        if (toLocale) {</TD></TR><TR><TD CLASS="l">835</TD><TD>                            Callable fun;</TD></TR><TR><TD CLASS="l">836</TD><TD>                            Scriptable funThis;</TD></TR><TR CLASS="c"><TD CLASS="l">837</TD><TD>                            fun = ScriptRuntime.getPropFunctionAndThis(</TD></TR><TR><TD CLASS="l">838</TD><TD>                                      elem, &#34;toLocaleString&#34;, cx);</TD></TR><TR CLASS="c"><TD CLASS="l">839</TD><TD>                            funThis = ScriptRuntime.lastStoredScriptable(cx);</TD></TR><TR CLASS="c"><TD CLASS="l">840</TD><TD>                            elem = fun.call(cx, scope, funThis,</TD></TR><TR><TD CLASS="l">841</TD><TD>                                            ScriptRuntime.emptyArgs);</TD></TR><TR><TD CLASS="l">842</TD><TD>                        }</TD></TR><TR CLASS="c"><TD CLASS="l">843</TD><TD>                        result.append(ScriptRuntime.toString(elem));</TD></TR><TR><TD CLASS="l">844</TD><TD>                    }</TD></TR><TR><TD CLASS="l">845</TD><TD>                }</TD></TR><TR><TD CLASS="l">846</TD><TD>            }</TD></TR><TR><TD CLASS="l">847</TD><TD>        } finally {</TD></TR><TR CLASS="p"><TD CLASS="l" TITLE="40% line coverage (2 out of 5 instructions)">848</TD><TD TITLE="40% line coverage (2 out of 5 instructions)">            if (toplevel) {</TD></TR><TR CLASS="p"><TD CLASS="l" TITLE="44% line coverage (4 out of 9 instructions)">849</TD><TD TITLE="44% line coverage (4 out of 9 instructions)">                cx.iterating = null;</TD></TR><TR><TD CLASS="l">850</TD><TD>            }</TD></TR><TR><TD CLASS="l">851</TD><TD>        }</TD></TR><TR><TD CLASS="l">852</TD><TD> </TD></TR><TR CLASS="c"><TD CLASS="l">853</TD><TD>        if (toSource) {</TD></TR><TR><TD CLASS="l">854</TD><TD>            //for [,,].length behavior; we want toString to be symmetric.</TD></TR><TR CLASS="c"><TD CLASS="l">855</TD><TD>            if (!haslast &amp;&amp; i &gt; 0)</TD></TR><TR CLASS="c"><TD CLASS="l">856</TD><TD>                result.append(&#34;, ]&#34;);</TD></TR><TR><TD CLASS="l">857</TD><TD>            else</TD></TR><TR CLASS="c"><TD CLASS="l">858</TD><TD>                result.append(']');</TD></TR><TR><TD CLASS="l">859</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">860</TD><TD>        return result.toString();</TD></TR><TR><TD CLASS="l">861</TD><TD>    }</TD></TR><TR><TD CLASS="l">862</TD><TD> </TD></TR><TR><TD CLASS="l">863</TD><TD>    /**</TD></TR><TR><TD CLASS="l">864</TD><TD>     * See ECMA 15.4.4.3</TD></TR><TR><TD CLASS="l"><A NAME="38">865</A></TD><TD>     */</TD></TR><TR><TD CLASS="l">866</TD><TD>    private static String js_join(Context cx, Scriptable thisObj,</TD></TR><TR><TD CLASS="l">867</TD><TD>                                  Object[] args)</TD></TR><TR><TD CLASS="l">868</TD><TD>    {</TD></TR><TR CLASS="c"><TD CLASS="l">869</TD><TD>        long llength = getLengthProperty(cx, thisObj);</TD></TR><TR CLASS="c"><TD CLASS="l">870</TD><TD>        int length = (int)llength;</TD></TR><TR CLASS="c"><TD CLASS="l">871</TD><TD>        if (llength != length) {</TD></TR><TR CLASS="z"><TD CLASS="l">872</TD><TD>            throw Context.reportRuntimeError1(</TD></TR><TR><TD CLASS="l">873</TD><TD>                &#34;msg.arraylength.too.big&#34;, String.valueOf(llength));</TD></TR><TR><TD CLASS="l">874</TD><TD>        }</TD></TR><TR><TD CLASS="l">875</TD><TD>        // if no args, use &#34;,&#34; as separator</TD></TR><TR CLASS="c"><TD CLASS="l">876</TD><TD>        String separator = (args.length &lt; 1 || args[0] == Undefined.instance)</TD></TR><TR><TD CLASS="l">877</TD><TD>                           ? &#34;,&#34;</TD></TR><TR><TD CLASS="l">878</TD><TD>                           : ScriptRuntime.toString(args[0]);</TD></TR><TR CLASS="c"><TD CLASS="l">879</TD><TD>        if (thisObj instanceof NativeArray) {</TD></TR><TR CLASS="c"><TD CLASS="l">880</TD><TD>            NativeArray na = (NativeArray) thisObj;</TD></TR><TR CLASS="c"><TD CLASS="l">881</TD><TD>            if (na.denseOnly) {</TD></TR><TR CLASS="c"><TD CLASS="l">882</TD><TD>                StringBuilder sb = new StringBuilder();</TD></TR><TR CLASS="c"><TD CLASS="l">883</TD><TD>                for (int i = 0; i &lt; length; i++) {</TD></TR><TR CLASS="c"><TD CLASS="l">884</TD><TD>                    if (i != 0) {</TD></TR><TR CLASS="c"><TD CLASS="l">885</TD><TD>                        sb.append(separator);</TD></TR><TR><TD CLASS="l">886</TD><TD>                    }</TD></TR><TR CLASS="c"><TD CLASS="l">887</TD><TD>                    if (i &lt; na.dense.length) {</TD></TR><TR CLASS="c"><TD CLASS="l">888</TD><TD>                        Object temp = na.dense[i];</TD></TR><TR CLASS="c"><TD CLASS="l">889</TD><TD>                        if (temp != null &amp;&amp; temp != Undefined.instance &amp;&amp;</TD></TR><TR><TD CLASS="l">890</TD><TD>                            temp != Scriptable.NOT_FOUND)</TD></TR><TR><TD CLASS="l">891</TD><TD>                        {</TD></TR><TR CLASS="c"><TD CLASS="l">892</TD><TD>                            sb.append(ScriptRuntime.toString(temp));</TD></TR><TR><TD CLASS="l">893</TD><TD>                        }</TD></TR><TR><TD CLASS="l">894</TD><TD>                    }</TD></TR><TR><TD CLASS="l">895</TD><TD>                }</TD></TR><TR CLASS="c"><TD CLASS="l">896</TD><TD>                return sb.toString();</TD></TR><TR><TD CLASS="l">897</TD><TD>            }</TD></TR><TR><TD CLASS="l">898</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">899</TD><TD>        if (length == 0) {</TD></TR><TR CLASS="z"><TD CLASS="l">900</TD><TD>            return &#34;&#34;;</TD></TR><TR><TD CLASS="l">901</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">902</TD><TD>        String[] buf = new String[length];</TD></TR><TR CLASS="c"><TD CLASS="l">903</TD><TD>        int total_size = 0;</TD></TR><TR CLASS="c"><TD CLASS="l">904</TD><TD>        for (int i = 0; i != length; i++) {</TD></TR><TR CLASS="c"><TD CLASS="l">905</TD><TD>            Object temp = getElem(cx, thisObj, i);</TD></TR><TR CLASS="c"><TD CLASS="l">906</TD><TD>            if (temp != null &amp;&amp; temp != Undefined.instance) {</TD></TR><TR CLASS="c"><TD CLASS="l">907</TD><TD>                String str = ScriptRuntime.toString(temp);</TD></TR><TR CLASS="c"><TD CLASS="l">908</TD><TD>                total_size += str.length();</TD></TR><TR CLASS="c"><TD CLASS="l">909</TD><TD>                buf[i] = str;</TD></TR><TR><TD CLASS="l">910</TD><TD>            }</TD></TR><TR><TD CLASS="l">911</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">912</TD><TD>        total_size += (length - 1) * separator.length();</TD></TR><TR CLASS="c"><TD CLASS="l">913</TD><TD>        StringBuilder sb = new StringBuilder(total_size);</TD></TR><TR CLASS="c"><TD CLASS="l">914</TD><TD>        for (int i = 0; i != length; i++) {</TD></TR><TR CLASS="c"><TD CLASS="l">915</TD><TD>            if (i != 0) {</TD></TR><TR CLASS="c"><TD CLASS="l">916</TD><TD>                sb.append(separator);</TD></TR><TR><TD CLASS="l">917</TD><TD>            }</TD></TR><TR CLASS="c"><TD CLASS="l">918</TD><TD>            String str = buf[i];</TD></TR><TR CLASS="c"><TD CLASS="l">919</TD><TD>            if (str != null) {</TD></TR><TR><TD CLASS="l">920</TD><TD>                // str == null for undefined or null</TD></TR><TR CLASS="c"><TD CLASS="l">921</TD><TD>                sb.append(str);</TD></TR><TR><TD CLASS="l">922</TD><TD>            }</TD></TR><TR><TD CLASS="l">923</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">924</TD><TD>        return sb.toString();</TD></TR><TR><TD CLASS="l">925</TD><TD>    }</TD></TR><TR><TD CLASS="l">926</TD><TD> </TD></TR><TR><TD CLASS="l">927</TD><TD>    /**</TD></TR><TR><TD CLASS="l">928</TD><TD>     * See ECMA 15.4.4.4</TD></TR><TR><TD CLASS="l"><A NAME="57">929</A></TD><TD>     */</TD></TR><TR><TD CLASS="l">930</TD><TD>    private static Scriptable js_reverse(Context cx, Scriptable thisObj,</TD></TR><TR><TD CLASS="l">931</TD><TD>                                         Object[] args)</TD></TR><TR><TD CLASS="l">932</TD><TD>    {</TD></TR><TR CLASS="c"><TD CLASS="l">933</TD><TD>        if (thisObj instanceof NativeArray) {</TD></TR><TR CLASS="c"><TD CLASS="l">934</TD><TD>            NativeArray na = (NativeArray) thisObj;</TD></TR><TR CLASS="c"><TD CLASS="l">935</TD><TD>            if (na.denseOnly) {</TD></TR><TR CLASS="c"><TD CLASS="l">936</TD><TD>                for (int i=0, j=((int)na.length)-1; i &lt; j; i++,j--) {</TD></TR><TR CLASS="c"><TD CLASS="l">937</TD><TD>                    Object temp = na.dense[i];</TD></TR><TR CLASS="c"><TD CLASS="l">938</TD><TD>                    na.dense[i] = na.dense[j];</TD></TR><TR CLASS="c"><TD CLASS="l">939</TD><TD>                    na.dense[j] = temp;</TD></TR><TR><TD CLASS="l">940</TD><TD>                }</TD></TR><TR CLASS="c"><TD CLASS="l">941</TD><TD>                return thisObj;</TD></TR><TR><TD CLASS="l">942</TD><TD>            }</TD></TR><TR><TD CLASS="l">943</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">944</TD><TD>        long len = getLengthProperty(cx, thisObj);</TD></TR><TR><TD CLASS="l">945</TD><TD> </TD></TR><TR CLASS="c"><TD CLASS="l">946</TD><TD>        long half = len / 2;</TD></TR><TR CLASS="c"><TD CLASS="l">947</TD><TD>        for(long i=0; i &lt; half; i++) {</TD></TR><TR CLASS="c"><TD CLASS="l">948</TD><TD>            long j = len - i - 1;</TD></TR><TR CLASS="c"><TD CLASS="l">949</TD><TD>            Object temp1 = getRawElem(thisObj, i);</TD></TR><TR CLASS="c"><TD CLASS="l">950</TD><TD>            Object temp2 = getRawElem(thisObj, j);</TD></TR><TR CLASS="c"><TD CLASS="l">951</TD><TD>            setRawElem(cx, thisObj, i, temp2);</TD></TR><TR CLASS="c"><TD CLASS="l">952</TD><TD>            setRawElem(cx, thisObj, j, temp1);</TD></TR><TR><TD CLASS="l">953</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">954</TD><TD>        return thisObj;</TD></TR><TR><TD CLASS="l">955</TD><TD>    }</TD></TR><TR><TD CLASS="l">956</TD><TD> </TD></TR><TR><TD CLASS="l">957</TD><TD>    /**</TD></TR><TR><TD CLASS="l">958</TD><TD>     * See ECMA 15.4.4.5</TD></TR><TR><TD CLASS="l">959</TD><TD>     */</TD></TR><TR><TD CLASS="l"><A NAME="35">960</A></TD><TD>    private static Scriptable js_sort(final Context cx, final Scriptable scope,</TD></TR><TR><TD CLASS="l">961</TD><TD>            final Scriptable thisObj, final Object[] args)</TD></TR><TR><TD CLASS="l">962</TD><TD>    {</TD></TR><TR><TD CLASS="l">963</TD><TD>        final Comparator&lt;Object&gt; comparator;</TD></TR><TR CLASS="c"><TD CLASS="l">964</TD><TD>        if (args.length &gt; 0 &amp;&amp; Undefined.instance != args[0]) {</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="b">965</A></TD><TD>            final Callable jsCompareFunction = ScriptRuntime</TD></TR><TR><TD CLASS="l">966</TD><TD>                    .getValueFunctionAndThis(args[0], cx);</TD></TR><TR CLASS="c"><TD CLASS="l">967</TD><TD>            final Scriptable funThis = ScriptRuntime.lastStoredScriptable(cx);</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="c">968</A></TD><TD>            final Object[] cmpBuf = new Object[2]; // Buffer for cmp arguments</TD></TR><TR CLASS="c"><TD CLASS="l">969</TD><TD>            comparator = new Comparator&lt;Object&gt;() {</TD></TR><TR><TD CLASS="l">970</TD><TD>                public int compare(final Object x, final Object y) {</TD></TR><TR><TD CLASS="l">971</TD><TD>                    // sort undefined to end</TD></TR><TR CLASS="c"><TD CLASS="l">972</TD><TD>                    if (x == NOT_FOUND) {</TD></TR><TR CLASS="p"><TD CLASS="l" TITLE="71% line coverage (5 out of 7 instructions)">973</TD><TD TITLE="71% line coverage (5 out of 7 instructions)">                        return y == NOT_FOUND ? 0 : 1;</TD></TR><TR CLASS="c"><TD CLASS="l">974</TD><TD>                    } else if (y == NOT_FOUND) {</TD></TR><TR CLASS="z"><TD CLASS="l">975</TD><TD>                        return -1;</TD></TR><TR CLASS="c"><TD CLASS="l">976</TD><TD>                    } else if (x == Undefined.instance) {</TD></TR><TR CLASS="p"><TD CLASS="l" TITLE="71% line coverage (5 out of 7 instructions)">977</TD><TD TITLE="71% line coverage (5 out of 7 instructions)">                        return y == Undefined.instance ? 0 : 1;</TD></TR><TR CLASS="c"><TD CLASS="l">978</TD><TD>                    } else if (y == Undefined.instance) {</TD></TR><TR CLASS="z"><TD CLASS="l">979</TD><TD>                        return -1;</TD></TR><TR><TD CLASS="l">980</TD><TD>                    }</TD></TR><TR><TD CLASS="l">981</TD><TD> </TD></TR><TR CLASS="c"><TD CLASS="l">982</TD><TD>                    cmpBuf[0] = x;</TD></TR><TR CLASS="c"><TD CLASS="l">983</TD><TD>                    cmpBuf[1] = y;</TD></TR><TR CLASS="c"><TD CLASS="l">984</TD><TD>                    Object ret = jsCompareFunction.call(cx, scope, funThis,</TD></TR><TR><TD CLASS="l">985</TD><TD>                            cmpBuf);</TD></TR><TR CLASS="c"><TD CLASS="l">986</TD><TD>                    final double d = ScriptRuntime.toNumber(ret);</TD></TR><TR CLASS="c"><TD CLASS="l">987</TD><TD>                    if (d &lt; 0) {</TD></TR><TR CLASS="c"><TD CLASS="l">988</TD><TD>                        return -1;</TD></TR><TR CLASS="c"><TD CLASS="l">989</TD><TD>                    } else if (d &gt; 0) {</TD></TR><TR CLASS="c"><TD CLASS="l">990</TD><TD>                        return +1;</TD></TR><TR><TD CLASS="l">991</TD><TD>                    }</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="65">992</A></TD><TD>                    return 0; // ??? double and 0???</TD></TR><TR><TD CLASS="l">993</TD><TD>                }</TD></TR><TR><TD CLASS="l">994</TD><TD>            };</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="66">995</A></TD><TD>        } else {</TD></TR><TR CLASS="c"><TD CLASS="l">996</TD><TD>            comparator = new Comparator&lt;Object&gt;() {</TD></TR><TR><TD CLASS="l">997</TD><TD>                public int compare(final Object x, final Object y) {</TD></TR><TR><TD CLASS="l">998</TD><TD>                    // sort undefined to end</TD></TR><TR CLASS="c"><TD CLASS="l">999</TD><TD>                    if (x == NOT_FOUND) {</TD></TR><TR CLASS="c"><TD CLASS="l">1000</TD><TD>                        return y == NOT_FOUND ? 0 : 1;</TD></TR><TR CLASS="c"><TD CLASS="l">1001</TD><TD>                    } else if (y == NOT_FOUND) {</TD></TR><TR CLASS="c"><TD CLASS="l">1002</TD><TD>                        return -1;</TD></TR><TR CLASS="c"><TD CLASS="l">1003</TD><TD>                    } else if (x == Undefined.instance) {</TD></TR><TR CLASS="p"><TD CLASS="l" TITLE="71% line coverage (5 out of 7 instructions)">1004</TD><TD TITLE="71% line coverage (5 out of 7 instructions)">                        return y == Undefined.instance ? 0 : 1;</TD></TR><TR CLASS="c"><TD CLASS="l">1005</TD><TD>                    } else if (y == Undefined.instance) {</TD></TR><TR CLASS="c"><TD CLASS="l">1006</TD><TD>                        return -1;</TD></TR><TR><TD CLASS="l">1007</TD><TD>                    }</TD></TR><TR><TD CLASS="l">1008</TD><TD> </TD></TR><TR CLASS="c"><TD CLASS="l">1009</TD><TD>                    final String a = ScriptRuntime.toString(x);</TD></TR><TR CLASS="c"><TD CLASS="l">1010</TD><TD>                    final String b = ScriptRuntime.toString(y);</TD></TR><TR CLASS="c"><TD CLASS="l">1011</TD><TD>                    return a.compareTo(b);</TD></TR><TR><TD CLASS="l">1012</TD><TD>                }</TD></TR><TR><TD CLASS="l">1013</TD><TD>            };</TD></TR><TR><TD CLASS="l">1014</TD><TD>        }</TD></TR><TR><TD CLASS="l">1015</TD><TD> </TD></TR><TR CLASS="c"><TD CLASS="l">1016</TD><TD>        long llength = getLengthProperty(cx, thisObj);</TD></TR><TR CLASS="c"><TD CLASS="l">1017</TD><TD>        final int length = (int) llength;</TD></TR><TR CLASS="c"><TD CLASS="l">1018</TD><TD>        if (llength != length) {</TD></TR><TR CLASS="z"><TD CLASS="l">1019</TD><TD>            throw Context.reportRuntimeError1(</TD></TR><TR><TD CLASS="l">1020</TD><TD>                &#34;msg.arraylength.too.big&#34;, String.valueOf(llength));</TD></TR><TR><TD CLASS="l">1021</TD><TD>        }</TD></TR><TR><TD CLASS="l">1022</TD><TD>        // copy the JS array into a working array, so it can be</TD></TR><TR><TD CLASS="l">1023</TD><TD>        // sorted cheaply.</TD></TR><TR CLASS="c"><TD CLASS="l">1024</TD><TD>        final Object[] working = new Object[length];</TD></TR><TR CLASS="c"><TD CLASS="l">1025</TD><TD>        for (int i = 0; i != length; ++i) {</TD></TR><TR CLASS="c"><TD CLASS="l">1026</TD><TD>            working[i] = getRawElem(thisObj, i);</TD></TR><TR><TD CLASS="l">1027</TD><TD>        }</TD></TR><TR><TD CLASS="l">1028</TD><TD> </TD></TR><TR CLASS="c"><TD CLASS="l">1029</TD><TD>        Arrays.sort(working, comparator);</TD></TR><TR><TD CLASS="l">1030</TD><TD> </TD></TR><TR><TD CLASS="l">1031</TD><TD>        // copy the working array back into thisObj</TD></TR><TR CLASS="c"><TD CLASS="l">1032</TD><TD>        for (int i = 0; i &lt; length; ++i) {</TD></TR><TR CLASS="c"><TD CLASS="l">1033</TD><TD>            setRawElem(cx, thisObj, i, working[i]);</TD></TR><TR><TD CLASS="l">1034</TD><TD>        }</TD></TR><TR><TD CLASS="l">1035</TD><TD> </TD></TR><TR CLASS="c"><TD CLASS="l">1036</TD><TD>        return thisObj;</TD></TR><TR><TD CLASS="l">1037</TD><TD>    }</TD></TR><TR><TD CLASS="l">1038</TD><TD> </TD></TR><TR><TD CLASS="l">1039</TD><TD>    /**</TD></TR><TR><TD CLASS="l">1040</TD><TD>     * Non-ECMA methods.</TD></TR><TR><TD CLASS="l">1041</TD><TD>     */</TD></TR><TR><TD CLASS="l"><A NAME="2c">1042</A></TD><TD> </TD></TR><TR><TD CLASS="l">1043</TD><TD>    private static Object js_push(Context cx, Scriptable thisObj,</TD></TR><TR><TD CLASS="l">1044</TD><TD>                                  Object[] args)</TD></TR><TR><TD CLASS="l">1045</TD><TD>    {</TD></TR><TR CLASS="c"><TD CLASS="l">1046</TD><TD>        if (thisObj instanceof NativeArray) {</TD></TR><TR CLASS="c"><TD CLASS="l">1047</TD><TD>            NativeArray na = (NativeArray) thisObj;</TD></TR><TR CLASS="c"><TD CLASS="l">1048</TD><TD>            if (na.denseOnly &amp;&amp;</TD></TR><TR><TD CLASS="l">1049</TD><TD>                na.ensureCapacity((int) na.length + args.length))</TD></TR><TR><TD CLASS="l">1050</TD><TD>            {</TD></TR><TR CLASS="c"><TD CLASS="l">1051</TD><TD>                for (int i = 0; i &lt; args.length; i++) {</TD></TR><TR CLASS="c"><TD CLASS="l">1052</TD><TD>                    na.dense[(int)na.length++] = args[i];</TD></TR><TR><TD CLASS="l">1053</TD><TD>                }</TD></TR><TR CLASS="c"><TD CLASS="l">1054</TD><TD>                return ScriptRuntime.wrapNumber(na.length);</TD></TR><TR><TD CLASS="l">1055</TD><TD>            }</TD></TR><TR><TD CLASS="l">1056</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">1057</TD><TD>        long length = getLengthProperty(cx, thisObj);</TD></TR><TR CLASS="c"><TD CLASS="l">1058</TD><TD>        for (int i = 0; i &lt; args.length; i++) {</TD></TR><TR CLASS="c"><TD CLASS="l">1059</TD><TD>            setElem(cx, thisObj, length + i, args[i]);</TD></TR><TR><TD CLASS="l">1060</TD><TD>        }</TD></TR><TR><TD CLASS="l">1061</TD><TD> </TD></TR><TR CLASS="c"><TD CLASS="l">1062</TD><TD>        length += args.length;</TD></TR><TR CLASS="c"><TD CLASS="l">1063</TD><TD>        Object lengthObj = setLengthProperty(cx, thisObj, length);</TD></TR><TR><TD CLASS="l">1064</TD><TD> </TD></TR><TR><TD CLASS="l">1065</TD><TD>        /*</TD></TR><TR><TD CLASS="l">1066</TD><TD>         * If JS1.2, follow Perl4 by returning the last thing pushed.</TD></TR><TR><TD CLASS="l">1067</TD><TD>         * Otherwise, return the new array length.</TD></TR><TR><TD CLASS="l">1068</TD><TD>         */</TD></TR><TR CLASS="c"><TD CLASS="l">1069</TD><TD>        if (cx.getLanguageVersion() == Context.VERSION_1_2)</TD></TR><TR><TD CLASS="l">1070</TD><TD>            // if JS1.2 &amp;&amp; no arguments, return undefined.</TD></TR><TR CLASS="z"><TD CLASS="l">1071</TD><TD>            return args.length == 0</TD></TR><TR><TD CLASS="l">1072</TD><TD>                ? Undefined.instance</TD></TR><TR><TD CLASS="l">1073</TD><TD>                : args[args.length - 1];</TD></TR><TR><TD CLASS="l">1074</TD><TD> </TD></TR><TR><TD CLASS="l">1075</TD><TD>        else</TD></TR><TR CLASS="c"><TD CLASS="l">1076</TD><TD>            return lengthObj;</TD></TR><TR><TD CLASS="l">1077</TD><TD>    }</TD></TR><TR><TD CLASS="l">1078</TD><TD> </TD></TR><TR><TD CLASS="l"><A NAME="39">1079</A></TD><TD>    private static Object js_pop(Context cx, Scriptable thisObj,</TD></TR><TR><TD CLASS="l">1080</TD><TD>                                 Object[] args)</TD></TR><TR><TD CLASS="l">1081</TD><TD>    {</TD></TR><TR><TD CLASS="l">1082</TD><TD>        Object result;</TD></TR><TR CLASS="c"><TD CLASS="l">1083</TD><TD>        if (thisObj instanceof NativeArray) {</TD></TR><TR CLASS="c"><TD CLASS="l">1084</TD><TD>            NativeArray na = (NativeArray) thisObj;</TD></TR><TR CLASS="c"><TD CLASS="l">1085</TD><TD>            if (na.denseOnly &amp;&amp; na.length &gt; 0) {</TD></TR><TR CLASS="c"><TD CLASS="l">1086</TD><TD>                na.length--;</TD></TR><TR CLASS="c"><TD CLASS="l">1087</TD><TD>                result = na.dense[(int)na.length];</TD></TR><TR CLASS="c"><TD CLASS="l">1088</TD><TD>                na.dense[(int)na.length] = NOT_FOUND;</TD></TR><TR CLASS="c"><TD CLASS="l">1089</TD><TD>                return result;</TD></TR><TR><TD CLASS="l">1090</TD><TD>            }</TD></TR><TR><TD CLASS="l">1091</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">1092</TD><TD>        long length = getLengthProperty(cx, thisObj);</TD></TR><TR CLASS="c"><TD CLASS="l">1093</TD><TD>        if (length &gt; 0) {</TD></TR><TR CLASS="c"><TD CLASS="l">1094</TD><TD>            length--;</TD></TR><TR><TD CLASS="l">1095</TD><TD> </TD></TR><TR><TD CLASS="l">1096</TD><TD>            // Get the to-be-deleted property's value.</TD></TR><TR CLASS="c"><TD CLASS="l">1097</TD><TD>            result = getElem(cx, thisObj, length);</TD></TR><TR><TD CLASS="l">1098</TD><TD> </TD></TR><TR><TD CLASS="l">1099</TD><TD>            // We don't need to delete the last property, because</TD></TR><TR><TD CLASS="l">1100</TD><TD>            // setLength does that for us.</TD></TR><TR><TD CLASS="l">1101</TD><TD>        } else {</TD></TR><TR CLASS="z"><TD CLASS="l">1102</TD><TD>            result = Undefined.instance;</TD></TR><TR><TD CLASS="l">1103</TD><TD>        }</TD></TR><TR><TD CLASS="l">1104</TD><TD>        // necessary to match js even when length &lt; 0; js pop will give a</TD></TR><TR><TD CLASS="l">1105</TD><TD>        // length property to any target it is called on.</TD></TR><TR CLASS="c"><TD CLASS="l">1106</TD><TD>        setLengthProperty(cx, thisObj, length);</TD></TR><TR><TD CLASS="l">1107</TD><TD> </TD></TR><TR CLASS="c"><TD CLASS="l">1108</TD><TD>        return result;</TD></TR><TR><TD CLASS="l">1109</TD><TD>    }</TD></TR><TR><TD CLASS="l"><A NAME="58">1110</A></TD><TD> </TD></TR><TR><TD CLASS="l">1111</TD><TD>    private static Object js_shift(Context cx, Scriptable thisObj,</TD></TR><TR><TD CLASS="l">1112</TD><TD>                                   Object[] args)</TD></TR><TR><TD CLASS="l">1113</TD><TD>    {</TD></TR><TR CLASS="c"><TD CLASS="l">1114</TD><TD>        if (thisObj instanceof NativeArray) {</TD></TR><TR CLASS="c"><TD CLASS="l">1115</TD><TD>            NativeArray na = (NativeArray) thisObj;</TD></TR><TR CLASS="c"><TD CLASS="l">1116</TD><TD>            if (na.denseOnly &amp;&amp; na.length &gt; 0) {</TD></TR><TR CLASS="c"><TD CLASS="l">1117</TD><TD>                na.length--;</TD></TR><TR CLASS="c"><TD CLASS="l">1118</TD><TD>                Object result = na.dense[0];</TD></TR><TR CLASS="c"><TD CLASS="l">1119</TD><TD>                System.arraycopy(na.dense, 1, na.dense, 0, (int)na.length);</TD></TR><TR CLASS="c"><TD CLASS="l">1120</TD><TD>                na.dense[(int)na.length] = NOT_FOUND;</TD></TR><TR CLASS="c"><TD CLASS="l">1121</TD><TD>                return result == NOT_FOUND ? Undefined.instance : result;</TD></TR><TR><TD CLASS="l">1122</TD><TD>            }</TD></TR><TR><TD CLASS="l">1123</TD><TD>        }</TD></TR><TR><TD CLASS="l">1124</TD><TD>        Object result;</TD></TR><TR CLASS="c"><TD CLASS="l">1125</TD><TD>        long length = getLengthProperty(cx, thisObj);</TD></TR><TR CLASS="c"><TD CLASS="l">1126</TD><TD>        if (length &gt; 0) {</TD></TR><TR CLASS="c"><TD CLASS="l">1127</TD><TD>            long i = 0;</TD></TR><TR CLASS="c"><TD CLASS="l">1128</TD><TD>            length--;</TD></TR><TR><TD CLASS="l">1129</TD><TD> </TD></TR><TR><TD CLASS="l">1130</TD><TD>            // Get the to-be-deleted property's value.</TD></TR><TR CLASS="c"><TD CLASS="l">1131</TD><TD>            result = getElem(cx, thisObj, i);</TD></TR><TR><TD CLASS="l">1132</TD><TD> </TD></TR><TR><TD CLASS="l">1133</TD><TD>            /*</TD></TR><TR><TD CLASS="l">1134</TD><TD>             * Slide down the array above the first element.  Leave i</TD></TR><TR><TD CLASS="l">1135</TD><TD>             * set to point to the last element.</TD></TR><TR><TD CLASS="l">1136</TD><TD>             */</TD></TR><TR CLASS="c"><TD CLASS="l">1137</TD><TD>            if (length &gt; 0) {</TD></TR><TR CLASS="c"><TD CLASS="l">1138</TD><TD>                for (i = 1; i &lt;= length; i++) {</TD></TR><TR CLASS="c"><TD CLASS="l">1139</TD><TD>                    Object temp = getRawElem(thisObj, i);</TD></TR><TR CLASS="c"><TD CLASS="l">1140</TD><TD>                    setRawElem(cx, thisObj, i - 1, temp);</TD></TR><TR><TD CLASS="l">1141</TD><TD>                }</TD></TR><TR><TD CLASS="l">1142</TD><TD>            }</TD></TR><TR><TD CLASS="l">1143</TD><TD>            // We don't need to delete the last property, because</TD></TR><TR><TD CLASS="l">1144</TD><TD>            // setLength does that for us.</TD></TR><TR CLASS="c"><TD CLASS="l">1145</TD><TD>        } else {</TD></TR><TR CLASS="c"><TD CLASS="l">1146</TD><TD>            result = Undefined.instance;</TD></TR><TR><TD CLASS="l">1147</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">1148</TD><TD>        setLengthProperty(cx, thisObj, length);</TD></TR><TR CLASS="c"><TD CLASS="l">1149</TD><TD>        return result;</TD></TR><TR><TD CLASS="l">1150</TD><TD>    }</TD></TR><TR><TD CLASS="l"><A NAME="3a">1151</A></TD><TD> </TD></TR><TR><TD CLASS="l">1152</TD><TD>    private static Object js_unshift(Context cx, Scriptable thisObj,</TD></TR><TR><TD CLASS="l">1153</TD><TD>                                     Object[] args)</TD></TR><TR><TD CLASS="l">1154</TD><TD>    {</TD></TR><TR CLASS="c"><TD CLASS="l">1155</TD><TD>        if (thisObj instanceof NativeArray) {</TD></TR><TR CLASS="c"><TD CLASS="l">1156</TD><TD>            NativeArray na = (NativeArray) thisObj;</TD></TR><TR CLASS="c"><TD CLASS="l">1157</TD><TD>            if (na.denseOnly &amp;&amp;</TD></TR><TR><TD CLASS="l">1158</TD><TD>                na.ensureCapacity((int)na.length + args.length))</TD></TR><TR><TD CLASS="l">1159</TD><TD>            {</TD></TR><TR CLASS="c"><TD CLASS="l">1160</TD><TD>                System.arraycopy(na.dense, 0, na.dense, args.length,</TD></TR><TR><TD CLASS="l">1161</TD><TD>                                 (int) na.length);</TD></TR><TR CLASS="c"><TD CLASS="l">1162</TD><TD>                for (int i = 0; i &lt; args.length; i++) {</TD></TR><TR CLASS="c"><TD CLASS="l">1163</TD><TD>                    na.dense[i] = args[i];</TD></TR><TR><TD CLASS="l">1164</TD><TD>                }</TD></TR><TR CLASS="c"><TD CLASS="l">1165</TD><TD>                na.length += args.length;</TD></TR><TR CLASS="c"><TD CLASS="l">1166</TD><TD>                return ScriptRuntime.wrapNumber(na.length);</TD></TR><TR><TD CLASS="l">1167</TD><TD>            }</TD></TR><TR><TD CLASS="l">1168</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">1169</TD><TD>        long length = getLengthProperty(cx, thisObj);</TD></TR><TR CLASS="c"><TD CLASS="l">1170</TD><TD>        int argc = args.length;</TD></TR><TR><TD CLASS="l">1171</TD><TD> </TD></TR><TR CLASS="c"><TD CLASS="l">1172</TD><TD>        if (args.length &gt; 0) {</TD></TR><TR><TD CLASS="l">1173</TD><TD>            /*  Slide up the array to make room for args at the bottom */</TD></TR><TR CLASS="c"><TD CLASS="l">1174</TD><TD>            if (length &gt; 0) {</TD></TR><TR CLASS="c"><TD CLASS="l">1175</TD><TD>                for (long last = length - 1; last &gt;= 0; last--) {</TD></TR><TR CLASS="c"><TD CLASS="l">1176</TD><TD>                    Object temp = getRawElem(thisObj, last);</TD></TR><TR CLASS="c"><TD CLASS="l">1177</TD><TD>                    setRawElem(cx, thisObj, last + argc, temp);</TD></TR><TR><TD CLASS="l">1178</TD><TD>                }</TD></TR><TR><TD CLASS="l">1179</TD><TD>            }</TD></TR><TR><TD CLASS="l">1180</TD><TD> </TD></TR><TR><TD CLASS="l">1181</TD><TD>            /* Copy from argv to the bottom of the array. */</TD></TR><TR CLASS="c"><TD CLASS="l">1182</TD><TD>            for (int i = 0; i &lt; args.length; i++) {</TD></TR><TR CLASS="c"><TD CLASS="l">1183</TD><TD>                setElem(cx, thisObj, i, args[i]);</TD></TR><TR><TD CLASS="l">1184</TD><TD>            }</TD></TR><TR><TD CLASS="l">1185</TD><TD> </TD></TR><TR><TD CLASS="l">1186</TD><TD>            /* Follow Perl by returning the new array length. */</TD></TR><TR CLASS="c"><TD CLASS="l">1187</TD><TD>            length += args.length;</TD></TR><TR CLASS="c"><TD CLASS="l">1188</TD><TD>            return setLengthProperty(cx, thisObj, length);</TD></TR><TR><TD CLASS="l">1189</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">1190</TD><TD>        return ScriptRuntime.wrapNumber(length);</TD></TR><TR><TD CLASS="l">1191</TD><TD>    }</TD></TR><TR><TD CLASS="l"><A NAME="28">1192</A></TD><TD> </TD></TR><TR><TD CLASS="l">1193</TD><TD>    private static Object js_splice(Context cx, Scriptable scope,</TD></TR><TR><TD CLASS="l">1194</TD><TD>                                    Scriptable thisObj, Object[] args)</TD></TR><TR><TD CLASS="l">1195</TD><TD>    {</TD></TR><TR CLASS="c"><TD CLASS="l">1196</TD><TD>            NativeArray na = null;</TD></TR><TR CLASS="c"><TD CLASS="l">1197</TD><TD>            boolean denseMode = false;</TD></TR><TR CLASS="c"><TD CLASS="l">1198</TD><TD>        if (thisObj instanceof NativeArray) {</TD></TR><TR CLASS="c"><TD CLASS="l">1199</TD><TD>            na = (NativeArray) thisObj;</TD></TR><TR CLASS="c"><TD CLASS="l">1200</TD><TD>            denseMode = na.denseOnly;</TD></TR><TR><TD CLASS="l">1201</TD><TD>        }</TD></TR><TR><TD CLASS="l">1202</TD><TD> </TD></TR><TR><TD CLASS="l">1203</TD><TD>        /* create an empty Array to return. */</TD></TR><TR CLASS="c"><TD CLASS="l">1204</TD><TD>        scope = getTopLevelScope(scope);</TD></TR><TR CLASS="c"><TD CLASS="l">1205</TD><TD>        int argc = args.length;</TD></TR><TR CLASS="c"><TD CLASS="l">1206</TD><TD>        if (argc == 0)</TD></TR><TR CLASS="z"><TD CLASS="l">1207</TD><TD>            return cx.newArray(scope, 0);</TD></TR><TR CLASS="c"><TD CLASS="l">1208</TD><TD>        long length = getLengthProperty(cx, thisObj);</TD></TR><TR><TD CLASS="l">1209</TD><TD> </TD></TR><TR><TD CLASS="l">1210</TD><TD>        /* Convert the first argument into a starting index. */</TD></TR><TR CLASS="c"><TD CLASS="l">1211</TD><TD>        long begin = toSliceIndex(ScriptRuntime.toInteger(args[0]), length);</TD></TR><TR CLASS="c"><TD CLASS="l">1212</TD><TD>        argc--;</TD></TR><TR><TD CLASS="l">1213</TD><TD> </TD></TR><TR><TD CLASS="l">1214</TD><TD>        /* Convert the second argument into count */</TD></TR><TR><TD CLASS="l">1215</TD><TD>        long count;</TD></TR><TR CLASS="c"><TD CLASS="l">1216</TD><TD>        if (args.length == 1) {</TD></TR><TR CLASS="z"><TD CLASS="l">1217</TD><TD>            count = length - begin;</TD></TR><TR><TD CLASS="l">1218</TD><TD>        } else {</TD></TR><TR CLASS="c"><TD CLASS="l">1219</TD><TD>            double dcount = ScriptRuntime.toInteger(args[1]);</TD></TR><TR CLASS="c"><TD CLASS="l">1220</TD><TD>            if (dcount &lt; 0) {</TD></TR><TR CLASS="z"><TD CLASS="l">1221</TD><TD>                count = 0;</TD></TR><TR CLASS="c"><TD CLASS="l">1222</TD><TD>            } else if (dcount &gt; (length - begin)) {</TD></TR><TR CLASS="c"><TD CLASS="l">1223</TD><TD>                count = length - begin;</TD></TR><TR><TD CLASS="l">1224</TD><TD>            } else {</TD></TR><TR CLASS="c"><TD CLASS="l">1225</TD><TD>                count = (long)dcount;</TD></TR><TR><TD CLASS="l">1226</TD><TD>            }</TD></TR><TR CLASS="c"><TD CLASS="l">1227</TD><TD>            argc--;</TD></TR><TR><TD CLASS="l">1228</TD><TD>        }</TD></TR><TR><TD CLASS="l">1229</TD><TD> </TD></TR><TR CLASS="c"><TD CLASS="l">1230</TD><TD>        long end = begin + count;</TD></TR><TR><TD CLASS="l">1231</TD><TD> </TD></TR><TR><TD CLASS="l">1232</TD><TD>        /* If there are elements to remove, put them into the return value. */</TD></TR><TR><TD CLASS="l">1233</TD><TD>        Object result;</TD></TR><TR CLASS="c"><TD CLASS="l">1234</TD><TD>        if (count != 0) {</TD></TR><TR CLASS="c"><TD CLASS="l">1235</TD><TD>            if (count == 1</TD></TR><TR><TD CLASS="l">1236</TD><TD>                &amp;&amp; (cx.getLanguageVersion() == Context.VERSION_1_2))</TD></TR><TR><TD CLASS="l">1237</TD><TD>            {</TD></TR><TR><TD CLASS="l">1238</TD><TD>                /*</TD></TR><TR><TD CLASS="l">1239</TD><TD>                 * JS lacks &#34;list context&#34;, whereby in Perl one turns the</TD></TR><TR><TD CLASS="l">1240</TD><TD>                 * single scalar that's spliced out into an array just by</TD></TR><TR><TD CLASS="l">1241</TD><TD>                 * assigning it to @single instead of $single, or by using it</TD></TR><TR><TD CLASS="l">1242</TD><TD>                 * as Perl push's first argument, for instance.</TD></TR><TR><TD CLASS="l">1243</TD><TD>                 *</TD></TR><TR><TD CLASS="l">1244</TD><TD>                 * JS1.2 emulated Perl too closely and returned a non-Array for</TD></TR><TR><TD CLASS="l">1245</TD><TD>                 * the single-splice-out case, requiring callers to test and</TD></TR><TR><TD CLASS="l">1246</TD><TD>                 * wrap in [] if necessary.  So JS1.3, default, and other</TD></TR><TR><TD CLASS="l">1247</TD><TD>                 * versions all return an array of length 1 for uniformity.</TD></TR><TR><TD CLASS="l">1248</TD><TD>                 */</TD></TR><TR CLASS="c"><TD CLASS="l">1249</TD><TD>                result = getElem(cx, thisObj, begin);</TD></TR><TR><TD CLASS="l">1250</TD><TD>            } else {</TD></TR><TR CLASS="c"><TD CLASS="l">1251</TD><TD>                    if (denseMode) {</TD></TR><TR CLASS="c"><TD CLASS="l">1252</TD><TD>                    int intLen = (int) (end - begin);</TD></TR><TR CLASS="c"><TD CLASS="l">1253</TD><TD>                    Object[] copy = new Object[intLen];</TD></TR><TR CLASS="c"><TD CLASS="l">1254</TD><TD>                    System.arraycopy(na.dense, (int) begin, copy, 0, intLen);</TD></TR><TR CLASS="c"><TD CLASS="l">1255</TD><TD>                    result = cx.newArray(scope, copy);</TD></TR><TR CLASS="c"><TD CLASS="l">1256</TD><TD>                } else {</TD></TR><TR CLASS="c"><TD CLASS="l">1257</TD><TD>                    Scriptable resultArray = cx.newArray(scope, 0);</TD></TR><TR CLASS="c"><TD CLASS="l">1258</TD><TD>                    for (long last = begin; last != end; last++) {</TD></TR><TR CLASS="c"><TD CLASS="l">1259</TD><TD>                        Object temp = getRawElem(thisObj, last);</TD></TR><TR CLASS="c"><TD CLASS="l">1260</TD><TD>                        if (temp != NOT_FOUND) {</TD></TR><TR CLASS="c"><TD CLASS="l">1261</TD><TD>                            setElem(cx, resultArray, last - begin, temp);</TD></TR><TR><TD CLASS="l">1262</TD><TD>                        }</TD></TR><TR><TD CLASS="l">1263</TD><TD>                    }</TD></TR><TR><TD CLASS="l">1264</TD><TD>                    // Need to set length for sparse result array</TD></TR><TR CLASS="c"><TD CLASS="l">1265</TD><TD>                    setLengthProperty(cx, resultArray, end - begin);</TD></TR><TR CLASS="c"><TD CLASS="l">1266</TD><TD>                    result = resultArray;</TD></TR><TR CLASS="c"><TD CLASS="l">1267</TD><TD>                    }</TD></TR><TR><TD CLASS="l">1268</TD><TD>            }</TD></TR><TR><TD CLASS="l">1269</TD><TD>        } else { // (count == 0)</TD></TR><TR CLASS="c"><TD CLASS="l">1270</TD><TD>                if (cx.getLanguageVersion() == Context.VERSION_1_2) {</TD></TR><TR><TD CLASS="l">1271</TD><TD>                /* Emulate C JS1.2; if no elements are removed, return undefined. */</TD></TR><TR CLASS="c"><TD CLASS="l">1272</TD><TD>                result = Undefined.instance;</TD></TR><TR><TD CLASS="l">1273</TD><TD>            } else {</TD></TR><TR CLASS="z"><TD CLASS="l">1274</TD><TD>                result = cx.newArray(scope, 0);</TD></TR><TR><TD CLASS="l">1275</TD><TD>            }</TD></TR><TR><TD CLASS="l">1276</TD><TD>        }</TD></TR><TR><TD CLASS="l">1277</TD><TD> </TD></TR><TR><TD CLASS="l">1278</TD><TD>        /* Find the direction (up or down) to copy and make way for argv. */</TD></TR><TR CLASS="c"><TD CLASS="l">1279</TD><TD>        long delta = argc - count;</TD></TR><TR CLASS="c"><TD CLASS="l">1280</TD><TD>        if (denseMode &amp;&amp; length + delta &lt; Integer.MAX_VALUE &amp;&amp;</TD></TR><TR><TD CLASS="l">1281</TD><TD>            na.ensureCapacity((int) (length + delta)))</TD></TR><TR><TD CLASS="l">1282</TD><TD>        {</TD></TR><TR CLASS="c"><TD CLASS="l">1283</TD><TD>            System.arraycopy(na.dense, (int) end, na.dense,</TD></TR><TR><TD CLASS="l">1284</TD><TD>                             (int) (begin + argc), (int) (length - end));</TD></TR><TR CLASS="c"><TD CLASS="l">1285</TD><TD>            if (argc &gt; 0) {</TD></TR><TR CLASS="c"><TD CLASS="l">1286</TD><TD>                System.arraycopy(args, 2, na.dense, (int) begin, argc);</TD></TR><TR><TD CLASS="l">1287</TD><TD>            }</TD></TR><TR CLASS="c"><TD CLASS="l">1288</TD><TD>            if (delta &lt; 0) {</TD></TR><TR CLASS="c"><TD CLASS="l">1289</TD><TD>                Arrays.fill(na.dense, (int) (length + delta), (int) length,</TD></TR><TR><TD CLASS="l">1290</TD><TD>                            NOT_FOUND);</TD></TR><TR><TD CLASS="l">1291</TD><TD>            }</TD></TR><TR CLASS="c"><TD CLASS="l">1292</TD><TD>            na.length = length + delta;</TD></TR><TR CLASS="c"><TD CLASS="l">1293</TD><TD>            return result;</TD></TR><TR><TD CLASS="l">1294</TD><TD>        }</TD></TR><TR><TD CLASS="l">1295</TD><TD> </TD></TR><TR CLASS="c"><TD CLASS="l">1296</TD><TD>        if (delta &gt; 0) {</TD></TR><TR CLASS="z"><TD CLASS="l">1297</TD><TD>            for (long last = length - 1; last &gt;= end; last--) {</TD></TR><TR CLASS="z"><TD CLASS="l">1298</TD><TD>                Object temp = getRawElem(thisObj, last);</TD></TR><TR CLASS="z"><TD CLASS="l">1299</TD><TD>                setRawElem(cx, thisObj, last + delta, temp);</TD></TR><TR><TD CLASS="l">1300</TD><TD>            }</TD></TR><TR CLASS="c"><TD CLASS="l">1301</TD><TD>        } else if (delta &lt; 0) {</TD></TR><TR CLASS="c"><TD CLASS="l">1302</TD><TD>            for (long last = end; last &lt; length; last++) {</TD></TR><TR CLASS="c"><TD CLASS="l">1303</TD><TD>                Object temp = getRawElem(thisObj, last);</TD></TR><TR CLASS="c"><TD CLASS="l">1304</TD><TD>                setRawElem(cx, thisObj, last + delta, temp);</TD></TR><TR><TD CLASS="l">1305</TD><TD>            }</TD></TR><TR><TD CLASS="l">1306</TD><TD>        }</TD></TR><TR><TD CLASS="l">1307</TD><TD> </TD></TR><TR><TD CLASS="l">1308</TD><TD>        /* Copy from argv into the hole to complete the splice. */</TD></TR><TR CLASS="c"><TD CLASS="l">1309</TD><TD>        int argoffset = args.length - argc;</TD></TR><TR CLASS="c"><TD CLASS="l">1310</TD><TD>        for (int i = 0; i &lt; argc; i++) {</TD></TR><TR CLASS="c"><TD CLASS="l">1311</TD><TD>            setElem(cx, thisObj, begin + i, args[i + argoffset]);</TD></TR><TR><TD CLASS="l">1312</TD><TD>        }</TD></TR><TR><TD CLASS="l">1313</TD><TD> </TD></TR><TR><TD CLASS="l">1314</TD><TD>        /* Update length in case we deleted elements from the end. */</TD></TR><TR CLASS="c"><TD CLASS="l">1315</TD><TD>        setLengthProperty(cx, thisObj, length + delta);</TD></TR><TR CLASS="c"><TD CLASS="l">1316</TD><TD>        return result;</TD></TR><TR><TD CLASS="l">1317</TD><TD>    }</TD></TR><TR><TD CLASS="l">1318</TD><TD> </TD></TR><TR><TD CLASS="l">1319</TD><TD>    /*</TD></TR><TR><TD CLASS="l">1320</TD><TD>     * See Ecma 262v3 15.4.4.4</TD></TR><TR><TD CLASS="l">1321</TD><TD>     */</TD></TR><TR><TD CLASS="l"><A NAME="56">1322</A></TD><TD>    private static Scriptable js_concat(Context cx, Scriptable scope,</TD></TR><TR><TD CLASS="l">1323</TD><TD>                                        Scriptable thisObj, Object[] args)</TD></TR><TR><TD CLASS="l">1324</TD><TD>    {</TD></TR><TR><TD CLASS="l">1325</TD><TD>        // create an empty Array to return.</TD></TR><TR CLASS="c"><TD CLASS="l">1326</TD><TD>        scope = getTopLevelScope(scope);</TD></TR><TR CLASS="c"><TD CLASS="l">1327</TD><TD>        Function ctor = ScriptRuntime.getExistingCtor(cx, scope, &#34;Array&#34;);</TD></TR><TR CLASS="c"><TD CLASS="l">1328</TD><TD>        Scriptable result = ctor.construct(cx, scope, ScriptRuntime.emptyArgs);</TD></TR><TR CLASS="c"><TD CLASS="l">1329</TD><TD>        if (thisObj instanceof NativeArray &amp;&amp; result instanceof NativeArray) {</TD></TR><TR CLASS="c"><TD CLASS="l">1330</TD><TD>            NativeArray denseThis = (NativeArray) thisObj;</TD></TR><TR CLASS="c"><TD CLASS="l">1331</TD><TD>            NativeArray denseResult = (NativeArray) result;</TD></TR><TR CLASS="c"><TD CLASS="l">1332</TD><TD>            if (denseThis.denseOnly &amp;&amp; denseResult.denseOnly) {</TD></TR><TR><TD CLASS="l">1333</TD><TD>                // First calculate length of resulting array</TD></TR><TR CLASS="c"><TD CLASS="l">1334</TD><TD>                boolean canUseDense = true;</TD></TR><TR CLASS="c"><TD CLASS="l">1335</TD><TD>                int length = (int) denseThis.length;</TD></TR><TR CLASS="c"><TD CLASS="l">1336</TD><TD>                for (int i = 0; i &lt; args.length &amp;&amp; canUseDense; i++) {</TD></TR><TR CLASS="c"><TD CLASS="l">1337</TD><TD>                    if (args[i] instanceof NativeArray) {</TD></TR><TR><TD CLASS="l">1338</TD><TD>                        // only try to use dense approach for Array-like</TD></TR><TR><TD CLASS="l">1339</TD><TD>                        // objects that are actually NativeArrays</TD></TR><TR CLASS="c"><TD CLASS="l">1340</TD><TD>                        final NativeArray arg = (NativeArray) args[i];</TD></TR><TR CLASS="c"><TD CLASS="l">1341</TD><TD>                        canUseDense = arg.denseOnly;</TD></TR><TR CLASS="c"><TD CLASS="l">1342</TD><TD>                        length += arg.length;</TD></TR><TR CLASS="c"><TD CLASS="l">1343</TD><TD>                    } else {</TD></TR><TR CLASS="c"><TD CLASS="l">1344</TD><TD>                        length++;</TD></TR><TR><TD CLASS="l">1345</TD><TD>                    }</TD></TR><TR><TD CLASS="l">1346</TD><TD>                }</TD></TR><TR CLASS="c"><TD CLASS="l">1347</TD><TD>                if (canUseDense &amp;&amp; denseResult.ensureCapacity(length)) {</TD></TR><TR CLASS="c"><TD CLASS="l">1348</TD><TD>                    System.arraycopy(denseThis.dense, 0, denseResult.dense,</TD></TR><TR><TD CLASS="l">1349</TD><TD>                                     0, (int) denseThis.length);</TD></TR><TR CLASS="c"><TD CLASS="l">1350</TD><TD>                    int cursor = (int) denseThis.length;</TD></TR><TR CLASS="c"><TD CLASS="l">1351</TD><TD>                    for (int i = 0; i &lt; args.length &amp;&amp; canUseDense; i++) {</TD></TR><TR CLASS="c"><TD CLASS="l">1352</TD><TD>                        if (args[i] instanceof NativeArray) {</TD></TR><TR CLASS="c"><TD CLASS="l">1353</TD><TD>                            NativeArray arg = (NativeArray) args[i];</TD></TR><TR CLASS="c"><TD CLASS="l">1354</TD><TD>                            System.arraycopy(arg.dense, 0,</TD></TR><TR><TD CLASS="l">1355</TD><TD>                                    denseResult.dense, cursor,</TD></TR><TR><TD CLASS="l">1356</TD><TD>                                    (int)arg.length);</TD></TR><TR CLASS="c"><TD CLASS="l">1357</TD><TD>                            cursor += (int)arg.length;</TD></TR><TR CLASS="c"><TD CLASS="l">1358</TD><TD>                        } else {</TD></TR><TR CLASS="c"><TD CLASS="l">1359</TD><TD>                            denseResult.dense[cursor++] = args[i];</TD></TR><TR><TD CLASS="l">1360</TD><TD>                        }</TD></TR><TR><TD CLASS="l">1361</TD><TD>                    }</TD></TR><TR CLASS="c"><TD CLASS="l">1362</TD><TD>                    denseResult.length = length;</TD></TR><TR CLASS="c"><TD CLASS="l">1363</TD><TD>                    return result;</TD></TR><TR><TD CLASS="l">1364</TD><TD>                }</TD></TR><TR><TD CLASS="l">1365</TD><TD>            }</TD></TR><TR><TD CLASS="l">1366</TD><TD>        }</TD></TR><TR><TD CLASS="l">1367</TD><TD> </TD></TR><TR><TD CLASS="l">1368</TD><TD>        long length;</TD></TR><TR CLASS="c"><TD CLASS="l">1369</TD><TD>        long slot = 0;</TD></TR><TR><TD CLASS="l">1370</TD><TD> </TD></TR><TR><TD CLASS="l">1371</TD><TD>        /* Put the target in the result array; only add it as an array</TD></TR><TR><TD CLASS="l">1372</TD><TD>         * if it looks like one.</TD></TR><TR><TD CLASS="l">1373</TD><TD>         */</TD></TR><TR CLASS="c"><TD CLASS="l">1374</TD><TD>        if (ScriptRuntime.instanceOf(thisObj, ctor, cx)) {</TD></TR><TR CLASS="c"><TD CLASS="l">1375</TD><TD>            length = getLengthProperty(cx, thisObj);</TD></TR><TR><TD CLASS="l">1376</TD><TD> </TD></TR><TR><TD CLASS="l">1377</TD><TD>            // Copy from the target object into the result</TD></TR><TR CLASS="c"><TD CLASS="l">1378</TD><TD>            for (slot = 0; slot &lt; length; slot++) {</TD></TR><TR CLASS="c"><TD CLASS="l">1379</TD><TD>                Object temp = getRawElem(thisObj, slot);</TD></TR><TR CLASS="c"><TD CLASS="l">1380</TD><TD>                if (temp != NOT_FOUND) {</TD></TR><TR CLASS="c"><TD CLASS="l">1381</TD><TD>                    setElem(cx, result, slot, temp);</TD></TR><TR><TD CLASS="l">1382</TD><TD>                }</TD></TR><TR><TD CLASS="l">1383</TD><TD>            }</TD></TR><TR><TD CLASS="l">1384</TD><TD>        } else {</TD></TR><TR CLASS="c"><TD CLASS="l">1385</TD><TD>            setElem(cx, result, slot++, thisObj);</TD></TR><TR><TD CLASS="l">1386</TD><TD>        }</TD></TR><TR><TD CLASS="l">1387</TD><TD> </TD></TR><TR><TD CLASS="l">1388</TD><TD>        /* Copy from the arguments into the result.  If any argument</TD></TR><TR><TD CLASS="l">1389</TD><TD>         * has a numeric length property, treat it as an array and add</TD></TR><TR><TD CLASS="l">1390</TD><TD>         * elements separately; otherwise, just copy the argument.</TD></TR><TR><TD CLASS="l">1391</TD><TD>         */</TD></TR><TR CLASS="c"><TD CLASS="l">1392</TD><TD>        for (int i = 0; i &lt; args.length; i++) {</TD></TR><TR CLASS="c"><TD CLASS="l">1393</TD><TD>            if (ScriptRuntime.instanceOf(args[i], ctor, cx)) {</TD></TR><TR><TD CLASS="l">1394</TD><TD>                // ScriptRuntime.instanceOf =&gt; instanceof Scriptable</TD></TR><TR CLASS="c"><TD CLASS="l">1395</TD><TD>                Scriptable arg = (Scriptable)args[i];</TD></TR><TR CLASS="c"><TD CLASS="l">1396</TD><TD>                length = getLengthProperty(cx, arg);</TD></TR><TR CLASS="c"><TD CLASS="l">1397</TD><TD>                for (long j = 0; j &lt; length; j++, slot++) {</TD></TR><TR CLASS="c"><TD CLASS="l">1398</TD><TD>                    Object temp = getRawElem(arg, j);</TD></TR><TR CLASS="c"><TD CLASS="l">1399</TD><TD>                    if (temp != NOT_FOUND) {</TD></TR><TR CLASS="c"><TD CLASS="l">1400</TD><TD>                        setElem(cx, result, slot, temp);</TD></TR><TR><TD CLASS="l">1401</TD><TD>                    }</TD></TR><TR><TD CLASS="l">1402</TD><TD>                }</TD></TR><TR CLASS="c"><TD CLASS="l">1403</TD><TD>            } else {</TD></TR><TR CLASS="c"><TD CLASS="l">1404</TD><TD>                setElem(cx, result, slot++, args[i]);</TD></TR><TR><TD CLASS="l">1405</TD><TD>            }</TD></TR><TR><TD CLASS="l">1406</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">1407</TD><TD>        setLengthProperty(cx, result, slot);</TD></TR><TR CLASS="c"><TD CLASS="l">1408</TD><TD>        return result;</TD></TR><TR><TD CLASS="l">1409</TD><TD>    }</TD></TR><TR><TD CLASS="l"><A NAME="34">1410</A></TD><TD> </TD></TR><TR><TD CLASS="l">1411</TD><TD>    private Scriptable js_slice(Context cx, Scriptable thisObj,</TD></TR><TR><TD CLASS="l">1412</TD><TD>                                Object[] args)</TD></TR><TR><TD CLASS="l">1413</TD><TD>    {</TD></TR><TR CLASS="c"><TD CLASS="l">1414</TD><TD>        Scriptable scope = getTopLevelScope(this);</TD></TR><TR CLASS="c"><TD CLASS="l">1415</TD><TD>        Scriptable result = cx.newArray(scope, 0);</TD></TR><TR CLASS="c"><TD CLASS="l">1416</TD><TD>        long length = getLengthProperty(cx, thisObj);</TD></TR><TR><TD CLASS="l">1417</TD><TD> </TD></TR><TR><TD CLASS="l">1418</TD><TD>        long begin, end;</TD></TR><TR CLASS="c"><TD CLASS="l">1419</TD><TD>        if (args.length == 0) {</TD></TR><TR CLASS="z"><TD CLASS="l">1420</TD><TD>            begin = 0;</TD></TR><TR CLASS="z"><TD CLASS="l">1421</TD><TD>            end = length;</TD></TR><TR><TD CLASS="l">1422</TD><TD>        } else {</TD></TR><TR CLASS="c"><TD CLASS="l">1423</TD><TD>            begin = toSliceIndex(ScriptRuntime.toInteger(args[0]), length);</TD></TR><TR CLASS="c"><TD CLASS="l">1424</TD><TD>            if (args.length == 1) {</TD></TR><TR CLASS="c"><TD CLASS="l">1425</TD><TD>                end = length;</TD></TR><TR><TD CLASS="l">1426</TD><TD>            } else {</TD></TR><TR CLASS="c"><TD CLASS="l">1427</TD><TD>                end = toSliceIndex(ScriptRuntime.toInteger(args[1]), length);</TD></TR><TR><TD CLASS="l">1428</TD><TD>            }</TD></TR><TR><TD CLASS="l">1429</TD><TD>        }</TD></TR><TR><TD CLASS="l">1430</TD><TD> </TD></TR><TR CLASS="c"><TD CLASS="l">1431</TD><TD>        for (long slot = begin; slot &lt; end; slot++) {</TD></TR><TR CLASS="c"><TD CLASS="l">1432</TD><TD>            Object temp = getRawElem(thisObj, slot);</TD></TR><TR CLASS="c"><TD CLASS="l">1433</TD><TD>            if (temp != NOT_FOUND) {</TD></TR><TR CLASS="c"><TD CLASS="l">1434</TD><TD>                setElem(cx, result, slot - begin, temp);</TD></TR><TR><TD CLASS="l">1435</TD><TD>            }</TD></TR><TR><TD CLASS="l">1436</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">1437</TD><TD>        setLengthProperty(cx, result, Math.max(0, end - begin));</TD></TR><TR><TD CLASS="l">1438</TD><TD> </TD></TR><TR CLASS="c"><TD CLASS="l">1439</TD><TD>        return result;</TD></TR><TR><TD CLASS="l"><A NAME="64">1440</A></TD><TD>    }</TD></TR><TR><TD CLASS="l">1441</TD><TD> </TD></TR><TR><TD CLASS="l">1442</TD><TD>    private static long toSliceIndex(double value, long length) {</TD></TR><TR><TD CLASS="l">1443</TD><TD>        long result;</TD></TR><TR CLASS="c"><TD CLASS="l">1444</TD><TD>        if (value &lt; 0.0) {</TD></TR><TR CLASS="c"><TD CLASS="l">1445</TD><TD>            if (value + length &lt; 0.0) {</TD></TR><TR CLASS="c"><TD CLASS="l">1446</TD><TD>                result = 0;</TD></TR><TR><TD CLASS="l">1447</TD><TD>            } else {</TD></TR><TR CLASS="c"><TD CLASS="l">1448</TD><TD>                result = (long)(value + length);</TD></TR><TR><TD CLASS="l">1449</TD><TD>            }</TD></TR><TR CLASS="c"><TD CLASS="l">1450</TD><TD>        } else if (value &gt; length) {</TD></TR><TR CLASS="c"><TD CLASS="l">1451</TD><TD>            result = length;</TD></TR><TR><TD CLASS="l">1452</TD><TD>        } else {</TD></TR><TR CLASS="c"><TD CLASS="l">1453</TD><TD>            result = (long)value;</TD></TR><TR><TD CLASS="l">1454</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">1455</TD><TD>        return result;</TD></TR><TR><TD CLASS="l">1456</TD><TD>    }</TD></TR><TR><TD CLASS="l">1457</TD><TD> </TD></TR><TR><TD CLASS="l">1458</TD><TD>    /**</TD></TR><TR><TD CLASS="l">1459</TD><TD>     * Implements the methods &#34;indexOf&#34; and &#34;lastIndexOf&#34;.</TD></TR><TR><TD CLASS="l"><A NAME="3b">1460</A></TD><TD>     */</TD></TR><TR><TD CLASS="l">1461</TD><TD>    private Object indexOfHelper(Context cx, Scriptable thisObj,</TD></TR><TR><TD CLASS="l">1462</TD><TD>                                 Object[] args, boolean isLast)</TD></TR><TR><TD CLASS="l">1463</TD><TD>    {</TD></TR><TR CLASS="p"><TD CLASS="l" TITLE="93% line coverage (14 out of 15 instructions)">1464</TD><TD TITLE="93% line coverage (14 out of 15 instructions)">        Object compareTo = args.length &gt; 0 ? args[0] : Undefined.instance;</TD></TR><TR CLASS="c"><TD CLASS="l">1465</TD><TD>        long length = getLengthProperty(cx, thisObj);</TD></TR><TR><TD CLASS="l">1466</TD><TD>        long start;</TD></TR><TR CLASS="c"><TD CLASS="l">1467</TD><TD>        if (isLast) {</TD></TR><TR><TD CLASS="l">1468</TD><TD>            // lastIndexOf</TD></TR><TR><TD CLASS="l">1469</TD><TD>            /*</TD></TR><TR><TD CLASS="l">1470</TD><TD>             * From http://developer.mozilla.org/en/docs/Core_JavaScript_1.5_Reference:Objects:Array:lastIndexOf</TD></TR><TR><TD CLASS="l">1471</TD><TD>             * The index at which to start searching backwards. Defaults to the</TD></TR><TR><TD CLASS="l">1472</TD><TD>             * array's length, i.e. the whole array will be searched. If the</TD></TR><TR><TD CLASS="l">1473</TD><TD>             * index is greater than or equal to the length of the array, the</TD></TR><TR><TD CLASS="l">1474</TD><TD>             * whole array will be searched. If negative, it is taken as the</TD></TR><TR><TD CLASS="l">1475</TD><TD>             * offset from the end of the array. Note that even when the index</TD></TR><TR><TD CLASS="l">1476</TD><TD>             * is negative, the array is still searched from back to front. If</TD></TR><TR><TD CLASS="l">1477</TD><TD>             * the calculated index is less than 0, -1 is returned, i.e. the</TD></TR><TR><TD CLASS="l">1478</TD><TD>             * array will not be searched.</TD></TR><TR><TD CLASS="l">1479</TD><TD>             */</TD></TR><TR CLASS="c"><TD CLASS="l">1480</TD><TD>            if (args.length &lt; 2) {</TD></TR><TR><TD CLASS="l">1481</TD><TD>                // default</TD></TR><TR CLASS="c"><TD CLASS="l">1482</TD><TD>                start = length-1;</TD></TR><TR><TD CLASS="l">1483</TD><TD>            } else {</TD></TR><TR CLASS="c"><TD CLASS="l">1484</TD><TD>                start = (long)ScriptRuntime.toInteger(args[1]);</TD></TR><TR CLASS="c"><TD CLASS="l">1485</TD><TD>                if (start &gt;= length)</TD></TR><TR CLASS="c"><TD CLASS="l">1486</TD><TD>                    start = length-1;</TD></TR><TR CLASS="c"><TD CLASS="l">1487</TD><TD>                else if (start &lt; 0)</TD></TR><TR CLASS="c"><TD CLASS="l">1488</TD><TD>                    start += length;</TD></TR><TR CLASS="c"><TD CLASS="l">1489</TD><TD>                if (start &lt; 0) return NEGATIVE_ONE;</TD></TR><TR><TD CLASS="l">1490</TD><TD>            }</TD></TR><TR><TD CLASS="l">1491</TD><TD>        } else {</TD></TR><TR><TD CLASS="l">1492</TD><TD>            // indexOf</TD></TR><TR><TD CLASS="l">1493</TD><TD>            /*</TD></TR><TR><TD CLASS="l">1494</TD><TD>             * From http://developer.mozilla.org/en/docs/Core_JavaScript_1.5_Reference:Objects:Array:indexOf</TD></TR><TR><TD CLASS="l">1495</TD><TD>             * The index at which to begin the search. Defaults to 0, i.e. the</TD></TR><TR><TD CLASS="l">1496</TD><TD>             * whole array will be searched. If the index is greater than or</TD></TR><TR><TD CLASS="l">1497</TD><TD>             * equal to the length of the array, -1 is returned, i.e. the array</TD></TR><TR><TD CLASS="l">1498</TD><TD>             * will not be searched. If negative, it is taken as the offset from</TD></TR><TR><TD CLASS="l">1499</TD><TD>             * the end of the array. Note that even when the index is negative,</TD></TR><TR><TD CLASS="l">1500</TD><TD>             * the array is still searched from front to back. If the calculated</TD></TR><TR><TD CLASS="l">1501</TD><TD>             * index is less than 0, the whole array will be searched.</TD></TR><TR><TD CLASS="l">1502</TD><TD>             */</TD></TR><TR CLASS="c"><TD CLASS="l">1503</TD><TD>            if (args.length &lt; 2) {</TD></TR><TR><TD CLASS="l">1504</TD><TD>                // default</TD></TR><TR CLASS="c"><TD CLASS="l">1505</TD><TD>                start = 0;</TD></TR><TR><TD CLASS="l">1506</TD><TD>            } else {</TD></TR><TR CLASS="c"><TD CLASS="l">1507</TD><TD>                start = (long)ScriptRuntime.toInteger(args[1]);</TD></TR><TR CLASS="c"><TD CLASS="l">1508</TD><TD>                if (start &lt; 0) {</TD></TR><TR CLASS="c"><TD CLASS="l">1509</TD><TD>                    start += length;</TD></TR><TR CLASS="c"><TD CLASS="l">1510</TD><TD>                    if (start &lt; 0)</TD></TR><TR CLASS="c"><TD CLASS="l">1511</TD><TD>                        start = 0;</TD></TR><TR><TD CLASS="l">1512</TD><TD>                }</TD></TR><TR CLASS="c"><TD CLASS="l">1513</TD><TD>                if (start &gt; length - 1) return NEGATIVE_ONE;</TD></TR><TR><TD CLASS="l">1514</TD><TD>            }</TD></TR><TR><TD CLASS="l">1515</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">1516</TD><TD>        if (thisObj instanceof NativeArray) {</TD></TR><TR CLASS="c"><TD CLASS="l">1517</TD><TD>            NativeArray na = (NativeArray) thisObj;</TD></TR><TR CLASS="c"><TD CLASS="l">1518</TD><TD>            if (na.denseOnly) {</TD></TR><TR CLASS="c"><TD CLASS="l">1519</TD><TD>                if (isLast) {</TD></TR><TR CLASS="c"><TD CLASS="l">1520</TD><TD>                  for (int i=(int)start; i &gt;= 0; i--) {</TD></TR><TR CLASS="c"><TD CLASS="l">1521</TD><TD>                      if (na.dense[i] != Scriptable.NOT_FOUND &amp;&amp;</TD></TR><TR><TD CLASS="l">1522</TD><TD>                          ScriptRuntime.shallowEq(na.dense[i], compareTo))</TD></TR><TR><TD CLASS="l">1523</TD><TD>                      {</TD></TR><TR CLASS="c"><TD CLASS="l">1524</TD><TD>                          return Long.valueOf(i);</TD></TR><TR><TD CLASS="l">1525</TD><TD>                      }</TD></TR><TR><TD CLASS="l">1526</TD><TD>                  }</TD></TR><TR><TD CLASS="l">1527</TD><TD>                } else {</TD></TR><TR CLASS="c"><TD CLASS="l">1528</TD><TD>                  for (int i=(int)start; i &lt; length; i++) {</TD></TR><TR CLASS="c"><TD CLASS="l">1529</TD><TD>                      if (na.dense[i] != Scriptable.NOT_FOUND &amp;&amp;</TD></TR><TR><TD CLASS="l">1530</TD><TD>                          ScriptRuntime.shallowEq(na.dense[i], compareTo))</TD></TR><TR><TD CLASS="l">1531</TD><TD>                      {</TD></TR><TR CLASS="c"><TD CLASS="l">1532</TD><TD>                          return Long.valueOf(i);</TD></TR><TR><TD CLASS="l">1533</TD><TD>                      }</TD></TR><TR><TD CLASS="l">1534</TD><TD>                  }</TD></TR><TR><TD CLASS="l">1535</TD><TD>                }</TD></TR><TR CLASS="c"><TD CLASS="l">1536</TD><TD>                return NEGATIVE_ONE;</TD></TR><TR><TD CLASS="l">1537</TD><TD>            }</TD></TR><TR><TD CLASS="l">1538</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">1539</TD><TD>        if (isLast) {</TD></TR><TR CLASS="p"><TD CLASS="l" TITLE="92% line coverage (11 out of 12 instructions)">1540</TD><TD TITLE="92% line coverage (11 out of 12 instructions)">          for (long i=start; i &gt;= 0; i--) {</TD></TR><TR CLASS="c"><TD CLASS="l">1541</TD><TD>              Object val = getRawElem(thisObj, i);</TD></TR><TR CLASS="c"><TD CLASS="l">1542</TD><TD>              if (val != NOT_FOUND &amp;&amp; ScriptRuntime.shallowEq(val, compareTo)) {</TD></TR><TR CLASS="c"><TD CLASS="l">1543</TD><TD>                  return Long.valueOf(i);</TD></TR><TR><TD CLASS="l">1544</TD><TD>              }</TD></TR><TR><TD CLASS="l">1545</TD><TD>          }</TD></TR><TR><TD CLASS="l">1546</TD><TD>        } else {</TD></TR><TR CLASS="c"><TD CLASS="l">1547</TD><TD>          for (long i=start; i &lt; length; i++) {</TD></TR><TR CLASS="c"><TD CLASS="l">1548</TD><TD>              Object val = getRawElem(thisObj, i);</TD></TR><TR CLASS="c"><TD CLASS="l">1549</TD><TD>              if (val != NOT_FOUND &amp;&amp; ScriptRuntime.shallowEq(val, compareTo)) {</TD></TR><TR CLASS="c"><TD CLASS="l">1550</TD><TD>                  return Long.valueOf(i);</TD></TR><TR><TD CLASS="l">1551</TD><TD>              }</TD></TR><TR><TD CLASS="l">1552</TD><TD>          }</TD></TR><TR><TD CLASS="l">1553</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">1554</TD><TD>        return NEGATIVE_ONE;</TD></TR><TR><TD CLASS="l">1555</TD><TD>    }</TD></TR><TR><TD CLASS="l">1556</TD><TD> </TD></TR><TR><TD CLASS="l">1557</TD><TD>    /**</TD></TR><TR><TD CLASS="l">1558</TD><TD>     * Implements the methods &#34;every&#34;, &#34;filter&#34;, &#34;forEach&#34;, &#34;map&#34;, and &#34;some&#34;.</TD></TR><TR><TD CLASS="l"><A NAME="2b">1559</A></TD><TD>     */</TD></TR><TR><TD CLASS="l">1560</TD><TD>    private Object iterativeMethod(Context cx, int id, Scriptable scope,</TD></TR><TR><TD CLASS="l">1561</TD><TD>                                   Scriptable thisObj, Object[] args)</TD></TR><TR><TD CLASS="l">1562</TD><TD>    {</TD></TR><TR CLASS="c"><TD CLASS="l">1563</TD><TD>        Object callbackArg = args.length &gt; 0 ? args[0] : Undefined.instance;</TD></TR><TR CLASS="c"><TD CLASS="l">1564</TD><TD>        if (callbackArg == null || !(callbackArg instanceof Function)) {</TD></TR><TR CLASS="c"><TD CLASS="l">1565</TD><TD>            throw ScriptRuntime.notFunctionError(callbackArg);</TD></TR><TR><TD CLASS="l">1566</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">1567</TD><TD>        Function f = (Function) callbackArg;</TD></TR><TR CLASS="c"><TD CLASS="l">1568</TD><TD>        Scriptable parent = ScriptableObject.getTopLevelScope(f);</TD></TR><TR><TD CLASS="l">1569</TD><TD>        Scriptable thisArg;</TD></TR><TR CLASS="p"><TD CLASS="l" TITLE="53% line coverage (10 out of 19 instructions)">1570</TD><TD TITLE="53% line coverage (10 out of 19 instructions)">        if (args.length &lt; 2 || args[1] == null || args[1] == Undefined.instance)</TD></TR><TR><TD CLASS="l">1571</TD><TD>        {</TD></TR><TR CLASS="c"><TD CLASS="l">1572</TD><TD>            thisArg = parent;</TD></TR><TR><TD CLASS="l">1573</TD><TD>        } else {</TD></TR><TR CLASS="z"><TD CLASS="l">1574</TD><TD>            thisArg = ScriptRuntime.toObject(cx, scope, args[1]);</TD></TR><TR><TD CLASS="l">1575</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">1576</TD><TD>        long length = getLengthProperty(cx, thisObj);</TD></TR><TR CLASS="c"><TD CLASS="l">1577</TD><TD>        int resultLength = id == Id_map ? (int) length : 0;</TD></TR><TR CLASS="c"><TD CLASS="l">1578</TD><TD>        Scriptable array = cx.newArray(scope, resultLength);</TD></TR><TR CLASS="c"><TD CLASS="l">1579</TD><TD>        long j=0;</TD></TR><TR CLASS="c"><TD CLASS="l">1580</TD><TD>        for (long i=0; i &lt; length; i++) {</TD></TR><TR CLASS="c"><TD CLASS="l">1581</TD><TD>            Object[] innerArgs = new Object[3];</TD></TR><TR CLASS="c"><TD CLASS="l">1582</TD><TD>            Object elem = getRawElem(thisObj, i);</TD></TR><TR CLASS="c"><TD CLASS="l">1583</TD><TD>            if (elem == Scriptable.NOT_FOUND) {</TD></TR><TR CLASS="z"><TD CLASS="l">1584</TD><TD>                continue;</TD></TR><TR><TD CLASS="l">1585</TD><TD>            }</TD></TR><TR CLASS="c"><TD CLASS="l">1586</TD><TD>            innerArgs[0] = elem;</TD></TR><TR CLASS="c"><TD CLASS="l">1587</TD><TD>            innerArgs[1] = Long.valueOf(i);</TD></TR><TR CLASS="c"><TD CLASS="l">1588</TD><TD>            innerArgs[2] = thisObj;</TD></TR><TR CLASS="c"><TD CLASS="l">1589</TD><TD>            Object result = f.call(cx, parent, thisArg, innerArgs);</TD></TR><TR CLASS="c"><TD CLASS="l">1590</TD><TD>            switch (id) {</TD></TR><TR><TD CLASS="l">1591</TD><TD>              case Id_every:</TD></TR><TR CLASS="c"><TD CLASS="l">1592</TD><TD>                if (!ScriptRuntime.toBoolean(result))</TD></TR><TR CLASS="c"><TD CLASS="l">1593</TD><TD>                    return Boolean.FALSE;</TD></TR><TR><TD CLASS="l">1594</TD><TD>                break;</TD></TR><TR><TD CLASS="l">1595</TD><TD>              case Id_filter:</TD></TR><TR CLASS="c"><TD CLASS="l">1596</TD><TD>                if (ScriptRuntime.toBoolean(result))</TD></TR><TR CLASS="c"><TD CLASS="l">1597</TD><TD>                  setElem(cx, array, j++, innerArgs[0]);</TD></TR><TR><TD CLASS="l">1598</TD><TD>                break;</TD></TR><TR><TD CLASS="l">1599</TD><TD>              case Id_forEach:</TD></TR><TR CLASS="c"><TD CLASS="l">1600</TD><TD>                break;</TD></TR><TR><TD CLASS="l">1601</TD><TD>              case Id_map:</TD></TR><TR CLASS="c"><TD CLASS="l">1602</TD><TD>                setElem(cx, array, i, result);</TD></TR><TR CLASS="c"><TD CLASS="l">1603</TD><TD>                break;</TD></TR><TR><TD CLASS="l">1604</TD><TD>              case Id_some:</TD></TR><TR CLASS="c"><TD CLASS="l">1605</TD><TD>                if (ScriptRuntime.toBoolean(result))</TD></TR><TR CLASS="c"><TD CLASS="l">1606</TD><TD>                    return Boolean.TRUE;</TD></TR><TR><TD CLASS="l">1607</TD><TD>                break;</TD></TR><TR><TD CLASS="l">1608</TD><TD>            }</TD></TR><TR><TD CLASS="l">1609</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">1610</TD><TD>        switch (id) {</TD></TR><TR><TD CLASS="l">1611</TD><TD>          case Id_every:</TD></TR><TR CLASS="c"><TD CLASS="l">1612</TD><TD>            return Boolean.TRUE;</TD></TR><TR><TD CLASS="l">1613</TD><TD>          case Id_filter:</TD></TR><TR><TD CLASS="l">1614</TD><TD>          case Id_map:</TD></TR><TR CLASS="c"><TD CLASS="l">1615</TD><TD>            return array;</TD></TR><TR><TD CLASS="l">1616</TD><TD>          case Id_some:</TD></TR><TR CLASS="z"><TD CLASS="l">1617</TD><TD>            return Boolean.FALSE;</TD></TR><TR><TD CLASS="l">1618</TD><TD>          case Id_forEach:</TD></TR><TR><TD CLASS="l">1619</TD><TD>          default:</TD></TR><TR CLASS="c"><TD CLASS="l">1620</TD><TD>            return Undefined.instance;</TD></TR><TR><TD CLASS="l">1621</TD><TD>        }</TD></TR><TR><TD CLASS="l">1622</TD><TD>    }</TD></TR><TR><TD CLASS="l">1623</TD><TD> </TD></TR><TR><TD CLASS="l">1624</TD><TD>    /**</TD></TR><TR><TD CLASS="l">1625</TD><TD>     * Implements the methods &#34;reduce&#34; and &#34;reduceRight&#34;.</TD></TR><TR><TD CLASS="l"><A NAME="33">1626</A></TD><TD>     */</TD></TR><TR><TD CLASS="l">1627</TD><TD>    private Object reduceMethod(Context cx, int id, Scriptable scope,</TD></TR><TR><TD CLASS="l">1628</TD><TD>                                   Scriptable thisObj, Object[] args)</TD></TR><TR><TD CLASS="l">1629</TD><TD>    {</TD></TR><TR CLASS="p"><TD CLASS="l" TITLE="91% line coverage (10 out of 11 instructions)">1630</TD><TD TITLE="91% line coverage (10 out of 11 instructions)">        Object callbackArg = args.length &gt; 0 ? args[0] : Undefined.instance;</TD></TR><TR CLASS="c"><TD CLASS="l">1631</TD><TD>        if (callbackArg == null || !(callbackArg instanceof Function)) {</TD></TR><TR CLASS="z"><TD CLASS="l">1632</TD><TD>            throw ScriptRuntime.notFunctionError(callbackArg);</TD></TR><TR><TD CLASS="l">1633</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">1634</TD><TD>        Function f = (Function) callbackArg;</TD></TR><TR CLASS="c"><TD CLASS="l">1635</TD><TD>        Scriptable parent = ScriptableObject.getTopLevelScope(f);</TD></TR><TR CLASS="c"><TD CLASS="l">1636</TD><TD>        long length = getLengthProperty(cx, thisObj);</TD></TR><TR><TD CLASS="l">1637</TD><TD>        // hack to serve both reduce and reduceRight with the same loop</TD></TR><TR CLASS="c"><TD CLASS="l">1638</TD><TD>        boolean movingLeft = id == Id_reduce;</TD></TR><TR CLASS="c"><TD CLASS="l">1639</TD><TD>        Object value = args.length &gt; 1 ? args[1] : Scriptable.NOT_FOUND;</TD></TR><TR CLASS="c"><TD CLASS="l">1640</TD><TD>        for (long i = 0; i &lt; length; i++) {</TD></TR><TR CLASS="c"><TD CLASS="l">1641</TD><TD>            long index = movingLeft ? i : (length - 1 - i);</TD></TR><TR CLASS="c"><TD CLASS="l">1642</TD><TD>            Object elem = getRawElem(thisObj, index);</TD></TR><TR CLASS="c"><TD CLASS="l">1643</TD><TD>            if (elem == Scriptable.NOT_FOUND) {</TD></TR><TR CLASS="z"><TD CLASS="l">1644</TD><TD>                continue;</TD></TR><TR><TD CLASS="l">1645</TD><TD>            }</TD></TR><TR CLASS="c"><TD CLASS="l">1646</TD><TD>            if (value == Scriptable.NOT_FOUND) {</TD></TR><TR><TD CLASS="l">1647</TD><TD>                // no initial value passed, use first element found as inital value</TD></TR><TR CLASS="c"><TD CLASS="l">1648</TD><TD>                value = elem;</TD></TR><TR><TD CLASS="l">1649</TD><TD>            } else {</TD></TR><TR CLASS="c"><TD CLASS="l">1650</TD><TD>                Object[] innerArgs = { value, elem, index, thisObj };</TD></TR><TR CLASS="c"><TD CLASS="l">1651</TD><TD>                value = f.call(cx, parent, parent, innerArgs);</TD></TR><TR><TD CLASS="l">1652</TD><TD>            }</TD></TR><TR><TD CLASS="l">1653</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">1654</TD><TD>        if (value == Scriptable.NOT_FOUND) {</TD></TR><TR><TD CLASS="l">1655</TD><TD>            // reproduce spidermonkey error message</TD></TR><TR CLASS="z"><TD CLASS="l">1656</TD><TD>            throw ScriptRuntime.typeError0(&#34;msg.empty.array.reduce&#34;);</TD></TR><TR><TD CLASS="l">1657</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">1658</TD><TD>        return value;</TD></TR><TR><TD CLASS="l">1659</TD><TD>    }</TD></TR><TR><TD CLASS="l"><A NAME="40">1660</A></TD><TD> </TD></TR><TR><TD CLASS="l">1661</TD><TD>    // methods to implement java.util.List</TD></TR><TR><TD CLASS="l">1662</TD><TD> </TD></TR><TR><TD CLASS="l">1663</TD><TD>    public boolean contains(Object o) {</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="60">1664</A></TD><TD>        return indexOf(o) &gt; -1;</TD></TR><TR><TD CLASS="l">1665</TD><TD>    }</TD></TR><TR><TD CLASS="l">1666</TD><TD> </TD></TR><TR><TD CLASS="l">1667</TD><TD>    public Object[] toArray() {</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="31">1668</A></TD><TD>        return toArray(ScriptRuntime.emptyArgs);</TD></TR><TR><TD CLASS="l">1669</TD><TD>    }</TD></TR><TR><TD CLASS="l">1670</TD><TD> </TD></TR><TR><TD CLASS="l">1671</TD><TD>    public Object[] toArray(Object[] a) {</TD></TR><TR CLASS="c"><TD CLASS="l">1672</TD><TD>        long longLen = length;</TD></TR><TR CLASS="c"><TD CLASS="l">1673</TD><TD>        if (longLen &gt; Integer.MAX_VALUE) {</TD></TR><TR CLASS="z"><TD CLASS="l">1674</TD><TD>            throw new IllegalStateException();</TD></TR><TR><TD CLASS="l">1675</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">1676</TD><TD>        int len = (int) longLen;</TD></TR><TR CLASS="c"><TD CLASS="l">1677</TD><TD>        Object[] array = a.length &gt;= len ?</TD></TR><TR><TD CLASS="l">1678</TD><TD>                a : (Object[]) java.lang.reflect.Array</TD></TR><TR><TD CLASS="l">1679</TD><TD>                .newInstance(a.getClass().getComponentType(), len);</TD></TR><TR CLASS="c"><TD CLASS="l">1680</TD><TD>        for (int i = 0; i &lt; len; i++) {</TD></TR><TR CLASS="c"><TD CLASS="l">1681</TD><TD>            array[i] = get(i);</TD></TR><TR><TD CLASS="l">1682</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="14">1683</A></TD><TD>        return array;</TD></TR><TR><TD CLASS="l">1684</TD><TD>    }</TD></TR><TR><TD CLASS="l">1685</TD><TD> </TD></TR><TR><TD CLASS="l">1686</TD><TD>    public boolean containsAll(Collection c) {</TD></TR><TR CLASS="z"><TD CLASS="l">1687</TD><TD>        for (Object aC : c)</TD></TR><TR CLASS="z"><TD CLASS="l">1688</TD><TD>            if (!contains(aC))</TD></TR><TR CLASS="z"><TD CLASS="l">1689</TD><TD>                return false;</TD></TR><TR CLASS="z"><TD CLASS="l">1690</TD><TD>        return true;</TD></TR><TR><TD CLASS="l"><A NAME="25">1691</A></TD><TD>    }</TD></TR><TR><TD CLASS="l">1692</TD><TD> </TD></TR><TR><TD CLASS="l">1693</TD><TD>    @Override</TD></TR><TR><TD CLASS="l">1694</TD><TD>    public int size() {</TD></TR><TR CLASS="c"><TD CLASS="l">1695</TD><TD>        long longLen = length;</TD></TR><TR CLASS="c"><TD CLASS="l">1696</TD><TD>        if (longLen &gt; Integer.MAX_VALUE) {</TD></TR><TR CLASS="z"><TD CLASS="l">1697</TD><TD>            throw new IllegalStateException();</TD></TR><TR><TD CLASS="l">1698</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">1699</TD><TD>        return (int) longLen;</TD></TR><TR><TD CLASS="l"><A NAME="17">1700</A></TD><TD>    }</TD></TR><TR><TD CLASS="l">1701</TD><TD> </TD></TR><TR><TD CLASS="l">1702</TD><TD>    @Override</TD></TR><TR><TD CLASS="l">1703</TD><TD>    public boolean isEmpty() {</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="26">1704</A></TD><TD>        return length == 0;</TD></TR><TR><TD CLASS="l">1705</TD><TD>    }</TD></TR><TR><TD CLASS="l">1706</TD><TD> </TD></TR><TR><TD CLASS="l">1707</TD><TD>    public Object get(long index) {</TD></TR><TR CLASS="c"><TD CLASS="l">1708</TD><TD>        if (index &lt; 0 || index &gt;= length) {</TD></TR><TR CLASS="z"><TD CLASS="l">1709</TD><TD>            throw new IndexOutOfBoundsException();</TD></TR><TR><TD CLASS="l">1710</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">1711</TD><TD>        Object value = getRawElem(this, index);</TD></TR><TR CLASS="c"><TD CLASS="l">1712</TD><TD>        if (value == Scriptable.NOT_FOUND || value == Undefined.instance) {</TD></TR><TR CLASS="z"><TD CLASS="l">1713</TD><TD>            return null;</TD></TR><TR CLASS="c"><TD CLASS="l">1714</TD><TD>        } else if (value instanceof Wrapper) {</TD></TR><TR CLASS="c"><TD CLASS="l">1715</TD><TD>            return ((Wrapper) value).unwrap();</TD></TR><TR><TD CLASS="l">1716</TD><TD>        } else {</TD></TR><TR CLASS="c"><TD CLASS="l">1717</TD><TD>            return value;</TD></TR><TR><TD CLASS="l"><A NAME="46">1718</A></TD><TD>        }</TD></TR><TR><TD CLASS="l">1719</TD><TD>    }</TD></TR><TR><TD CLASS="l">1720</TD><TD> </TD></TR><TR><TD CLASS="l">1721</TD><TD>    public Object get(int index) {</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="29">1722</A></TD><TD>        return get((long) index);</TD></TR><TR><TD CLASS="l">1723</TD><TD>    }</TD></TR><TR><TD CLASS="l">1724</TD><TD> </TD></TR><TR><TD CLASS="l">1725</TD><TD>    public int indexOf(Object o) {</TD></TR><TR CLASS="c"><TD CLASS="l">1726</TD><TD>        long longLen = length;</TD></TR><TR CLASS="c"><TD CLASS="l">1727</TD><TD>        if (longLen &gt; Integer.MAX_VALUE) {</TD></TR><TR CLASS="z"><TD CLASS="l">1728</TD><TD>            throw new IllegalStateException();</TD></TR><TR><TD CLASS="l">1729</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">1730</TD><TD>        int len = (int) longLen;</TD></TR><TR CLASS="c"><TD CLASS="l">1731</TD><TD>        if (o == null) {</TD></TR><TR CLASS="c"><TD CLASS="l">1732</TD><TD>            for (int i = 0; i &lt; len; i++) {</TD></TR><TR CLASS="c"><TD CLASS="l">1733</TD><TD>                if (get(i) == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">1734</TD><TD>                    return i;</TD></TR><TR><TD CLASS="l">1735</TD><TD>                }</TD></TR><TR><TD CLASS="l">1736</TD><TD>            }</TD></TR><TR><TD CLASS="l">1737</TD><TD>        } else {</TD></TR><TR CLASS="c"><TD CLASS="l">1738</TD><TD>            for (int i = 0; i &lt; len; i++) {</TD></TR><TR CLASS="c"><TD CLASS="l">1739</TD><TD>                if (o.equals(get(i))) {</TD></TR><TR CLASS="c"><TD CLASS="l">1740</TD><TD>                    return i;</TD></TR><TR><TD CLASS="l">1741</TD><TD>                }</TD></TR><TR><TD CLASS="l">1742</TD><TD>            }</TD></TR><TR><TD CLASS="l">1743</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="2d">1744</A></TD><TD>        return -1;</TD></TR><TR><TD CLASS="l">1745</TD><TD>    }</TD></TR><TR><TD CLASS="l">1746</TD><TD> </TD></TR><TR><TD CLASS="l">1747</TD><TD>    public int lastIndexOf(Object o) {</TD></TR><TR CLASS="c"><TD CLASS="l">1748</TD><TD>        long longLen = length;</TD></TR><TR CLASS="c"><TD CLASS="l">1749</TD><TD>        if (longLen &gt; Integer.MAX_VALUE) {</TD></TR><TR CLASS="z"><TD CLASS="l">1750</TD><TD>            throw new IllegalStateException();</TD></TR><TR><TD CLASS="l">1751</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">1752</TD><TD>        int len = (int) longLen;</TD></TR><TR CLASS="c"><TD CLASS="l">1753</TD><TD>        if (o == null) {</TD></TR><TR CLASS="c"><TD CLASS="l">1754</TD><TD>            for (int i = len - 1; i &gt;= 0; i--) {</TD></TR><TR CLASS="c"><TD CLASS="l">1755</TD><TD>                if (get(i) == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">1756</TD><TD>                    return i;</TD></TR><TR><TD CLASS="l">1757</TD><TD>                }</TD></TR><TR><TD CLASS="l">1758</TD><TD>            }</TD></TR><TR><TD CLASS="l">1759</TD><TD>        } else {</TD></TR><TR CLASS="c"><TD CLASS="l">1760</TD><TD>            for (int i = len - 1; i &gt;= 0; i--) {</TD></TR><TR CLASS="c"><TD CLASS="l">1761</TD><TD>                if (o.equals(get(i))) {</TD></TR><TR CLASS="c"><TD CLASS="l">1762</TD><TD>                    return i;</TD></TR><TR><TD CLASS="l">1763</TD><TD>                }</TD></TR><TR><TD CLASS="l">1764</TD><TD>            }</TD></TR><TR><TD CLASS="l">1765</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="55">1766</A></TD><TD>        return -1;</TD></TR><TR><TD CLASS="l">1767</TD><TD>    }</TD></TR><TR><TD CLASS="l">1768</TD><TD> </TD></TR><TR><TD CLASS="l">1769</TD><TD>    public Iterator iterator() {</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="59">1770</A></TD><TD>        return listIterator(0);</TD></TR><TR><TD CLASS="l">1771</TD><TD>    }</TD></TR><TR><TD CLASS="l">1772</TD><TD> </TD></TR><TR><TD CLASS="l">1773</TD><TD>    public ListIterator listIterator() {</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="22">1774</A></TD><TD>        return listIterator(0);</TD></TR><TR><TD CLASS="l">1775</TD><TD>    }</TD></TR><TR><TD CLASS="l">1776</TD><TD> </TD></TR><TR><TD CLASS="l">1777</TD><TD>    public ListIterator listIterator(final int start) {</TD></TR><TR CLASS="c"><TD CLASS="l">1778</TD><TD>        long longLen = length;</TD></TR><TR CLASS="c"><TD CLASS="l">1779</TD><TD>        if (longLen &gt; Integer.MAX_VALUE) {</TD></TR><TR CLASS="z"><TD CLASS="l">1780</TD><TD>            throw new IllegalStateException();</TD></TR><TR><TD CLASS="l">1781</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">1782</TD><TD>        final int len = (int) longLen;</TD></TR><TR><TD CLASS="l">1783</TD><TD> </TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="0">1784</A></TD><TD>        if (start &lt; 0 || start &gt; len) {</TD></TR><TR CLASS="z"><TD CLASS="l">1785</TD><TD>            throw new IndexOutOfBoundsException(&#34;Index: &#34; + start);</TD></TR><TR><TD CLASS="l">1786</TD><TD>        }</TD></TR><TR><TD CLASS="l">1787</TD><TD> </TD></TR><TR CLASS="c"><TD CLASS="l">1788</TD><TD>        return new ListIterator() {</TD></TR><TR><TD CLASS="l"><A NAME="9">1789</A></TD><TD> </TD></TR><TR CLASS="c"><TD CLASS="l">1790</TD><TD>            int cursor = start;</TD></TR><TR><TD CLASS="l">1791</TD><TD> </TD></TR><TR><TD CLASS="l">1792</TD><TD>            public boolean hasNext() {</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="7">1793</A></TD><TD>                return cursor &lt; len;</TD></TR><TR><TD CLASS="l">1794</TD><TD>            }</TD></TR><TR><TD CLASS="l">1795</TD><TD> </TD></TR><TR><TD CLASS="l">1796</TD><TD>            public Object next() {</TD></TR><TR CLASS="c"><TD CLASS="l">1797</TD><TD>                if (cursor == len) {</TD></TR><TR CLASS="z"><TD CLASS="l">1798</TD><TD>                    throw new NoSuchElementException();</TD></TR><TR><TD CLASS="l">1799</TD><TD>                }</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="a">1800</A></TD><TD>                return get(cursor++);</TD></TR><TR><TD CLASS="l">1801</TD><TD>            }</TD></TR><TR><TD CLASS="l">1802</TD><TD> </TD></TR><TR><TD CLASS="l">1803</TD><TD>            public boolean hasPrevious() {</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="6">1804</A></TD><TD>                return cursor &gt; 0;</TD></TR><TR><TD CLASS="l">1805</TD><TD>            }</TD></TR><TR><TD CLASS="l">1806</TD><TD> </TD></TR><TR><TD CLASS="l">1807</TD><TD>            public Object previous() {</TD></TR><TR CLASS="c"><TD CLASS="l">1808</TD><TD>                if (cursor == 0) {</TD></TR><TR CLASS="z"><TD CLASS="l">1809</TD><TD>                    throw new NoSuchElementException();</TD></TR><TR><TD CLASS="l">1810</TD><TD>                }</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="2">1811</A></TD><TD>                return get(--cursor);</TD></TR><TR><TD CLASS="l">1812</TD><TD>            }</TD></TR><TR><TD CLASS="l">1813</TD><TD> </TD></TR><TR><TD CLASS="l">1814</TD><TD>            public int nextIndex() {</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="3">1815</A></TD><TD>                return cursor;</TD></TR><TR><TD CLASS="l">1816</TD><TD>            }</TD></TR><TR><TD CLASS="l">1817</TD><TD> </TD></TR><TR><TD CLASS="l">1818</TD><TD>            public int previousIndex() {</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="4">1819</A></TD><TD>                return cursor - 1;</TD></TR><TR><TD CLASS="l">1820</TD><TD>            }</TD></TR><TR><TD CLASS="l">1821</TD><TD> </TD></TR><TR><TD CLASS="l">1822</TD><TD>            public void remove() {</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="1">1823</A></TD><TD>                throw new UnsupportedOperationException();</TD></TR><TR><TD CLASS="l">1824</TD><TD>            }</TD></TR><TR><TD CLASS="l">1825</TD><TD> </TD></TR><TR><TD CLASS="l">1826</TD><TD>            public void add(Object o) {</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="5">1827</A></TD><TD>                throw new UnsupportedOperationException();</TD></TR><TR><TD CLASS="l">1828</TD><TD>            }</TD></TR><TR><TD CLASS="l">1829</TD><TD> </TD></TR><TR><TD CLASS="l">1830</TD><TD>            public void set(Object o) {</TD></TR><TR CLASS="z"><TD CLASS="l">1831</TD><TD>                throw new UnsupportedOperationException();</TD></TR><TR><TD CLASS="l">1832</TD><TD>            }</TD></TR><TR><TD CLASS="l"><A NAME="f">1833</A></TD><TD>        };</TD></TR><TR><TD CLASS="l">1834</TD><TD>    }</TD></TR><TR><TD CLASS="l">1835</TD><TD> </TD></TR><TR><TD CLASS="l">1836</TD><TD>    public boolean add(Object o) {</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="19">1837</A></TD><TD>        throw new UnsupportedOperationException();</TD></TR><TR><TD CLASS="l">1838</TD><TD>    }</TD></TR><TR><TD CLASS="l">1839</TD><TD> </TD></TR><TR><TD CLASS="l">1840</TD><TD>    public boolean remove(Object o) {</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="11">1841</A></TD><TD>        throw new UnsupportedOperationException();</TD></TR><TR><TD CLASS="l">1842</TD><TD>    }</TD></TR><TR><TD CLASS="l">1843</TD><TD> </TD></TR><TR><TD CLASS="l">1844</TD><TD>    public boolean addAll(Collection c) {</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="1b">1845</A></TD><TD>        throw new UnsupportedOperationException();</TD></TR><TR><TD CLASS="l">1846</TD><TD>    }</TD></TR><TR><TD CLASS="l">1847</TD><TD> </TD></TR><TR><TD CLASS="l">1848</TD><TD>    public boolean removeAll(Collection c) {</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="1c">1849</A></TD><TD>        throw new UnsupportedOperationException();</TD></TR><TR><TD CLASS="l">1850</TD><TD>    }</TD></TR><TR><TD CLASS="l">1851</TD><TD> </TD></TR><TR><TD CLASS="l">1852</TD><TD>    public boolean retainAll(Collection c) {</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="13">1853</A></TD><TD>        throw new UnsupportedOperationException();</TD></TR><TR><TD CLASS="l">1854</TD><TD>    }</TD></TR><TR><TD CLASS="l">1855</TD><TD> </TD></TR><TR><TD CLASS="l">1856</TD><TD>    public void clear() {</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="10">1857</A></TD><TD>        throw new UnsupportedOperationException();</TD></TR><TR><TD CLASS="l">1858</TD><TD>    }</TD></TR><TR><TD CLASS="l">1859</TD><TD> </TD></TR><TR><TD CLASS="l">1860</TD><TD>    public void add(int index, Object element) {</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="12">1861</A></TD><TD>        throw new UnsupportedOperationException();</TD></TR><TR><TD CLASS="l">1862</TD><TD>    }</TD></TR><TR><TD CLASS="l">1863</TD><TD> </TD></TR><TR><TD CLASS="l">1864</TD><TD>    public boolean addAll(int index, Collection c) {</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="1d">1865</A></TD><TD>        throw new UnsupportedOperationException();</TD></TR><TR><TD CLASS="l">1866</TD><TD>    }</TD></TR><TR><TD CLASS="l">1867</TD><TD> </TD></TR><TR><TD CLASS="l">1868</TD><TD>    public Object set(int index, Object element) {</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="1a">1869</A></TD><TD>        throw new UnsupportedOperationException();</TD></TR><TR><TD CLASS="l">1870</TD><TD>    }</TD></TR><TR><TD CLASS="l">1871</TD><TD> </TD></TR><TR><TD CLASS="l">1872</TD><TD>    public Object remove(int index) {</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="1f">1873</A></TD><TD>        throw new UnsupportedOperationException();</TD></TR><TR><TD CLASS="l">1874</TD><TD>    }</TD></TR><TR><TD CLASS="l">1875</TD><TD> </TD></TR><TR><TD CLASS="l">1876</TD><TD>    public List subList(int fromIndex, int toIndex) {</TD></TR><TR CLASS="z"><TD CLASS="l">1877</TD><TD>        throw new UnsupportedOperationException();</TD></TR><TR><TD CLASS="l">1878</TD><TD>    }</TD></TR><TR><TD CLASS="l">1879</TD><TD> </TD></TR><TR><TD CLASS="l">1880</TD><TD>// #string_id_map#</TD></TR><TR><TD CLASS="l">1881</TD><TD> </TD></TR><TR><TD CLASS="l">1882</TD><TD>    @Override</TD></TR><TR><TD CLASS="l"><A NAME="45">1883</A></TD><TD>    protected int findPrototypeId(String s)</TD></TR><TR><TD CLASS="l">1884</TD><TD>    {</TD></TR><TR><TD CLASS="l">1885</TD><TD>        int id;</TD></TR><TR><TD CLASS="l">1886</TD><TD>// #generated# Last update: 2005-09-26 15:47:42 EDT</TD></TR><TR CLASS="c"><TD CLASS="l">1887</TD><TD>        L0: { id = 0; String X = null; int c;</TD></TR><TR CLASS="c"><TD CLASS="l">1888</TD><TD>            L: switch (s.length()) {</TD></TR><TR CLASS="c"><TD CLASS="l">1889</TD><TD>            case 3: c=s.charAt(0);</TD></TR><TR CLASS="c"><TD CLASS="l">1890</TD><TD>                if (c=='m') { if (s.charAt(2)=='p' &amp;&amp; s.charAt(1)=='a') {id=Id_map; break L0;} }</TD></TR><TR CLASS="c"><TD CLASS="l">1891</TD><TD>                else if (c=='p') { if (s.charAt(2)=='p' &amp;&amp; s.charAt(1)=='o') {id=Id_pop; break L0;} }</TD></TR><TR><TD CLASS="l">1892</TD><TD>                break L;</TD></TR><TR CLASS="c"><TD CLASS="l">1893</TD><TD>            case 4: switch (s.charAt(2)) {</TD></TR><TR CLASS="c"><TD CLASS="l">1894</TD><TD>                case 'i': X=&#34;join&#34;;id=Id_join; break L;</TD></TR><TR CLASS="c"><TD CLASS="l">1895</TD><TD>                case 'm': X=&#34;some&#34;;id=Id_some; break L;</TD></TR><TR CLASS="c"><TD CLASS="l">1896</TD><TD>                case 'r': X=&#34;sort&#34;;id=Id_sort; break L;</TD></TR><TR CLASS="c"><TD CLASS="l">1897</TD><TD>                case 's': X=&#34;push&#34;;id=Id_push; break L;</TD></TR><TR CLASS="c"><TD CLASS="l">1898</TD><TD>                } break L;</TD></TR><TR CLASS="c"><TD CLASS="l">1899</TD><TD>            case 5: c=s.charAt(1);</TD></TR><TR CLASS="c"><TD CLASS="l">1900</TD><TD>                if (c=='h') { X=&#34;shift&#34;;id=Id_shift; }</TD></TR><TR CLASS="c"><TD CLASS="l">1901</TD><TD>                else if (c=='l') { X=&#34;slice&#34;;id=Id_slice; }</TD></TR><TR CLASS="c"><TD CLASS="l">1902</TD><TD>                else if (c=='v') { X=&#34;every&#34;;id=Id_every; }</TD></TR><TR><TD CLASS="l">1903</TD><TD>                break L;</TD></TR><TR CLASS="c"><TD CLASS="l">1904</TD><TD>            case 6: c=s.charAt(0);</TD></TR><TR CLASS="c"><TD CLASS="l">1905</TD><TD>                if (c=='c') { X=&#34;concat&#34;;id=Id_concat; }</TD></TR><TR CLASS="c"><TD CLASS="l">1906</TD><TD>                else if (c=='f') { X=&#34;filter&#34;;id=Id_filter; }</TD></TR><TR CLASS="c"><TD CLASS="l">1907</TD><TD>                else if (c=='s') { X=&#34;splice&#34;;id=Id_splice; }</TD></TR><TR CLASS="c"><TD CLASS="l">1908</TD><TD>                else if (c=='r') { X=&#34;reduce&#34;;id=Id_reduce; }</TD></TR><TR><TD CLASS="l">1909</TD><TD>                break L;</TD></TR><TR CLASS="c"><TD CLASS="l">1910</TD><TD>            case 7: switch (s.charAt(0)) {</TD></TR><TR CLASS="c"><TD CLASS="l">1911</TD><TD>                case 'f': X=&#34;forEach&#34;;id=Id_forEach; break L;</TD></TR><TR CLASS="c"><TD CLASS="l">1912</TD><TD>                case 'i': X=&#34;indexOf&#34;;id=Id_indexOf; break L;</TD></TR><TR CLASS="c"><TD CLASS="l">1913</TD><TD>                case 'r': X=&#34;reverse&#34;;id=Id_reverse; break L;</TD></TR><TR CLASS="c"><TD CLASS="l">1914</TD><TD>                case 'u': X=&#34;unshift&#34;;id=Id_unshift; break L;</TD></TR><TR CLASS="c"><TD CLASS="l">1915</TD><TD>                } break L;</TD></TR><TR CLASS="c"><TD CLASS="l">1916</TD><TD>            case 8: c=s.charAt(3);</TD></TR><TR CLASS="c"><TD CLASS="l">1917</TD><TD>                if (c=='o') { X=&#34;toSource&#34;;id=Id_toSource; }</TD></TR><TR CLASS="c"><TD CLASS="l">1918</TD><TD>                else if (c=='t') { X=&#34;toString&#34;;id=Id_toString; }</TD></TR><TR><TD CLASS="l">1919</TD><TD>                break L;</TD></TR><TR CLASS="c"><TD CLASS="l">1920</TD><TD>            case 11: c=s.charAt(0);</TD></TR><TR CLASS="c"><TD CLASS="l">1921</TD><TD>                if (c=='c') { X=&#34;constructor&#34;;id=Id_constructor; }</TD></TR><TR CLASS="c"><TD CLASS="l">1922</TD><TD>                else if (c=='l') { X=&#34;lastIndexOf&#34;;id=Id_lastIndexOf; }</TD></TR><TR CLASS="c"><TD CLASS="l">1923</TD><TD>                else if (c=='r') { X=&#34;reduceRight&#34;;id=Id_reduceRight; }</TD></TR><TR><TD CLASS="l">1924</TD><TD>                break L;</TD></TR><TR CLASS="c"><TD CLASS="l">1925</TD><TD>            case 14: X=&#34;toLocaleString&#34;;id=Id_toLocaleString; break L;</TD></TR><TR><TD CLASS="l">1926</TD><TD>            }</TD></TR><TR CLASS="c"><TD CLASS="l">1927</TD><TD>            if (X!=null &amp;&amp; X!=s &amp;&amp; !X.equals(s)) id = 0;</TD></TR><TR><TD CLASS="l">1928</TD><TD>        }</TD></TR><TR><TD CLASS="l">1929</TD><TD>// #/generated#</TD></TR><TR CLASS="c"><TD CLASS="l">1930</TD><TD>        return id;</TD></TR><TR><TD CLASS="l">1931</TD><TD>    }</TD></TR><TR><TD CLASS="l">1932</TD><TD> </TD></TR><TR><TD CLASS="l">1933</TD><TD>    private static final int</TD></TR><TR><TD CLASS="l">1934</TD><TD>        Id_constructor          = 1,</TD></TR><TR><TD CLASS="l">1935</TD><TD>        Id_toString             = 2,</TD></TR><TR><TD CLASS="l">1936</TD><TD>        Id_toLocaleString       = 3,</TD></TR><TR><TD CLASS="l">1937</TD><TD>        Id_toSource             = 4,</TD></TR><TR><TD CLASS="l">1938</TD><TD>        Id_join                 = 5,</TD></TR><TR><TD CLASS="l">1939</TD><TD>        Id_reverse              = 6,</TD></TR><TR><TD CLASS="l">1940</TD><TD>        Id_sort                 = 7,</TD></TR><TR><TD CLASS="l">1941</TD><TD>        Id_push                 = 8,</TD></TR><TR><TD CLASS="l">1942</TD><TD>        Id_pop                  = 9,</TD></TR><TR><TD CLASS="l">1943</TD><TD>        Id_shift                = 10,</TD></TR><TR><TD CLASS="l">1944</TD><TD>        Id_unshift              = 11,</TD></TR><TR><TD CLASS="l">1945</TD><TD>        Id_splice               = 12,</TD></TR><TR><TD CLASS="l">1946</TD><TD>        Id_concat               = 13,</TD></TR><TR><TD CLASS="l">1947</TD><TD>        Id_slice                = 14,</TD></TR><TR><TD CLASS="l">1948</TD><TD>        Id_indexOf              = 15,</TD></TR><TR><TD CLASS="l">1949</TD><TD>        Id_lastIndexOf          = 16,</TD></TR><TR><TD CLASS="l">1950</TD><TD>        Id_every                = 17,</TD></TR><TR><TD CLASS="l">1951</TD><TD>        Id_filter               = 18,</TD></TR><TR><TD CLASS="l">1952</TD><TD>        Id_forEach              = 19,</TD></TR><TR><TD CLASS="l">1953</TD><TD>        Id_map                  = 20,</TD></TR><TR><TD CLASS="l">1954</TD><TD>        Id_some                 = 21,</TD></TR><TR><TD CLASS="l">1955</TD><TD>        Id_reduce               = 22,</TD></TR><TR><TD CLASS="l">1956</TD><TD>        Id_reduceRight          = 23,</TD></TR><TR><TD CLASS="l">1957</TD><TD> </TD></TR><TR><TD CLASS="l">1958</TD><TD>        MAX_PROTOTYPE_ID        = 23;</TD></TR><TR><TD CLASS="l">1959</TD><TD> </TD></TR><TR><TD CLASS="l">1960</TD><TD>// #/string_id_map#</TD></TR><TR><TD CLASS="l">1961</TD><TD> </TD></TR><TR><TD CLASS="l">1962</TD><TD>    private static final int</TD></TR><TR><TD CLASS="l">1963</TD><TD>        ConstructorId_join                 = -Id_join,</TD></TR><TR><TD CLASS="l">1964</TD><TD>        ConstructorId_reverse              = -Id_reverse,</TD></TR><TR><TD CLASS="l">1965</TD><TD>        ConstructorId_sort                 = -Id_sort,</TD></TR><TR><TD CLASS="l">1966</TD><TD>        ConstructorId_push                 = -Id_push,</TD></TR><TR><TD CLASS="l">1967</TD><TD>        ConstructorId_pop                  = -Id_pop,</TD></TR><TR><TD CLASS="l">1968</TD><TD>        ConstructorId_shift                = -Id_shift,</TD></TR><TR><TD CLASS="l">1969</TD><TD>        ConstructorId_unshift              = -Id_unshift,</TD></TR><TR><TD CLASS="l">1970</TD><TD>        ConstructorId_splice               = -Id_splice,</TD></TR><TR><TD CLASS="l">1971</TD><TD>        ConstructorId_concat               = -Id_concat,</TD></TR><TR><TD CLASS="l">1972</TD><TD>        ConstructorId_slice                = -Id_slice,</TD></TR><TR><TD CLASS="l">1973</TD><TD>        ConstructorId_indexOf              = -Id_indexOf,</TD></TR><TR><TD CLASS="l">1974</TD><TD>        ConstructorId_lastIndexOf          = -Id_lastIndexOf,</TD></TR><TR><TD CLASS="l">1975</TD><TD>        ConstructorId_every                = -Id_every,</TD></TR><TR><TD CLASS="l">1976</TD><TD>        ConstructorId_filter               = -Id_filter,</TD></TR><TR><TD CLASS="l">1977</TD><TD>        ConstructorId_forEach              = -Id_forEach,</TD></TR><TR><TD CLASS="l">1978</TD><TD>        ConstructorId_map                  = -Id_map,</TD></TR><TR><TD CLASS="l">1979</TD><TD>        ConstructorId_some                 = -Id_some,</TD></TR><TR><TD CLASS="l">1980</TD><TD>        ConstructorId_reduce               = -Id_reduce,</TD></TR><TR><TD CLASS="l">1981</TD><TD>        ConstructorId_reduceRight          = -Id_reduceRight,</TD></TR><TR><TD CLASS="l">1982</TD><TD>        ConstructorId_isArray              = -24;</TD></TR><TR><TD CLASS="l">1983</TD><TD> </TD></TR><TR><TD CLASS="l">1984</TD><TD>    /**</TD></TR><TR><TD CLASS="l">1985</TD><TD>     * Internal representation of the JavaScript array's length property.</TD></TR><TR><TD CLASS="l">1986</TD><TD>     */</TD></TR><TR><TD CLASS="l">1987</TD><TD>    private long length;</TD></TR><TR><TD CLASS="l">1988</TD><TD> </TD></TR><TR><TD CLASS="l">1989</TD><TD>    /**</TD></TR><TR><TD CLASS="l">1990</TD><TD>     * Attributes of the array's length property</TD></TR><TR><TD CLASS="l">1991</TD><TD>     */</TD></TR><TR CLASS="c"><TD CLASS="l">1992</TD><TD>    private int lengthAttr = DONTENUM | PERMANENT;</TD></TR><TR><TD CLASS="l">1993</TD><TD> </TD></TR><TR><TD CLASS="l">1994</TD><TD>    /**</TD></TR><TR><TD CLASS="l">1995</TD><TD>     * Fast storage for dense arrays. Sparse arrays will use the superclass's</TD></TR><TR><TD CLASS="l">1996</TD><TD>     * hashtable storage scheme.</TD></TR><TR><TD CLASS="l">1997</TD><TD>     */</TD></TR><TR><TD CLASS="l">1998</TD><TD>    private Object[] dense;</TD></TR><TR><TD CLASS="l">1999</TD><TD> </TD></TR><TR><TD CLASS="l">2000</TD><TD>    /**</TD></TR><TR><TD CLASS="l">2001</TD><TD>     * True if all numeric properties are stored in &lt;code&gt;dense&lt;/code&gt;.</TD></TR><TR><TD CLASS="l">2002</TD><TD>     */</TD></TR><TR><TD CLASS="l">2003</TD><TD>    private boolean denseOnly;</TD></TR><TR><TD CLASS="l">2004</TD><TD> </TD></TR><TR><TD CLASS="l">2005</TD><TD>    /**</TD></TR><TR><TD CLASS="l">2006</TD><TD>     * The maximum size of &lt;code&gt;dense&lt;/code&gt; that will be allocated initially.</TD></TR><TR><TD CLASS="l">2007</TD><TD>     */</TD></TR><TR CLASS="c"><TD CLASS="l">2008</TD><TD>    private static int maximumInitialCapacity = 10000;</TD></TR><TR><TD CLASS="l">2009</TD><TD> </TD></TR><TR><TD CLASS="l">2010</TD><TD>    /**</TD></TR><TR><TD CLASS="l">2011</TD><TD>     * The default capacity for &lt;code&gt;dense&lt;/code&gt;.</TD></TR><TR><TD CLASS="l">2012</TD><TD>     */</TD></TR><TR><TD CLASS="l">2013</TD><TD>    private static final int DEFAULT_INITIAL_CAPACITY = 10;</TD></TR><TR><TD CLASS="l">2014</TD><TD> </TD></TR><TR><TD CLASS="l">2015</TD><TD>    /**</TD></TR><TR><TD CLASS="l">2016</TD><TD>     * The factor to grow &lt;code&gt;dense&lt;/code&gt; by.</TD></TR><TR><TD CLASS="l">2017</TD><TD>     */</TD></TR><TR><TD CLASS="l">2018</TD><TD>    private static final double GROW_FACTOR = 1.5;</TD></TR><TR><TD CLASS="l">2019</TD><TD>    private static final int MAX_PRE_GROW_SIZE = (int)(Integer.MAX_VALUE / GROW_FACTOR);</TD></TR><TR><TD CLASS="l">2020</TD><TD>}</TD></TR></TABLE><P></P><TABLE CLASS="hdft" CELLSPACING="0" WIDTH="100%"><TR><TD CLASS="nv">[<A HREF="../index.html">all classes</A>][<A HREF="f.html">org.mozilla.javascript</A>]</TD></TR><TR><TD CLASS="tl"><A HREF="http://sourceforge.net/projects/emma">EMMA 2.1.5320 (stable)</A> (C) Vladimir Roubtsov</TD></TR></TABLE></BODY></HTML>